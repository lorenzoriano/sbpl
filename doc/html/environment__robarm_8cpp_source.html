<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SBPL: src/discrete_space_information/environment_robarm.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SBPL
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('environment__robarm_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/discrete_space_information/environment_robarm.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="environment__robarm_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2008, Maxim Likhachev</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> * </span>
<a name="l00005"></a>00005 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00006"></a>00006 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"> * </span>
<a name="l00008"></a>00008 <span class="comment"> *     * Redistributions of source code must retain the above copyright</span>
<a name="l00009"></a>00009 <span class="comment"> *       notice, this list of conditions and the following disclaimer.</span>
<a name="l00010"></a>00010 <span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00011"></a>00011 <span class="comment"> *       notice, this list of conditions and the following disclaimer in the</span>
<a name="l00012"></a>00012 <span class="comment"> *       documentation and/or other materials provided with the distribution.</span>
<a name="l00013"></a>00013 <span class="comment"> *     * Neither the name of the University of Pennsylvania nor the names of its</span>
<a name="l00014"></a>00014 <span class="comment"> *       contributors may be used to endorse or promote products derived from</span>
<a name="l00015"></a>00015 <span class="comment"> *       this software without specific prior written permission.</span>
<a name="l00016"></a>00016 <span class="comment"> * </span>
<a name="l00017"></a>00017 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<a name="l00018"></a>00018 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00019"></a>00019 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00020"></a>00020 <span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<a name="l00021"></a>00021 <span class="comment"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a name="l00022"></a>00022 <span class="comment"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a name="l00023"></a>00023 <span class="comment"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<a name="l00024"></a>00024 <span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<a name="l00025"></a>00025 <span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="l00026"></a>00026 <span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00027"></a>00027 <span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00028"></a>00028 <span class="comment"> */</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;queue&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="environment__robarm_8h.html">sbpl/discrete_space_information/environment_robarm.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="planner_8h.html">sbpl/planners/planner.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="key_8h.html">sbpl/utils/key.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="mdp_8h.html">sbpl/utils/mdp.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="mdpconfig_8h.html">sbpl/utils/mdpconfig.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="utils_8h.html">sbpl/utils/utils.h</a>&gt;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="keyword">using namespace </span>std;
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="environment__robarm_8cpp.html#ae4f03818e11402bd437e9fc48aa4b7f4">00043</a> <span class="preprocessor">#define COSTMULT 1000</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a>00045 <span class="comment">//static clock_t time3_addallout = 0;</span>
<a name="l00046"></a>00046 <span class="comment">//static clock_t time_gethash = 0;</span>
<a name="l00047"></a>00047 <span class="comment">//static clock_t time_createhash = 0;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="environment__robarm_8cpp.html#a040086b3a5729c12991de632f21bf5ec">00049</a> <span class="preprocessor">#define XYTO2DIND(x,y) ((x) + (y)*EnvROBARMCfg.EnvWidth_c)</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a><a class="code" href="environment__robarm_8cpp.html#a3e3d4e9e6ca78f948635651ace96a76c">00051</a> <span class="preprocessor">#define DIRECTIONS 8</span>
<a name="l00052"></a><a class="code" href="environment__robarm_8cpp.html#a81993d0f2b730f2ba6b34ebfc3189d8c">00052</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="environment__robarm_8cpp.html#a81993d0f2b730f2ba6b34ebfc3189d8c">dx</a>[<a class="code" href="environment__robarm_8cpp.html#a3e3d4e9e6ca78f948635651ace96a76c">DIRECTIONS</a>] = {1, 1, 1, 0, 0, -1, -1, -1};
<a name="l00053"></a><a class="code" href="environment__robarm_8cpp.html#a5355ebd24fef21214f574784f9acaeed">00053</a> <span class="keywordtype">int</span> <a class="code" href="environment__robarm_8cpp.html#a5355ebd24fef21214f574784f9acaeed">dy</a>[<a class="code" href="environment__robarm_8cpp.html#a3e3d4e9e6ca78f948635651ace96a76c">DIRECTIONS</a>] = {1, 0, -1, 1, -1, -1, 0, 1};
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">//-------------------state access functions---------------------</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> inthash(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key)
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059     key += (key &lt;&lt; 12);
<a name="l00060"></a>00060     key ^= (key &gt;&gt; 22);
<a name="l00061"></a>00061     key += (key &lt;&lt; 4);
<a name="l00062"></a>00062     key ^= (key &gt;&gt; 9);
<a name="l00063"></a>00063     key += (key &lt;&lt; 10);
<a name="l00064"></a>00064     key ^= (key &gt;&gt; 2);
<a name="l00065"></a>00065     key += (key &lt;&lt; 7);
<a name="l00066"></a>00066     key ^= (key &gt;&gt; 12);
<a name="l00067"></a>00067     <span class="keywordflow">return</span> key;
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">//examples of hash functions: map state coordinates onto a hash value</span>
<a name="l00071"></a>00071 <span class="comment">//#define GETHASHBIN(X, Y) (Y*WIDTH_Y+X) </span>
<a name="l00072"></a>00072 <span class="comment">//here we have state coord: &lt;X1, X2, X3, X4&gt;</span>
<a name="l00073"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a0c906b37706ac964ff9a240c510cd351">00073</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a0c906b37706ac964ff9a240c510cd351">EnvironmentROBARM::GETHASHBIN</a>(<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* coord, <span class="keywordtype">int</span> numofcoord)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075     <span class="keywordtype">int</span> val = 0;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numofcoord; i++) {
<a name="l00078"></a>00078         val += inthash(coord[i]) &lt;&lt; i;
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="keywordflow">return</span> inthash(val) &amp; (EnvROBARM.HashTableSize - 1);
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#aa57985b9e8ef8e916967c0d1215c2c37">00084</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#aa57985b9e8ef8e916967c0d1215c2c37">EnvironmentROBARM::PrintHashTableHist</a>()
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     <span class="keywordtype">int</span> s0 = 0, s1 = 0, s50 = 0, s100 = 0, s200 = 0, s300 = 0, slarge = 0;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; EnvROBARM.HashTableSize; j++) {
<a name="l00089"></a>00089         <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)EnvROBARM.Coord2StateIDHashTable[j].size() == 0)
<a name="l00090"></a>00090             s0++;
<a name="l00091"></a>00091         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)EnvROBARM.Coord2StateIDHashTable[j].size() &lt; 50)
<a name="l00092"></a>00092             s1++;
<a name="l00093"></a>00093         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)EnvROBARM.Coord2StateIDHashTable[j].size() &lt; 100)
<a name="l00094"></a>00094             s50++;
<a name="l00095"></a>00095         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)EnvROBARM.Coord2StateIDHashTable[j].size() &lt; 200)
<a name="l00096"></a>00096             s100++;
<a name="l00097"></a>00097         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)EnvROBARM.Coord2StateIDHashTable[j].size() &lt; 300)
<a name="l00098"></a>00098             s200++;
<a name="l00099"></a>00099         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)EnvROBARM.Coord2StateIDHashTable[j].size() &lt; 400)
<a name="l00100"></a>00100             s300++;
<a name="l00101"></a>00101         <span class="keywordflow">else</span>
<a name="l00102"></a>00102             slarge++;
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;hash table histogram: 0:%d, &lt;50:%d, &lt;100:%d, &lt;200:%d, &lt;300:%d, &lt;400:%d &gt;400:%d\n&quot;</span>, s0, s1, s50, s100,
<a name="l00105"></a>00105                 s200, s300, slarge);
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a191852fbc220b66191261810c8985bd4">00108</a> <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* <a class="code" href="class_environment_r_o_b_a_r_m.html#a191852fbc220b66191261810c8985bd4">EnvironmentROBARM::GetHashEntry</a>(<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* coord, <span class="keywordtype">int</span> numofcoord, <span class="keywordtype">bool</span> bIsGoal)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <span class="comment">//clock_t currenttime = clock();</span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <span class="comment">//if it is goal</span>
<a name="l00113"></a>00113     <span class="keywordflow">if</span> (bIsGoal) {
<a name="l00114"></a>00114         <span class="keywordflow">return</span> EnvROBARM.goalHashEntry;
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="keywordtype">int</span> binid = GETHASHBIN(coord, numofcoord);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="preprocessor">#if DEBUG</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)EnvROBARM.Coord2StateIDHashTable[binid].size() &gt; 500)
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;WARNING: Hash table has a bin %d (coord0=%d) of size %d\n&quot;</span>,
<a name="l00123"></a>00123             binid, coord[0], (<span class="keywordtype">int</span>)EnvROBARM.Coord2StateIDHashTable[binid].size());
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         PrintHashTableHist();
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127 <span class="preprocessor">#endif</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a>00129     <span class="comment">//iterate over the states in the bin and select the perfect match</span>
<a name="l00130"></a>00130     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ind = 0; ind &lt; (int)EnvROBARM.Coord2StateIDHashTable[binid].size(); ind++) {
<a name="l00131"></a>00131         <span class="keywordtype">int</span> j = 0;
<a name="l00132"></a>00132         <span class="keywordflow">for</span> (j = 0; j &lt; numofcoord; j++) {
<a name="l00133"></a>00133             <span class="keywordflow">if</span> (EnvROBARM.Coord2StateIDHashTable[binid][ind]-&gt;coord[j] != coord[j]) {
<a name="l00134"></a>00134                 <span class="keywordflow">break</span>;
<a name="l00135"></a>00135             }
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137         <span class="keywordflow">if</span> (j == numofcoord) {
<a name="l00138"></a>00138             <span class="comment">//time_gethash += clock()-currenttime;</span>
<a name="l00139"></a>00139             <span class="keywordflow">return</span> EnvROBARM.Coord2StateIDHashTable[binid][ind];
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="comment">//time_gethash += clock()-currenttime;</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordflow">return</span> NULL;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a7f8332a8700dbf8c6658e392de61670c">00148</a> <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* <a class="code" href="class_environment_r_o_b_a_r_m.html#a7f8332a8700dbf8c6658e392de61670c">EnvironmentROBARM::CreateNewHashEntry</a>(<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* coord, <span class="keywordtype">int</span> numofcoord,
<a name="l00149"></a>00149                                                             <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endeffx, <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endeffy)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151     <span class="keywordtype">int</span> i;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="comment">//clock_t currenttime = clock();</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* HashEntry = <span class="keyword">new</span> <a class="code" href="environment__robarm_8h.html#a2d27d9983b445a10edef0db2a78c6c40">EnvROBARMHashEntry_t</a>;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     memcpy(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>, coord, numofcoord * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>));
<a name="l00158"></a>00158     HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a3c2e00865b8a6497e0af07c4ec3a21fe">endeffx</a> = endeffx;
<a name="l00159"></a>00159     HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a0a1085527466008164787ba87a040b49">endeffy</a> = endeffy;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a> = EnvROBARM.StateID2CoordTable.size();
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="comment">//insert into the tables</span>
<a name="l00164"></a>00164     EnvROBARM.StateID2CoordTable.push_back(HashEntry);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">//get the hash table bin</span>
<a name="l00167"></a>00167     i = GETHASHBIN(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>, numofcoord);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <span class="comment">//insert the entry into the bin</span>
<a name="l00170"></a>00170     EnvROBARM.Coord2StateIDHashTable[i].push_back(HashEntry);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="comment">//insert into and initialize the mappings</span>
<a name="l00173"></a>00173     <span class="keywordtype">int</span>* entry = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="planner_8h.html#a77c24f4e231cd4b865d394d60a27a85aad8c7e51ce373384e5d809bd8e658ac38">NUMOFINDICES_STATEID2IND</a>];
<a name="l00174"></a>00174     StateID2IndexMapping.push_back(entry);
<a name="l00175"></a>00175     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="planner_8h.html#a77c24f4e231cd4b865d394d60a27a85aad8c7e51ce373384e5d809bd8e658ac38">NUMOFINDICES_STATEID2IND</a>; i++) {
<a name="l00176"></a>00176         StateID2IndexMapping[HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>][i] = -1;
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a> != (<span class="keywordtype">int</span>)StateID2IndexMapping.size() - 1) {
<a name="l00180"></a>00180         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in Env... function: last state has incorrect stateID\n&quot;</span>);
<a name="l00181"></a>00181         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="comment">//time_createhash += clock()-currenttime;</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="keywordflow">return</span> HashEntry;
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">//---------------heuristic values computation-------------------------</span>
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#ab3275980a81d3b434bcbc8961434f8ce">00193</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#ab3275980a81d3b434bcbc8961434f8ce">EnvironmentROBARM::distanceincoord</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* statecoord1, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* statecoord2)
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195     <span class="keywordtype">int</span> totaldiff = 0;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00198"></a>00198         <span class="keywordtype">int</span> diff = abs(statecoord1[i] - statecoord2[i]);
<a name="l00199"></a>00199         <span class="comment">//totaldiff += __min(diff, RobArmStateSpace.anglevals[i] - diff);</span>
<a name="l00200"></a>00200         totaldiff = <a class="code" href="utils_8h.html#af643213a7d426b69429d1430cef4ecbb">__max</a>(totaldiff, <a class="code" href="utils_8h.html#ad6d0138bf7e2cdaabeedc3fea40767ad">__min</a>(diff, EnvROBARMCfg.anglevals[i] - diff));
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="keywordflow">return</span> totaldiff;
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#aa94c038f8603179023d6d5dacaae13f7">00206</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#aa94c038f8603179023d6d5dacaae13f7">EnvironmentROBARM::ReInitializeState2D</a>(<a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>* state)
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208     state-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae66384d4168ef589ea4d403db10e5e02">g</a> = <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l00209"></a>00209     state-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ab5079b73bb1681652b181904ec532182">iterationclosed</a> = 0;
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#abfc16cf0f498627705d0dbc9e90c3bb5">00212</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#abfc16cf0f498627705d0dbc9e90c3bb5">EnvironmentROBARM::InitializeState2D</a>(<a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>* state, <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214     state-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae66384d4168ef589ea4d403db10e5e02">g</a> = <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l00215"></a>00215     state-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ab5079b73bb1681652b181904ec532182">iterationclosed</a> = 0;
<a name="l00216"></a>00216     state-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#a703e8dbd1b5778397b2cdebb5962e7a1">x</a> = x;
<a name="l00217"></a>00217     state-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae598965dcc20e4a74186c9a2033c863b">y</a> = y;
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="comment">/*</span>
<a name="l00221"></a>00221 <span class="comment">void EnvironmentROBARM::Search2DwithHeap(State** statespace, int searchstartx, int searchstarty)</span>
<a name="l00222"></a>00222 <span class="comment">{</span>
<a name="l00223"></a>00223 <span class="comment">    CKey key;</span>
<a name="l00224"></a>00224 <span class="comment">    CHeap* heap;</span>
<a name="l00225"></a>00225 <span class="comment">    State* ExpState;</span>
<a name="l00226"></a>00226 <span class="comment">    int newx, newy,x,y;</span>
<a name="l00227"></a>00227 <span class="comment"></span>
<a name="l00228"></a>00228 <span class="comment">    //create a heap</span>
<a name="l00229"></a>00229 <span class="comment">    heap = new CHeap;</span>
<a name="l00230"></a>00230 <span class="comment"></span>
<a name="l00231"></a>00231 <span class="comment">    //initialize to infinity all</span>
<a name="l00232"></a>00232 <span class="comment">    for (x = 0; x &lt; EnvROBARMCfg.EnvWidth_c; x++)</span>
<a name="l00233"></a>00233 <span class="comment">    {</span>
<a name="l00234"></a>00234 <span class="comment">        for (y = 0; y &lt; EnvROBARMCfg.EnvHeight_c; y++)</span>
<a name="l00235"></a>00235 <span class="comment">        {</span>
<a name="l00236"></a>00236 <span class="comment">            HeurGrid[x][y] = INFINITECOST;</span>
<a name="l00237"></a>00237 <span class="comment">            ReInitializeState2D(&amp;statespace[x][y]);</span>
<a name="l00238"></a>00238 <span class="comment">        }</span>
<a name="l00239"></a>00239 <span class="comment">    }</span>
<a name="l00240"></a>00240 <span class="comment"></span>
<a name="l00241"></a>00241 <span class="comment">    //initialization</span>
<a name="l00242"></a>00242 <span class="comment">    statespace[searchstartx][searchstarty].g = 0;</span>
<a name="l00243"></a>00243 <span class="comment">    key.key[0] = 0;</span>
<a name="l00244"></a>00244 <span class="comment">    heap-&gt;insertheap(&amp;statespace[searchstartx][searchstarty], key);</span>
<a name="l00245"></a>00245 <span class="comment"></span>
<a name="l00246"></a>00246 <span class="comment">    //expand all of the states</span>
<a name="l00247"></a>00247 <span class="comment">    while(!heap-&gt;emptyheap())</span>
<a name="l00248"></a>00248 <span class="comment">    {</span>
<a name="l00249"></a>00249 <span class="comment">        //get the state to expand</span>
<a name="l00250"></a>00250 <span class="comment">        ExpState =      heap-&gt;deleteminheap();</span>
<a name="l00251"></a>00251 <span class="comment"></span>
<a name="l00252"></a>00252 <span class="comment">        //set the corresponding heuristics</span>
<a name="l00253"></a>00253 <span class="comment">        HeurGrid[ExpState-&gt;statecoord[0]][ExpState-&gt;statecoord[1]] = ExpState-&gt;g;</span>
<a name="l00254"></a>00254 <span class="comment"></span>
<a name="l00255"></a>00255 <span class="comment">        //iterate through neighbors</span>
<a name="l00256"></a>00256 <span class="comment">        for(int d = 0; d &lt; DIRECTIONS; d++)</span>
<a name="l00257"></a>00257 <span class="comment">        {</span>
<a name="l00258"></a>00258 <span class="comment">            newx = ExpState-&gt;statecoord[0] + dx[d];</span>
<a name="l00259"></a>00259 <span class="comment">            newy = ExpState-&gt;statecoord[1] + dy[d];</span>
<a name="l00260"></a>00260 <span class="comment"></span>
<a name="l00261"></a>00261 <span class="comment">            //make sure it is inside the map</span>
<a name="l00262"></a>00262 <span class="comment">            if(0 &gt; newx || newx &gt;= EnvROBARMCfg.EnvWidth_c ||</span>
<a name="l00263"></a>00263 <span class="comment">                    0 &gt; newy || newy &gt;= EnvROBARMCfg.EnvHeight_c)</span>
<a name="l00264"></a>00264 <span class="comment">                continue;</span>
<a name="l00265"></a>00265 <span class="comment"></span>
<a name="l00266"></a>00266 <span class="comment">            if(statespace[newx][newy].g &gt; ExpState-&gt;g + 1 &amp;&amp;</span>
<a name="l00267"></a>00267 <span class="comment">                    EnvROBARMCfg.Grid2D[newx][newy] == 0)</span>
<a name="l00268"></a>00268 <span class="comment">            {</span>
<a name="l00269"></a>00269 <span class="comment">                statespace[newx][newy].g = ExpState-&gt;g + 1;</span>
<a name="l00270"></a>00270 <span class="comment">                key.key[0] = statespace[newx][newy].g;</span>
<a name="l00271"></a>00271 <span class="comment">                if(statespace[newx][newy].heapindex == 0)</span>
<a name="l00272"></a>00272 <span class="comment">                    heap-&gt;insertheap(&amp;statespace[newx][newy], key);</span>
<a name="l00273"></a>00273 <span class="comment">                else</span>
<a name="l00274"></a>00274 <span class="comment">                    heap-&gt;updateheap(&amp;statespace[newx][newy], key);</span>
<a name="l00275"></a>00275 <span class="comment">            }</span>
<a name="l00276"></a>00276 <span class="comment">        }</span>
<a name="l00277"></a>00277 <span class="comment">    }</span>
<a name="l00278"></a>00278 <span class="comment"></span>
<a name="l00279"></a>00279 <span class="comment">    //delete the heap</span>
<a name="l00280"></a>00280 <span class="comment">    delete heap;</span>
<a name="l00281"></a>00281 <span class="comment">}</span>
<a name="l00282"></a>00282 <span class="comment">*/</span>
<a name="l00283"></a>00283 
<a name="l00284"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#afd7d9f0e1188050feb3e39b0b74996fe">00284</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#afd7d9f0e1188050feb3e39b0b74996fe">EnvironmentROBARM::Search2DwithQueue</a>(<a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>** statespace, <span class="keywordtype">int</span>* HeurGrid, <span class="keywordtype">int</span> searchstartx, <span class="keywordtype">int</span> searchstarty)
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286     <a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>* ExpState;
<a name="l00287"></a>00287     <span class="keywordtype">int</span> newx, newy, x, y;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="comment">//create a queue</span>
<a name="l00290"></a>00290     queue&lt;State2D*&gt; Queue;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="comment">//initialize to infinity all</span>
<a name="l00293"></a>00293     <span class="keywordflow">for</span> (x = 0; x &lt; EnvROBARMCfg.EnvWidth_c; x++) {
<a name="l00294"></a>00294         <span class="keywordflow">for</span> (y = 0; y &lt; EnvROBARMCfg.EnvHeight_c; y++) {
<a name="l00295"></a>00295             HeurGrid[<a class="code" href="environment__robarm_8cpp.html#a040086b3a5729c12991de632f21bf5ec">XYTO2DIND</a>(x,y)] = <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l00296"></a>00296             ReInitializeState2D(&amp;statespace[x][y]);
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">//initialization</span>
<a name="l00301"></a>00301     statespace[searchstartx][searchstarty].<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae66384d4168ef589ea4d403db10e5e02">g</a> = 0;
<a name="l00302"></a>00302     Queue.push(&amp;statespace[searchstartx][searchstarty]);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="comment">//expand all of the states</span>
<a name="l00305"></a>00305     <span class="keywordflow">while</span> ((<span class="keywordtype">int</span>)Queue.size() &gt; 0) {
<a name="l00306"></a>00306         <span class="comment">//get the state to expand</span>
<a name="l00307"></a>00307         ExpState = Queue.front();
<a name="l00308"></a>00308         Queue.pop();
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         <span class="comment">//it may be that the state is already closed</span>
<a name="l00311"></a>00311         <span class="keywordflow">if</span> (ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ab5079b73bb1681652b181904ec532182">iterationclosed</a> == 1) <span class="keywordflow">continue</span>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         <span class="comment">//close it</span>
<a name="l00314"></a>00314         ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ab5079b73bb1681652b181904ec532182">iterationclosed</a> = 1;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="comment">//set the corresponding heuristics</span>
<a name="l00317"></a>00317         HeurGrid[<a class="code" href="environment__robarm_8cpp.html#a040086b3a5729c12991de632f21bf5ec">XYTO2DIND</a>(ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#a703e8dbd1b5778397b2cdebb5962e7a1">x</a>, ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae598965dcc20e4a74186c9a2033c863b">y</a>)] = ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae66384d4168ef589ea4d403db10e5e02">g</a>;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319         <span class="comment">//iterate through neighbors</span>
<a name="l00320"></a>00320         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; <a class="code" href="environment__robarm_8cpp.html#a3e3d4e9e6ca78f948635651ace96a76c">DIRECTIONS</a>; d++) {
<a name="l00321"></a>00321             newx = ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#a703e8dbd1b5778397b2cdebb5962e7a1">x</a> + <a class="code" href="environment__robarm_8cpp.html#a81993d0f2b730f2ba6b34ebfc3189d8c">dx</a>[d];
<a name="l00322"></a>00322             newy = ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae598965dcc20e4a74186c9a2033c863b">y</a> + <a class="code" href="environment__robarm_8cpp.html#a5355ebd24fef21214f574784f9acaeed">dy</a>[d];
<a name="l00323"></a>00323 
<a name="l00324"></a>00324             <span class="comment">//make sure it is inside the map and has no obstacle</span>
<a name="l00325"></a>00325             <span class="keywordflow">if</span> (0 &gt; newx || newx &gt;= EnvROBARMCfg.EnvWidth_c || 0 &gt; newy || newy &gt;= EnvROBARMCfg.EnvHeight_c
<a name="l00326"></a>00326                 || EnvROBARMCfg.Grid2D[newx][newy] == 1) <span class="keywordflow">continue</span>;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328             <span class="comment">//check</span>
<a name="l00329"></a>00329             <span class="keywordflow">if</span> (statespace[newx][newy].g != <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a> &amp;&amp; statespace[newx][newy].g &gt; ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae66384d4168ef589ea4d403db10e5e02">g</a> + 1) {
<a name="l00330"></a>00330                 <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: incorrect heuristic computation\n&quot;</span>);
<a name="l00331"></a>00331                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00332"></a>00332             }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334             <span class="keywordflow">if</span> (statespace[newx][newy].iterationclosed == 0 &amp;&amp; statespace[newx][newy].g == <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>) {
<a name="l00335"></a>00335                 <span class="comment">//insert into the stack</span>
<a name="l00336"></a>00336                 Queue.push(&amp;statespace[newx][newy]);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338                 <span class="comment">//set the g-value</span>
<a name="l00339"></a>00339                 statespace[newx][newy].<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae66384d4168ef589ea4d403db10e5e02">g</a> = ExpState-&gt;<a class="code" href="struct_s_t_a_t_e2_d__t.html#ae66384d4168ef589ea4d403db10e5e02">g</a> + 1;
<a name="l00340"></a>00340             }
<a name="l00341"></a>00341         }
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343 }
<a name="l00344"></a>00344 
<a name="l00345"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a7f9c9f8ce18e98bfb8674c2cfd182e96">00345</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a7f9c9f8ce18e98bfb8674c2cfd182e96">EnvironmentROBARM::Create2DStateSpace</a>(<a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>*** statespace2D)
<a name="l00346"></a>00346 {
<a name="l00347"></a>00347     <span class="keywordtype">int</span> x, y;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="comment">//allocate a statespace for 2D search</span>
<a name="l00350"></a>00350     *statespace2D = <span class="keyword">new</span> <a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>*[EnvROBARMCfg.EnvWidth_c];
<a name="l00351"></a>00351     <span class="keywordflow">for</span> (x = 0; x &lt; EnvROBARMCfg.EnvWidth_c; x++) {
<a name="l00352"></a>00352         (*statespace2D)[x] = <span class="keyword">new</span> <a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>[EnvROBARMCfg.EnvHeight_c];
<a name="l00353"></a>00353         <span class="keywordflow">for</span> (y = 0; y &lt; EnvROBARMCfg.EnvWidth_c; y++) {
<a name="l00354"></a>00354             InitializeState2D(&amp;(*statespace2D)[x][y], x, y);
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357 }
<a name="l00358"></a>00358 
<a name="l00359"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a98dc1b89caa61517aee7bce6ce41539d">00359</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a98dc1b89caa61517aee7bce6ce41539d">EnvironmentROBARM::Delete2DStateSpace</a>(<a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>*** statespace2D)
<a name="l00360"></a>00360 {
<a name="l00361"></a>00361     <span class="keywordtype">int</span> x;
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <span class="comment">//delete the 2D statespace</span>
<a name="l00364"></a>00364     <span class="keywordflow">for</span> (x = 0; x &lt; EnvROBARMCfg.EnvWidth_c; x++) {
<a name="l00365"></a>00365         <span class="keyword">delete</span>[] (*statespace2D)[x];
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367     <span class="keyword">delete</span> *statespace2D;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a36ca891afaf1339c68429eca760feeb6">00370</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a36ca891afaf1339c68429eca760feeb6">EnvironmentROBARM::ComputeHeuristicValues</a>()
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372     <span class="keywordtype">int</span> i;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Running 2D BFS to compute heuristics\n&quot;</span>);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <span class="comment">//allocate memory</span>
<a name="l00377"></a>00377     <span class="keywordtype">int</span> hsize = <a class="code" href="environment__robarm_8cpp.html#a040086b3a5729c12991de632f21bf5ec">XYTO2DIND</a>(EnvROBARMCfg.EnvWidth_c-1, EnvROBARMCfg.EnvHeight_c-1) + 1;
<a name="l00378"></a>00378     EnvROBARM.Heur = <span class="keyword">new</span> <span class="keywordtype">int</span>*[hsize];
<a name="l00379"></a>00379     <span class="keywordflow">for</span> (i = 0; i &lt; hsize; i++) {
<a name="l00380"></a>00380         EnvROBARM.Heur[i] = <span class="keyword">new</span> <span class="keywordtype">int</span>[hsize];
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="comment">//now compute the heuristics for each goal location</span>
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <a class="code" href="struct_s_t_a_t_e2_d__t.html">State2D</a>** statespace2D;
<a name="l00386"></a>00386     Create2DStateSpace(&amp;statespace2D);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; EnvROBARMCfg.EnvWidth_c; x++) {
<a name="l00389"></a>00389         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; EnvROBARMCfg.EnvHeight_c; y++) {
<a name="l00390"></a>00390             <span class="keywordtype">int</span> hind = <a class="code" href="environment__robarm_8cpp.html#a040086b3a5729c12991de632f21bf5ec">XYTO2DIND</a>(x,y);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392             <span class="comment">//perform the search for pathcosts to x,y and store values in Heur[hind]</span>
<a name="l00393"></a>00393             Search2DwithQueue(statespace2D, &amp;EnvROBARM.Heur[hind][0], x, y);
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395         <span class="comment">//SBPL_PRINTF(&quot;h for %d computed\n&quot;, x);</span>
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397     Delete2DStateSpace(&amp;statespace2D);
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;done\n&quot;</span>);
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="comment">//--------------printing routines---------------------------------------</span>
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 <span class="comment">/*</span>
<a name="l00407"></a>00407 <span class="comment">void EnvironmentROBARM::PrintHeurGrid()</span>
<a name="l00408"></a>00408 <span class="comment">{</span>
<a name="l00409"></a>00409 <span class="comment">    int x,y;</span>
<a name="l00410"></a>00410 <span class="comment"></span>
<a name="l00411"></a>00411 <span class="comment">    for (x = 0; x &lt; EnvROBARMCfg.EnvWidth_c; x++)</span>
<a name="l00412"></a>00412 <span class="comment">    {</span>
<a name="l00413"></a>00413 <span class="comment">        for (y = 0; y &lt; EnvROBARMCfg.EnvHeight_c; y++)</span>
<a name="l00414"></a>00414 <span class="comment">        {</span>
<a name="l00415"></a>00415 <span class="comment">            SBPL_PRINTF(&quot;HeurGrid[%d][%d]=%u\n&quot;, x,y,HeurGrid[x][y]);</span>
<a name="l00416"></a>00416 <span class="comment">        }</span>
<a name="l00417"></a>00417 <span class="comment">        SBPL_PRINTF(&quot;\n&quot;);</span>
<a name="l00418"></a>00418 <span class="comment">    }</span>
<a name="l00419"></a>00419 <span class="comment">}</span>
<a name="l00420"></a>00420 <span class="comment">*/</span>
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a8b14bb12147293cafc9436b8ea692a36">00422</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a8b14bb12147293cafc9436b8ea692a36">EnvironmentROBARM::printangles</a>(FILE* fOut, <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* coord, <span class="keywordtype">bool</span> bGoal, <span class="keywordtype">bool</span> bVerbose, <span class="keywordtype">bool</span> bLocal)
<a name="l00423"></a>00423 {
<a name="l00424"></a>00424     <span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l00425"></a>00425     <span class="keywordtype">int</span> i;
<a name="l00426"></a>00426     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, y;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     ComputeContAngles(coord, angles);
<a name="l00429"></a>00429     <span class="keywordflow">if</span> (bVerbose) <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;angles: &quot;</span>);
<a name="l00430"></a>00430     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00431"></a>00431         <span class="keywordflow">if</span> (!bLocal)
<a name="l00432"></a>00432             <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;%f &quot;</span>, angles[i]);
<a name="l00433"></a>00433         <span class="keywordflow">else</span> {
<a name="l00434"></a>00434             <span class="keywordflow">if</span> (i &gt; 0)
<a name="l00435"></a>00435                 <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;%f &quot;</span>, angles[i] - angles[i - 1]);
<a name="l00436"></a>00436             <span class="keywordflow">else</span>
<a name="l00437"></a>00437                 <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;%f &quot;</span>, angles[i]);
<a name="l00438"></a>00438         }
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440     ComputeEndEffectorPos(angles, &amp;x, &amp;y);
<a name="l00441"></a>00441     <span class="keywordflow">if</span> (bGoal) {
<a name="l00442"></a>00442         x = EnvROBARMCfg.EndEffGoalX_c;
<a name="l00443"></a>00443         y = EnvROBARMCfg.EndEffGoalY_c;
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445     <span class="keywordflow">if</span> (bVerbose)
<a name="l00446"></a>00446         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;endeff: %d %d&quot;</span>, x, y);
<a name="l00447"></a>00447     <span class="keywordflow">else</span>
<a name="l00448"></a>00448         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;%d %d&quot;</span>, x, y);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 <span class="comment">/*</span>
<a name="l00454"></a>00454 <span class="comment">void EnvironmentROBARM::PrintPathRec(State* currentstate, State* searchstartstate, int* cost)</span>
<a name="l00455"></a>00455 <span class="comment">{</span>
<a name="l00456"></a>00456 <span class="comment">    if(currentstate == searchstartstate)</span>
<a name="l00457"></a>00457 <span class="comment">    {</span>
<a name="l00458"></a>00458 <span class="comment">        return;</span>
<a name="l00459"></a>00459 <span class="comment">    }</span>
<a name="l00460"></a>00460 <span class="comment"></span>
<a name="l00461"></a>00461 <span class="comment">    if(currentstate-&gt;g &gt; currentstate-&gt;v)</span>
<a name="l00462"></a>00462 <span class="comment">    {</span>
<a name="l00463"></a>00463 <span class="comment">        SBPL_ERROR(&quot;ERROR: an underconsistent state is encountered on the path\n&quot;);</span>
<a name="l00464"></a>00464 <span class="comment"></span>
<a name="l00465"></a>00465 <span class="comment">#if PLANNER_TYPE == ARA_PLANNER_TYPE</span>
<a name="l00466"></a>00466 <span class="comment">        PrintState(currentstate, stdout);</span>
<a name="l00467"></a>00467 <span class="comment">#endif</span>
<a name="l00468"></a>00468 <span class="comment">        throw new SBPL_Exception();</span>
<a name="l00469"></a>00469 <span class="comment">    }</span>
<a name="l00470"></a>00470 <span class="comment"></span>
<a name="l00471"></a>00471 <span class="comment">    //cost of the transition to the previous state</span>
<a name="l00472"></a>00472 <span class="comment">    *cost = *cost + currentstate-&gt;costtobestnextstate;</span>
<a name="l00473"></a>00473 <span class="comment">    if(*cost &gt; 100000 || currentstate-&gt;g &lt; currentstate-&gt;bestnextstate-&gt;v +</span>
<a name="l00474"></a>00474 <span class="comment">            currentstate-&gt;costtobestnextstate ||</span>
<a name="l00475"></a>00475 <span class="comment">            !IsValidCoord(currentstate-&gt;bestnextstate-&gt;statecoord))</span>
<a name="l00476"></a>00476 <span class="comment">    {</span>
<a name="l00477"></a>00477 <span class="comment">#if PLANNER_TYPE == ARA_PLANNER_TYPE</span>
<a name="l00478"></a>00478 <span class="comment">        SBPL_PRINTF(&quot;currentstate\n&quot;);</span>
<a name="l00479"></a>00479 <span class="comment">        PrintState(currentstate, stdout);</span>
<a name="l00480"></a>00480 <span class="comment">        SBPL_PRINTF(&quot;nextstate\n&quot;);</span>
<a name="l00481"></a>00481 <span class="comment">        PrintState(currentstate-&gt;bestnextstate, stdout);</span>
<a name="l00482"></a>00482 <span class="comment">#endif</span>
<a name="l00483"></a>00483 <span class="comment">        SBPL_PRINTF(&quot;next statecoord IsValid=%d\n&quot;,</span>
<a name="l00484"></a>00484 <span class="comment">                IsValidCoord(currentstate-&gt;bestnextstate-&gt;statecoord));</span>
<a name="l00485"></a>00485 <span class="comment">        SBPL_ERROR(&quot;ERROR: cost of the path too high=%d or incorrect transition\n&quot;, *cost);</span>
<a name="l00486"></a>00486 <span class="comment">        throw new SBPL_Exception();</span>
<a name="l00487"></a>00487 <span class="comment">    }</span>
<a name="l00488"></a>00488 <span class="comment">    //transition itself</span>
<a name="l00489"></a>00489 <span class="comment">    currentstate = currentstate-&gt;bestnextstate;</span>
<a name="l00490"></a>00490 <span class="comment"></span>
<a name="l00491"></a>00491 <span class="comment">    //proceed recursively</span>
<a name="l00492"></a>00492 <span class="comment">#if FORWARD_SEARCH</span>
<a name="l00493"></a>00493 <span class="comment">    PrintPathRec(currentstate, searchstartstate, cost);</span>
<a name="l00494"></a>00494 <span class="comment">    printangles(fSol, currentstate);</span>
<a name="l00495"></a>00495 <span class="comment">#else</span>
<a name="l00496"></a>00496 <span class="comment">    printangles(fSol, currentstate);</span>
<a name="l00497"></a>00497 <span class="comment">    PrintPathRec(currentstate, searchstartstate, cost);</span>
<a name="l00498"></a>00498 <span class="comment">#endif</span>
<a name="l00499"></a>00499 <span class="comment">}</span>
<a name="l00500"></a>00500 <span class="comment"></span>
<a name="l00501"></a>00501 <span class="comment">//prints found path and some statistics</span>
<a name="l00502"></a>00502 <span class="comment">int EnvironmentROBARM::PrintPathStat(double erreps, int* pathcost)</span>
<a name="l00503"></a>00503 <span class="comment">{</span>
<a name="l00504"></a>00504 <span class="comment">    State *goalstate, *startstate;</span>
<a name="l00505"></a>00505 <span class="comment">    short unsigned int coord[NUMOFLINKS];</span>
<a name="l00506"></a>00506 <span class="comment">    int cost = 0;</span>
<a name="l00507"></a>00507 <span class="comment">    int inconssize;</span>
<a name="l00508"></a>00508 <span class="comment"></span>
<a name="l00509"></a>00509 <span class="comment">    goalstate = RobArmStateSpace.goalstate;</span>
<a name="l00510"></a>00510 <span class="comment"></span>
<a name="l00511"></a>00511 <span class="comment">    ComputeCoord(RobArmStateSpace.currentangle, coord);</span>
<a name="l00512"></a>00512 <span class="comment">    startstate = GetState(coord);</span>
<a name="l00513"></a>00513 <span class="comment"></span>
<a name="l00514"></a>00514 <span class="comment">#if FORWARD_SEARCH</span>
<a name="l00515"></a>00515 <span class="comment">    if(goalstate == NULL || goalstate-&gt;bestnextstate == NULL)</span>
<a name="l00516"></a>00516 <span class="comment">    {</span>
<a name="l00517"></a>00517 <span class="comment">        SBPL_PRINTF(&quot;No path is found\n&quot;);</span>
<a name="l00518"></a>00518 <span class="comment">        *pathcost = INFINITECOST;</span>
<a name="l00519"></a>00519 <span class="comment">        return 0;</span>
<a name="l00520"></a>00520 <span class="comment">    }</span>
<a name="l00521"></a>00521 <span class="comment">    PrintPathRec(goalstate, startstate, &amp;cost);</span>
<a name="l00522"></a>00522 <span class="comment">    printangles(fSol, goalstate);</span>
<a name="l00523"></a>00523 <span class="comment">#else</span>
<a name="l00524"></a>00524 <span class="comment">    if(startstate == NULL || startstate-&gt;bestnextstate == NULL)</span>
<a name="l00525"></a>00525 <span class="comment">    {</span>
<a name="l00526"></a>00526 <span class="comment">        SBPL_PRINTF(&quot;No path is found\n&quot;);</span>
<a name="l00527"></a>00527 <span class="comment">        *pathcost = INFINITECOST;</span>
<a name="l00528"></a>00528 <span class="comment">        return 0;</span>
<a name="l00529"></a>00529 <span class="comment">    }</span>
<a name="l00530"></a>00530 <span class="comment">    int goalh = Heuristic(goalstate, startstate);</span>
<a name="l00531"></a>00531 <span class="comment">    if(startstate-&gt;g+startstate-&gt;h &lt; goalh)</span>
<a name="l00532"></a>00532 <span class="comment">    {</span>
<a name="l00533"></a>00533 <span class="comment">        SBPL_ERROR(&quot;ERROR: invalid heuristic. goalh(updated)=%d startg=%d\n&quot;,</span>
<a name="l00534"></a>00534 <span class="comment">                goalh, startstate-&gt;g);</span>
<a name="l00535"></a>00535 <span class="comment">#if PLANNER_TYPE == ARA_PLANNER_TYPE</span>
<a name="l00536"></a>00536 <span class="comment">        PrintState(startstate, stdout);</span>
<a name="l00537"></a>00537 <span class="comment">#endif</span>
<a name="l00538"></a>00538 <span class="comment">        throw new SBPL_Exception();</span>
<a name="l00539"></a>00539 <span class="comment">    }</span>
<a name="l00540"></a>00540 <span class="comment">    else</span>
<a name="l00541"></a>00541 <span class="comment">        SBPL_PRINTF(&quot;goalh=%d startg=%d\n&quot;, goalstate-&gt;h, startstate-&gt;g);</span>
<a name="l00542"></a>00542 <span class="comment">    printangles(fSol, startstate);</span>
<a name="l00543"></a>00543 <span class="comment">    PrintPathRec(startstate, goalstate, &amp;cost);</span>
<a name="l00544"></a>00544 <span class="comment">#endif</span>
<a name="l00545"></a>00545 <span class="comment"></span>
<a name="l00546"></a>00546 <span class="comment">    SBPL_FPRINTF(fSol, &quot;path cost=%d at eps=%f\n&quot;, cost, erreps);</span>
<a name="l00547"></a>00547 <span class="comment">    SBPL_PRINTF(&quot;path cost=%d\n&quot;, cost);</span>
<a name="l00548"></a>00548 <span class="comment"></span>
<a name="l00549"></a>00549 <span class="comment">#if PLANNER_TYPE == ANYASTAR_PLANNER_TYPE</span>
<a name="l00550"></a>00550 <span class="comment">    inconssize = 0;</span>
<a name="l00551"></a>00551 <span class="comment">#else</span>
<a name="l00552"></a>00552 <span class="comment">    inconssize = RobArmStateSpace.inconslist-&gt;currentsize;</span>
<a name="l00553"></a>00553 <span class="comment">#endif</span>
<a name="l00554"></a>00554 <span class="comment"></span>
<a name="l00555"></a>00555 <span class="comment">    SBPL_PRINTF(&quot;open size=%d, incons size=%d\n&quot;,</span>
<a name="l00556"></a>00556 <span class="comment">            RobArmStateSpace.heap-&gt;currentsize, inconssize);</span>
<a name="l00557"></a>00557 <span class="comment">    SBPL_FPRINTF(fSol, &quot;open size=%d, incons size=%d\n&quot;,</span>
<a name="l00558"></a>00558 <span class="comment">            RobArmStateSpace.heap-&gt;currentsize, inconssize);</span>
<a name="l00559"></a>00559 <span class="comment"></span>
<a name="l00560"></a>00560 <span class="comment">    SBPL_FPRINTF(fSol1, &quot;**************\n&quot;);</span>
<a name="l00561"></a>00561 <span class="comment">    SBPL_FFLUSH(fStat);</span>
<a name="l00562"></a>00562 <span class="comment"></span>
<a name="l00563"></a>00563 <span class="comment">    *pathcost = cost;</span>
<a name="l00564"></a>00564 <span class="comment"></span>
<a name="l00565"></a>00565 <span class="comment">    return 1;</span>
<a name="l00566"></a>00566 <span class="comment">}</span>
<a name="l00567"></a>00567 <span class="comment"></span>
<a name="l00568"></a>00568 <span class="comment">void EnvironmentROBARM::PrintInfo()</span>
<a name="l00569"></a>00569 <span class="comment">{</span>
<a name="l00570"></a>00570 <span class="comment">    int i;</span>
<a name="l00571"></a>00571 <span class="comment">    unsigned int statespace_size = 1;</span>
<a name="l00572"></a>00572 <span class="comment">    double fsize = 1.0;</span>
<a name="l00573"></a>00573 <span class="comment"></span>
<a name="l00574"></a>00574 <span class="comment">    SBPL_FPRINTF(fSol, &quot;statespace dim=%d size= &lt;&quot;, NUMOFLINKS);</span>
<a name="l00575"></a>00575 <span class="comment">    SBPL_FPRINTF(fSol1, &quot;%d\n&quot;, NUMOFLINKS);</span>
<a name="l00576"></a>00576 <span class="comment">    for(i = 0; i &lt; NUMOFLINKS; i++)</span>
<a name="l00577"></a>00577 <span class="comment">    {</span>
<a name="l00578"></a>00578 <span class="comment">        statespace_size *= RobArmStateSpace.anglevals[i];</span>
<a name="l00579"></a>00579 <span class="comment">        SBPL_FPRINTF(fSol, &quot;%d &quot;, RobArmStateSpace.anglevals[i]);</span>
<a name="l00580"></a>00580 <span class="comment">        SBPL_FPRINTF(fSol1, &quot;%f &quot;, EnvROBARMCfg.LinkLength_m[i]);</span>
<a name="l00581"></a>00581 <span class="comment">        fsize = fsize*RobArmStateSpace.anglevals[i];</span>
<a name="l00582"></a>00582 <span class="comment">    }</span>
<a name="l00583"></a>00583 <span class="comment">    SBPL_FPRINTF(fSol, &quot;&gt; =&gt; %g\n&quot;, fsize);</span>
<a name="l00584"></a>00584 <span class="comment">    SBPL_FPRINTF(fSol1, &quot;\n&quot;);</span>
<a name="l00585"></a>00585 <span class="comment"></span>
<a name="l00586"></a>00586 <span class="comment">    SBPL_PRINTF(&quot;dimensionality: %d statespace: %u (over 10^%d)\n&quot;, NUMOFLINKS, statespace_size,</span>
<a name="l00587"></a>00587 <span class="comment">            (int)(log10(fsize)));</span>
<a name="l00588"></a>00588 <span class="comment">}</span>
<a name="l00589"></a>00589 <span class="comment"></span>
<a name="l00590"></a>00590 <span class="comment">void PrintCoord(short unsigned int coord[NUMOFLINKS], FILE* fOut)</span>
<a name="l00591"></a>00591 <span class="comment">{</span>
<a name="l00592"></a>00592 <span class="comment">    for(int i = 0; i &lt; NUMOFLINKS; i++)</span>
<a name="l00593"></a>00593 <span class="comment">        SBPL_FPRINTF(fOut, &quot;%d &quot;, coord[i]);</span>
<a name="l00594"></a>00594 <span class="comment">    SBPL_FPRINTF(fOut, &quot;\n&quot;);</span>
<a name="l00595"></a>00595 <span class="comment">}</span>
<a name="l00596"></a>00596 <span class="comment">*/</span>
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="comment">//--------------------Additional domain specific functions--------------------------------------------------</span>
<a name="l00601"></a>00601 
<a name="l00602"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a03ecd5492a0dd455350bf34e006dc7aa">00602</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a03ecd5492a0dd455350bf34e006dc7aa">EnvironmentROBARM::ReadConfiguration</a>(FILE* fCfg)
<a name="l00603"></a>00603 {
<a name="l00604"></a>00604     <span class="keywordtype">char</span> sTemp[1024];
<a name="l00605"></a>00605     <span class="keywordtype">int</span> dTemp;
<a name="l00606"></a>00606     <span class="keywordtype">int</span> x, y, i;
<a name="l00607"></a>00607 
<a name="l00608"></a>00608     <span class="comment">//environmentsize(meters)</span>
<a name="l00609"></a>00609     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00610"></a>00610         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00611"></a>00611         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00614"></a>00614         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00615"></a>00615         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617     EnvROBARMCfg.EnvWidth_m = atof(sTemp);
<a name="l00618"></a>00618     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00619"></a>00619         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00620"></a>00620         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622     EnvROBARMCfg.EnvHeight_m = atof(sTemp);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     <span class="comment">//discretization(cells)</span>
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00626"></a>00626         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00627"></a>00627         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00630"></a>00630         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00631"></a>00631         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633     EnvROBARMCfg.EnvWidth_c = atoi(sTemp);
<a name="l00634"></a>00634     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00635"></a>00635         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00636"></a>00636         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638     EnvROBARMCfg.EnvHeight_c = atoi(sTemp);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     <span class="comment">//basex(cells):</span>
<a name="l00641"></a>00641     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00642"></a>00642         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00643"></a>00643         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00646"></a>00646         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00647"></a>00647         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649     EnvROBARMCfg.BaseX_c = atoi(sTemp);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <span class="comment">//linklengths(meters):</span>
<a name="l00652"></a>00652     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00653"></a>00653         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00654"></a>00654         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00657"></a>00657         <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00658"></a>00658             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00659"></a>00659             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661         EnvROBARMCfg.LinkLength_m[i] = atof(sTemp);
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     <span class="comment">//linkstartangles(degrees):</span>
<a name="l00665"></a>00665     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00666"></a>00666         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00667"></a>00667         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00670"></a>00670         <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00671"></a>00671             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00672"></a>00672             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00673"></a>00673         }
<a name="l00674"></a>00674         EnvROBARMCfg.LinkStartAngles_d[i] = atoi(sTemp);
<a name="l00675"></a>00675     }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     <span class="comment">//endeffectorgoal(cells) or linkgoalangles(degrees):</span>
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00679"></a>00679         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00680"></a>00680         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682     <span class="keywordflow">if</span> (strcmp(sTemp, <span class="stringliteral">&quot;endeffectorgoal(cells):&quot;</span>) == 0) {
<a name="l00683"></a>00683         <span class="comment">//only endeffector is specified</span>
<a name="l00684"></a>00684         <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00685"></a>00685             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00686"></a>00686             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688         EnvROBARMCfg.EndEffGoalX_c = atoi(sTemp);
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00690"></a>00690             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00691"></a>00691             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693         EnvROBARMCfg.EndEffGoalY_c = atoi(sTemp);
<a name="l00694"></a>00694 
<a name="l00695"></a>00695         <span class="comment">//set goalangle to invalid number</span>
<a name="l00696"></a>00696         EnvROBARMCfg.LinkGoalAngles_d[0] = <a class="code" href="environment__robarm_8h.html#a1a00ced62631dfd1c0a4cca2edf15eaa">INVALID_NUMBER</a>;
<a name="l00697"></a>00697     }
<a name="l00698"></a>00698     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(sTemp, <span class="stringliteral">&quot;linkgoalangles(degrees):&quot;</span>) == 0) {
<a name="l00699"></a>00699         <span class="keywordtype">double</span> goalangles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l00700"></a>00700 
<a name="l00701"></a>00701         <span class="comment">//linkgoalangles(degrees): 90.0 180.0 90.0</span>
<a name="l00702"></a>00702         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00703"></a>00703             <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00704"></a>00704                 <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00705"></a>00705                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00706"></a>00706             }
<a name="l00707"></a>00707             EnvROBARMCfg.LinkGoalAngles_d[i] = atoi(sTemp);
<a name="l00708"></a>00708         }
<a name="l00709"></a>00709         <span class="comment">//compute endeffectorgoal(cells):</span>
<a name="l00710"></a>00710         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00711"></a>00711             goalangles[i] = <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a> * (EnvROBARMCfg.LinkGoalAngles_d[i] / 180.0);
<a name="l00712"></a>00712         }
<a name="l00713"></a>00713         ComputeEndEffectorPos(goalangles, &amp;EnvROBARMCfg.EndEffGoalX_c, &amp;EnvROBARMCfg.EndEffGoalY_c);
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715     <span class="keywordflow">else</span> {
<a name="l00716"></a>00716         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid string encountered=%s\n&quot;</span>, sTemp);
<a name="l00717"></a>00717         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     <span class="comment">//allocate the 2D environment</span>
<a name="l00721"></a>00721     EnvROBARMCfg.Grid2D = <span class="keyword">new</span> <span class="keywordtype">char</span>*[EnvROBARMCfg.EnvWidth_c];
<a name="l00722"></a>00722     <span class="keywordflow">for</span> (x = 0; x &lt; EnvROBARMCfg.EnvWidth_c; x++) {
<a name="l00723"></a>00723         EnvROBARMCfg.Grid2D[x] = <span class="keyword">new</span> <span class="keywordtype">char</span>[EnvROBARMCfg.EnvHeight_c];
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     <span class="comment">//environment:</span>
<a name="l00727"></a>00727     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00728"></a>00728         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00729"></a>00729         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731     <span class="keywordflow">for</span> (y = 0; y &lt; EnvROBARMCfg.EnvHeight_c; y++)
<a name="l00732"></a>00732         <span class="keywordflow">for</span> (x = 0; x &lt; EnvROBARMCfg.EnvWidth_c; x++) {
<a name="l00733"></a>00733             <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%d&quot;</span>, &amp;dTemp) != 1) {
<a name="l00734"></a>00734                 <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: incorrect format of config file\n&quot;</span>);
<a name="l00735"></a>00735                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00736"></a>00736             }
<a name="l00737"></a>00737             EnvROBARMCfg.Grid2D[x][y] = dTemp;
<a name="l00738"></a>00738         }
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     <span class="comment">//set additional parameters</span>
<a name="l00741"></a>00741     EnvROBARMCfg.GridCellWidth = EnvROBARMCfg.EnvWidth_m / EnvROBARMCfg.EnvWidth_c;
<a name="l00742"></a>00742     <span class="keywordflow">if</span> (EnvROBARMCfg.GridCellWidth != EnvROBARMCfg.EnvHeight_m / EnvROBARMCfg.EnvHeight_c) {
<a name="l00743"></a>00743         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: The cell should be square\n&quot;</span>);
<a name="l00744"></a>00744         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#af108b4a8473e148ce385e7e96383f185">00748</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#af108b4a8473e148ce385e7e96383f185">EnvironmentROBARM::DiscretizeAngles</a>()
<a name="l00749"></a>00749 {
<a name="l00750"></a>00750     <span class="keywordtype">int</span> i;
<a name="l00751"></a>00751     <span class="keywordtype">double</span> HalfGridCell = EnvROBARMCfg.GridCellWidth / 2.0;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00754"></a>00754         EnvROBARMCfg.angledelta[i] = 2 * asin(HalfGridCell / EnvROBARMCfg.LinkLength_m[i]);
<a name="l00755"></a>00755         EnvROBARMCfg.anglevals[i] = (int)(2.0 * <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a> / EnvROBARMCfg.angledelta[i] + 0.99999999);
<a name="l00756"></a>00756     }
<a name="l00757"></a>00757 }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 <span class="comment">//angles are counterclokwise from 0 to 360 in radians, 0 is the center of bin 0, ...</span>
<a name="l00760"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#af68f40175d4dec514b2e4e7ba9655ea1">00760</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#af68f40175d4dec514b2e4e7ba9655ea1">EnvironmentROBARM::ComputeContAngles</a>(<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> coord[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>], <span class="keywordtype">double</span> angle[NUMOFLINKS])
<a name="l00761"></a>00761 {
<a name="l00762"></a>00762     <span class="keywordtype">int</span> i;
<a name="l00763"></a>00763 
<a name="l00764"></a>00764     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00765"></a>00765         angle[i] = coord[i] * EnvROBARMCfg.angledelta[i];
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00769"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#ad1631ee9f5ca98d08943955d888209ec">00769</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#ad1631ee9f5ca98d08943955d888209ec">EnvironmentROBARM::ComputeCoord</a>(<span class="keywordtype">double</span> angle[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>], <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> coord[NUMOFLINKS])
<a name="l00770"></a>00770 {
<a name="l00771"></a>00771     <span class="keywordtype">int</span> i;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00774"></a>00774         coord[i] = (int)((angle[i] + EnvROBARMCfg.angledelta[i] * 0.5) / EnvROBARMCfg.angledelta[i]);
<a name="l00775"></a>00775         <span class="keywordflow">if</span> (coord[i] == EnvROBARMCfg.anglevals[i]) coord[i] = 0;
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777 }
<a name="l00778"></a>00778 
<a name="l00779"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a9a9fca20f3fd3e61a296319d8ae11e55">00779</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a9a9fca20f3fd3e61a296319d8ae11e55">EnvironmentROBARM::GetHeurBasedonCoord</a>(<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> coord[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>])
<a name="l00780"></a>00780 {
<a name="l00781"></a>00781     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endeffx, endeffy;
<a name="l00782"></a>00782     <span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l00783"></a>00783     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> h;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     ComputeContAngles(coord, angles);
<a name="l00786"></a>00786     ComputeEndEffectorPos(angles, &amp;endeffx, &amp;endeffy);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="preprocessor">#if INFORMED</span>
<a name="l00789"></a>00789 <span class="preprocessor"></span>    h = HeurGrid[endeffx][endeffy];
<a name="l00790"></a>00790 <span class="preprocessor">#else</span>
<a name="l00791"></a>00791 <span class="preprocessor"></span>    h = 0;
<a name="l00792"></a>00792 <span class="preprocessor">#endif</span>
<a name="l00793"></a>00793 <span class="preprocessor"></span>
<a name="l00794"></a>00794     <span class="keywordflow">return</span> h;
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#ad4c709f95fd3233f9d43fd182098b97b">00797</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#ad4c709f95fd3233f9d43fd182098b97b">EnvironmentROBARM::Cell2ContXY</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">double</span> *pX, <span class="keywordtype">double</span> *pY)
<a name="l00798"></a>00798 {
<a name="l00799"></a>00799     *pX = x * EnvROBARMCfg.GridCellWidth + EnvROBARMCfg.GridCellWidth * 0.5;
<a name="l00800"></a>00800     *pY = y * EnvROBARMCfg.GridCellWidth + EnvROBARMCfg.GridCellWidth * 0.5;
<a name="l00801"></a>00801 }
<a name="l00802"></a>00802 
<a name="l00803"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a957e59683a4a0905b5a57cd61911209e">00803</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a957e59683a4a0905b5a57cd61911209e">EnvironmentROBARM::ContXY2Cell</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* pX, <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *pY)
<a name="l00804"></a>00804 {
<a name="l00805"></a>00805     <span class="comment">//take the nearest cell</span>
<a name="l00806"></a>00806     *pX = (int)(x / EnvROBARMCfg.GridCellWidth);
<a name="l00807"></a>00807     <span class="keywordflow">if</span> (x &lt; 0) *pX = 0;
<a name="l00808"></a>00808     <span class="keywordflow">if</span> (*pX &gt;= EnvROBARMCfg.EnvWidth_c) *pX = EnvROBARMCfg.EnvWidth_c - 1;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810     *pY = (int)(y / EnvROBARMCfg.GridCellWidth);
<a name="l00811"></a>00811     <span class="keywordflow">if</span> (y &lt; 0) *pY = 0;
<a name="l00812"></a>00812     <span class="keywordflow">if</span> (*pY &gt;= EnvROBARMCfg.EnvHeight_c) *pY = EnvROBARMCfg.EnvHeight_c - 1;
<a name="l00813"></a>00813 }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 <span class="comment">//returns 1 if end effector within space, 0 otherwise</span>
<a name="l00816"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a56165efdbab8008329436842ddda09b3">00816</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a56165efdbab8008329436842ddda09b3">EnvironmentROBARM::ComputeEndEffectorPos</a>(<span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>], <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* pX, <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* pY)
<a name="l00817"></a>00817 {
<a name="l00818"></a>00818     <span class="keywordtype">double</span> x, y;
<a name="l00819"></a>00819     <span class="keywordtype">int</span> i;
<a name="l00820"></a>00820     <span class="keywordtype">int</span> retval = 1;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     <span class="comment">//start with the base</span>
<a name="l00823"></a>00823     Cell2ContXY(EnvROBARMCfg.BaseX_c, EnvROBARMCfg.EnvHeight_c - 1, &amp;x, &amp;y);
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     <span class="comment">//translate the point along each link</span>
<a name="l00826"></a>00826     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00827"></a>00827         x = x + EnvROBARMCfg.LinkLength_m[i] * cos(angles[i]);
<a name="l00828"></a>00828         y = y - EnvROBARMCfg.LinkLength_m[i] * sin(angles[i]);
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="keywordflow">if</span> (x &lt; 0 || x &gt;= EnvROBARMCfg.EnvWidth_m || y &lt; 0 || y &gt;= EnvROBARMCfg.EnvHeight_m) retval = 0;
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     ContXY2Cell(x, y, pX, pY);
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     <span class="comment">//return 1;</span>
<a name="l00836"></a>00836     <span class="keywordflow">return</span> retval;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 <span class="comment">//if pTestedCells is NULL, then the tested points are not saved and it is more</span>
<a name="l00840"></a>00840 <span class="comment">//efficient as it returns as soon as it sees first invalid point</span>
<a name="l00841"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#afd4e7d570232b2dcea79762a5864288a">00841</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#afd4e7d570232b2dcea79762a5864288a">EnvironmentROBARM::IsValidLineSegment</a>(<span class="keywordtype">double</span> x0, <span class="keywordtype">double</span> y0, <span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1, <span class="keywordtype">char</span> **Grid2D,
<a name="l00842"></a>00842                                           vector&lt;CELLV&gt;* pTestedCells)
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 {
<a name="l00845"></a>00845     <a class="code" href="structbresenham__param__t.html">bresenham_param_t</a> params;
<a name="l00846"></a>00846     <span class="keywordtype">int</span> nX, nY;
<a name="l00847"></a>00847     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nX0, nY0, nX1, nY1;
<a name="l00848"></a>00848     <span class="keywordtype">int</span> retvalue = 1;
<a name="l00849"></a>00849     <a class="code" href="struct_c_e_l_l_v.html">CELLV</a> tempcell;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     <span class="comment">//make sure the line segment is inside the environment</span>
<a name="l00852"></a>00852     <span class="keywordflow">if</span> (x0 &lt; 0 || x0 &gt;= EnvROBARMCfg.EnvWidth_m || x1 &lt; 0 || x1 &gt;= EnvROBARMCfg.EnvWidth_m || y0 &lt; 0 ||
<a name="l00853"></a>00853         y0 &gt;= EnvROBARMCfg.EnvHeight_m || y1 &lt; 0 || y1 &gt;= EnvROBARMCfg.EnvHeight_m)
<a name="l00854"></a>00854     {
<a name="l00855"></a>00855         <span class="keywordflow">return</span> 0;
<a name="l00856"></a>00856     }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     ContXY2Cell(x0, y0, &amp;nX0, &amp;nY0);
<a name="l00859"></a>00859     ContXY2Cell(x1, y1, &amp;nX1, &amp;nY1);
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     <span class="comment">//iterate through the points on the segment</span>
<a name="l00862"></a>00862     <a class="code" href="utils_8h.html#af62dc69ad66097b1ec05818edd55b9e0" title="one of the three functions that correspond to bresenham algorithm of path following this function com...">get_bresenham_parameters</a>(nX0, nY0, nX1, nY1, &amp;params);
<a name="l00863"></a>00863     <span class="keywordflow">do</span> {
<a name="l00864"></a>00864         <a class="code" href="utils_8h.html#acfce3605c3093123122666f4458af1a4" title="one of the three functions that correspond to bresenham algorithm of path following returns current c...">get_current_point</a>(&amp;params, &amp;nX, &amp;nY);
<a name="l00865"></a>00865         <span class="keywordflow">if</span> (Grid2D[nX][nY] == 1) {
<a name="l00866"></a>00866             <span class="keywordflow">if</span> (pTestedCells == NULL)
<a name="l00867"></a>00867                 <span class="keywordflow">return</span> 0;
<a name="l00868"></a>00868             <span class="keywordflow">else</span>
<a name="l00869"></a>00869                 retvalue = 0;
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872         <span class="comment">//insert the tested point</span>
<a name="l00873"></a>00873         <span class="keywordflow">if</span> (pTestedCells) {
<a name="l00874"></a>00874             tempcell.<a class="code" href="struct_c_e_l_l_v.html#a01bd6a9dad4c1a10530aca3081ce1ce6">bIsObstacle</a> = (Grid2D[nX][nY] == 1);
<a name="l00875"></a>00875             tempcell.<a class="code" href="struct_c_e_l_l_v.html#a41da69b42b50bf551688c37be033dc0b">x</a> = nX;
<a name="l00876"></a>00876             tempcell.<a class="code" href="struct_c_e_l_l_v.html#a384b8823d6147fcf729198a531b828a4">y</a> = nY;
<a name="l00877"></a>00877             pTestedCells-&gt;push_back(tempcell);
<a name="l00878"></a>00878         }
<a name="l00879"></a>00879     }
<a name="l00880"></a>00880     <span class="keywordflow">while</span> (<a class="code" href="utils_8h.html#ad41de565a0819d0a080ba59c9c9fe731" title="one of the three functions that correspond to bresenham algorithm of path following moves to the next...">get_next_point</a>(&amp;params));
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     <span class="keywordflow">return</span> retvalue;
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a48ca72cfdf5d9d8781863f1082911eb1">00885</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a48ca72cfdf5d9d8781863f1082911eb1">EnvironmentROBARM::IsValidCoord</a>(<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> coord[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>], <span class="keywordtype">char</span>** Grid2D <span class="comment">/*=NULL*/</span>,
<a name="l00886"></a>00886                                     vector&lt;CELLV&gt;* pTestedCells <span class="comment">/*=NULL*/</span>)
<a name="l00887"></a>00887 {
<a name="l00888"></a>00888     <span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l00889"></a>00889     <span class="keywordtype">int</span> retvalue = 1;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891     <span class="keywordflow">if</span> (Grid2D == NULL) Grid2D = EnvROBARMCfg.Grid2D;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 <span class="preprocessor">#if ENDEFF_CHECK_ONLY</span>
<a name="l00894"></a>00894 <span class="preprocessor"></span>    <span class="keywordtype">int</span> endeffx, endeffy;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     <span class="comment">//just check whether end effector is in valid position</span>
<a name="l00897"></a>00897     ComputeContAngles(coord, angles);
<a name="l00898"></a>00898     <span class="keywordflow">if</span>(ComputeEndEffectorPos(angles, &amp;endeffx, &amp;endeffy) == <span class="keyword">false</span>)
<a name="l00899"></a>00899     <span class="keywordflow">return</span> 0;
<a name="l00900"></a>00900 
<a name="l00901"></a>00901     <span class="comment">//check that it is inside the grid</span>
<a name="l00902"></a>00902     <span class="keywordflow">if</span>(endeffx &lt; 0 || endeffx &gt;= EnvROBARMCfg.EnvWidth_c ||
<a name="l00903"></a>00903        endeffy &lt; 0 || endeffy &gt;= EnvROBARMCfg.EnvHeight_c)
<a name="l00904"></a>00904     {
<a name="l00905"></a>00905         <span class="keywordflow">return</span> 0;
<a name="l00906"></a>00906     }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908     <span class="keywordflow">if</span>(pTestedCells)
<a name="l00909"></a>00909     {
<a name="l00910"></a>00910         <a class="code" href="struct_c_e_l_l_v.html">CELLV</a> tempcell;
<a name="l00911"></a>00911         tempcell.IsObstacle = Grid2D[endeffx][endeffy];
<a name="l00912"></a>00912         tempcell.<a class="code" href="struct_c_e_l_l_v.html#a41da69b42b50bf551688c37be033dc0b">x</a> = endeffx;
<a name="l00913"></a>00913         tempcell.<a class="code" href="struct_c_e_l_l_v.html#a384b8823d6147fcf729198a531b828a4">y</a> = endeffy;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915         pTestedCells-&gt;push_back(tempcell);
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <span class="comment">//check end effector</span>
<a name="l00919"></a>00919     <span class="keywordflow">if</span>(Grid2D[endeffx][endeffy] == 1)
<a name="l00920"></a>00920     <span class="keywordflow">return</span> 0;
<a name="l00921"></a>00921 <span class="preprocessor">#else</span>
<a name="l00922"></a>00922 <span class="preprocessor"></span>    <span class="keywordtype">double</span> x0, y0, x1, y1;
<a name="l00923"></a>00923     <span class="keywordtype">int</span> i;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     <span class="comment">//full check of all the links</span>
<a name="l00926"></a>00926     ComputeContAngles(coord, angles);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="comment">//iterate through all the links</span>
<a name="l00929"></a>00929     Cell2ContXY(EnvROBARMCfg.BaseX_c, EnvROBARMCfg.EnvHeight_c - 1, &amp;x1, &amp;y1);
<a name="l00930"></a>00930     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00931"></a>00931         <span class="comment">//compute the corresponding line segment</span>
<a name="l00932"></a>00932         x0 = x1;
<a name="l00933"></a>00933         y0 = y1;
<a name="l00934"></a>00934         x1 = x0 + EnvROBARMCfg.LinkLength_m[i] * cos(angles[i]);
<a name="l00935"></a>00935         y1 = y0 - EnvROBARMCfg.LinkLength_m[i] * sin(angles[i]);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937         <span class="comment">//check the validity of the corresponding line segment</span>
<a name="l00938"></a>00938         <span class="keywordflow">if</span> (!IsValidLineSegment(x0, y0, x1, y1, Grid2D, pTestedCells)) {
<a name="l00939"></a>00939             <span class="keywordflow">if</span> (pTestedCells == NULL)
<a name="l00940"></a>00940                 <span class="keywordflow">return</span> 0;
<a name="l00941"></a>00941             <span class="keywordflow">else</span>
<a name="l00942"></a>00942                 retvalue = 0;
<a name="l00943"></a>00943         }
<a name="l00944"></a>00944     }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946 <span class="preprocessor">#endif</span>
<a name="l00947"></a>00947 <span class="preprocessor"></span>
<a name="l00948"></a>00948     <span class="keywordflow">return</span> retvalue;
<a name="l00949"></a>00949 }
<a name="l00950"></a>00950 
<a name="l00951"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a39d908d4d333128253268b1fbb35a97b">00951</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a39d908d4d333128253268b1fbb35a97b">EnvironmentROBARM::cost</a>(<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> state1coord[], <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> state2coord[])
<a name="l00952"></a>00952 {
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="keywordflow">if</span> (!IsValidCoord(state1coord) || !IsValidCoord(state2coord)) <span class="keywordflow">return</span> <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 <span class="preprocessor">#if UNIFORM_COST</span>
<a name="l00957"></a>00957 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 1;
<a name="l00958"></a>00958 <span class="preprocessor">#else</span>
<a name="l00959"></a>00959 <span class="preprocessor"></span>    <span class="keywordtype">int</span> i;
<a name="l00960"></a>00960     <span class="comment">//the cost becomes higher as we are closer to the base</span>
<a name="l00961"></a>00961     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00962"></a>00962         <span class="keywordflow">if</span> (state1coord[i] != state2coord[i]) <span class="keywordflow">return</span> (NUMOFLINKS - i);
<a name="l00963"></a>00963         <span class="comment">//return (NUMOFLINKS-i)*(NUMOFLINKS-i);</span>
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: cost on the same states is called:\n&quot;</span>);
<a name="l00967"></a>00967     <span class="comment">//printangles(stdout, state1coord);</span>
<a name="l00968"></a>00968     <span class="comment">//printangles(stdout, state2coord);</span>
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 <span class="preprocessor">#endif</span>
<a name="l00973"></a>00973 <span class="preprocessor"></span>}
<a name="l00974"></a>00974 
<a name="l00975"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#aae2441551de66d742f7772ef30cd8ed9">00975</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#aae2441551de66d742f7772ef30cd8ed9">EnvironmentROBARM::InitializeEnvConfig</a>()
<a name="l00976"></a>00976 {
<a name="l00977"></a>00977     <span class="comment">//find the discretization for each angle and store the discretization</span>
<a name="l00978"></a>00978     DiscretizeAngles();
<a name="l00979"></a>00979 }
<a name="l00980"></a>00980 
<a name="l00981"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#ad37595bf7c68474b452b46989383cb95">00981</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#ad37595bf7c68474b452b46989383cb95">EnvironmentROBARM::InitializeEnvironment</a>()
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> coord[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l00984"></a>00984     <span class="keywordtype">double</span> startangles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l00985"></a>00985     <span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l00986"></a>00986     <span class="keywordtype">int</span> i;
<a name="l00987"></a>00987     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endeffx, endeffy;
<a name="l00988"></a>00988 
<a name="l00989"></a>00989     <span class="comment">//initialize the map from Coord to StateID</span>
<a name="l00990"></a>00990     EnvROBARM.HashTableSize = 32 * 1024; <span class="comment">//should be power of two</span>
<a name="l00991"></a>00991     EnvROBARM.Coord2StateIDHashTable = <span class="keyword">new</span> vector&lt;EnvROBARMHashEntry_t*&gt; [EnvROBARM.HashTableSize];
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     <span class="comment">//initialize the map from StateID to Coord</span>
<a name="l00994"></a>00994     EnvROBARM.StateID2CoordTable.clear();
<a name="l00995"></a>00995 
<a name="l00996"></a>00996     <span class="comment">//initialize the angles of the start states</span>
<a name="l00997"></a>00997     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l00998"></a>00998         startangles[i] = <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a> * (EnvROBARMCfg.LinkStartAngles_d[i] / 180.0);
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     ComputeCoord(startangles, coord);
<a name="l01002"></a>01002     ComputeContAngles(coord, angles);
<a name="l01003"></a>01003     ComputeEndEffectorPos(angles, &amp;endeffx, &amp;endeffy);
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <span class="comment">//create the start state</span>
<a name="l01006"></a>01006     EnvROBARM.startHashEntry = CreateNewHashEntry(coord, NUMOFLINKS, endeffx, endeffy);
<a name="l01007"></a>01007 
<a name="l01008"></a>01008     <span class="comment">//create the goal state </span>
<a name="l01009"></a>01009     <span class="comment">//initialize the coord of goal state</span>
<a name="l01010"></a>01010     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l01011"></a>01011         coord[i] = 0;
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013     EnvROBARM.goalHashEntry = CreateNewHashEntry(coord, NUMOFLINKS, EnvROBARMCfg.EndEffGoalX_c,
<a name="l01014"></a>01014                                                  EnvROBARMCfg.EndEffGoalY_c);
<a name="l01015"></a>01015 
<a name="l01016"></a>01016     <span class="comment">//check the validity of both goal and start configurations</span>
<a name="l01017"></a>01017     <span class="comment">//testing for EnvROBARMCfg.EndEffGoalX_c &lt; 0  and EnvROBARMCfg.EndEffGoalY_c &lt; 0 is useless since they are unsigned </span>
<a name="l01018"></a>01018     <span class="keywordflow">if</span> (!IsValidCoord(EnvROBARM.startHashEntry-&gt;coord) || EnvROBARMCfg.EndEffGoalX_c &gt;= EnvROBARMCfg.EnvWidth_c
<a name="l01019"></a>01019         || EnvROBARMCfg.EndEffGoalY_c &gt;= EnvROBARMCfg.EnvHeight_c) {
<a name="l01020"></a>01020         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Either start or goal configuration is invalid\n&quot;</span>);
<a name="l01021"></a>01021         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01022"></a>01022     }
<a name="l01023"></a>01023 
<a name="l01024"></a>01024     <span class="comment">//for now heuristics are not set</span>
<a name="l01025"></a>01025     EnvROBARM.Heur = NULL;
<a name="l01026"></a>01026 
<a name="l01027"></a>01027     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01028"></a>01028 }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l01031"></a>01031 
<a name="l01032"></a>01032 <span class="comment">//-----------interface with outside functions-----------------------------------</span>
<a name="l01033"></a>01033 
<a name="l01034"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#abc86262b143169eb8033bd73ff7c7aa5">01034</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#abc86262b143169eb8033bd73ff7c7aa5" title="initialize environment from a file (see .cfg files in robotarm directory for example)">EnvironmentROBARM::InitializeEnv</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* sEnvFile)
<a name="l01035"></a>01035 {
<a name="l01036"></a>01036     FILE* fCfg = fopen(sEnvFile, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01037"></a>01037     <span class="keywordflow">if</span> (fCfg == NULL) {
<a name="l01038"></a>01038         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: unable to open %s\n&quot;</span>, sEnvFile);
<a name="l01039"></a>01039         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01040"></a>01040     }
<a name="l01041"></a>01041     ReadConfiguration(fCfg);
<a name="l01042"></a>01042     fclose(fCfg);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     <span class="comment">//Initialize other parameters of the environment</span>
<a name="l01045"></a>01045     InitializeEnvConfig();
<a name="l01046"></a>01046 
<a name="l01047"></a>01047     <span class="comment">//initialize Environment</span>
<a name="l01048"></a>01048     <span class="keywordflow">if</span> (InitializeEnvironment() == <span class="keyword">false</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <span class="comment">//pre-compute heuristics</span>
<a name="l01051"></a>01051     ComputeHeuristicValues();
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01054"></a>01054 }
<a name="l01055"></a>01055 
<a name="l01056"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#aa0b6aca4cd20a19cf5c9dff9d0066f29">01056</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#aa0b6aca4cd20a19cf5c9dff9d0066f29" title="initialize MDP config with IDs of start/goal">EnvironmentROBARM::InitializeMDPCfg</a>(<a class="code" href="struct_m_d_p_config.html">MDPConfig</a> *MDPCfg)
<a name="l01057"></a>01057 {
<a name="l01058"></a>01058     <span class="comment">//initialize MDPCfg with the start and goal ids</span>
<a name="l01059"></a>01059     MDPCfg-&gt;<a class="code" href="struct_m_d_p_config.html#a3817bc7f37248690b80575398593b5cb">goalstateid</a> = EnvROBARM.goalHashEntry-&gt;stateID;
<a name="l01060"></a>01060     MDPCfg-&gt;<a class="code" href="struct_m_d_p_config.html#a955f603f3ac77d95a563b51eb1a49a38">startstateid</a> = EnvROBARM.startHashEntry-&gt;stateID;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01063"></a>01063 }
<a name="l01064"></a>01064 
<a name="l01065"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a2c51eed62a4115aeeea57edacd0c8785">01065</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a2c51eed62a4115aeeea57edacd0c8785" title="see comments on the same function in the parent class">EnvironmentROBARM::GetFromToHeuristic</a>(<span class="keywordtype">int</span> FromStateID, <span class="keywordtype">int</span> ToStateID)
<a name="l01066"></a>01066 {
<a name="l01067"></a>01067 <span class="preprocessor">#if USE_HEUR==0</span>
<a name="l01068"></a>01068 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
<a name="l01069"></a>01069 <span class="preprocessor">#endif</span>
<a name="l01070"></a>01070 <span class="preprocessor"></span>
<a name="l01071"></a>01071 <span class="preprocessor">#if DEBUG</span>
<a name="l01072"></a>01072 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(FromStateID &gt;= (<span class="keywordtype">int</span>)EnvROBARM.StateID2CoordTable.size()
<a name="l01073"></a>01073         || ToStateID &gt;= (int)EnvROBARM.StateID2CoordTable.size())
<a name="l01074"></a>01074     {
<a name="l01075"></a>01075         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM... function: stateID illegal\n&quot;</span>);
<a name="l01076"></a>01076         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01077"></a>01077     }
<a name="l01078"></a>01078 <span class="preprocessor">#endif</span>
<a name="l01079"></a>01079 <span class="preprocessor"></span>
<a name="l01080"></a>01080     <span class="comment">//get X, Y for the state</span>
<a name="l01081"></a>01081     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* FromHashEntry = EnvROBARM.StateID2CoordTable[FromStateID];
<a name="l01082"></a>01082     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* ToHashEntry = EnvROBARM.StateID2CoordTable[ToStateID];
<a name="l01083"></a>01083 
<a name="l01084"></a>01084     <span class="keywordtype">int</span> h =
<a name="l01085"></a>01085             EnvROBARM.Heur[<a class="code" href="environment__robarm_8cpp.html#a040086b3a5729c12991de632f21bf5ec">XYTO2DIND</a>(ToHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a3c2e00865b8a6497e0af07c4ec3a21fe">endeffx</a>, ToHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a0a1085527466008164787ba87a040b49">endeffy</a>)][<a class="code" href="environment__robarm_8cpp.html#a040086b3a5729c12991de632f21bf5ec">XYTO2DIND</a>(FromHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a3c2e00865b8a6497e0af07c4ec3a21fe">endeffx</a>, FromHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a0a1085527466008164787ba87a040b49">endeffy</a>)];
<a name="l01086"></a>01086 
<a name="l01087"></a>01087     <span class="comment">/* </span>
<a name="l01088"></a>01088 <span class="comment">     if(ToStateID != EnvROBARM.goalHashEntry-&gt;stateID)</span>
<a name="l01089"></a>01089 <span class="comment">     {</span>
<a name="l01090"></a>01090 <span class="comment">     //also consider the distanceincoord</span>
<a name="l01091"></a>01091 <span class="comment"></span>
<a name="l01092"></a>01092 <span class="comment">     //get the heuristic based on angles</span>
<a name="l01093"></a>01093 <span class="comment">     unsigned int hangles = distanceincoord(FromHashEntry-&gt;coord, ToHashEntry-&gt;coord);</span>
<a name="l01094"></a>01094 <span class="comment"></span>
<a name="l01095"></a>01095 <span class="comment">     //the heuristic is the max of the two</span>
<a name="l01096"></a>01096 <span class="comment">     h = __max(h, hangles);</span>
<a name="l01097"></a>01097 <span class="comment">     }</span>
<a name="l01098"></a>01098 <span class="comment">     */</span>
<a name="l01099"></a>01099 
<a name="l01100"></a>01100     <span class="keywordflow">return</span> h;
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01103"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a3509162e5332f79ed9350e16fcf37bd6">01103</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a3509162e5332f79ed9350e16fcf37bd6" title="see comments on the same function in the parent class">EnvironmentROBARM::GetGoalHeuristic</a>(<span class="keywordtype">int</span> stateID)
<a name="l01104"></a>01104 {
<a name="l01105"></a>01105 <span class="preprocessor">#if USE_HEUR==0</span>
<a name="l01106"></a>01106 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
<a name="l01107"></a>01107 <span class="preprocessor">#endif</span>
<a name="l01108"></a>01108 <span class="preprocessor"></span>
<a name="l01109"></a>01109 <span class="preprocessor">#if DEBUG</span>
<a name="l01110"></a>01110 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (stateID &gt;= (<span class="keywordtype">int</span>)EnvROBARM.StateID2CoordTable.size()) {
<a name="l01111"></a>01111         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM... function: stateID illegal\n&quot;</span>);
<a name="l01112"></a>01112         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01113"></a>01113     }
<a name="l01114"></a>01114 <span class="preprocessor">#endif</span>
<a name="l01115"></a>01115 <span class="preprocessor"></span>
<a name="l01116"></a>01116     <span class="comment">//define this function if it used in the planner (heuristic forward search would use it)</span>
<a name="l01117"></a>01117     <span class="keywordflow">return</span> GetFromToHeuristic(stateID, EnvROBARM.goalHashEntry-&gt;stateID);
<a name="l01118"></a>01118 }
<a name="l01119"></a>01119 
<a name="l01120"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a5669371d6abedcbaddc61214865f23f2">01120</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a5669371d6abedcbaddc61214865f23f2" title="see comments on the same function in the parent class">EnvironmentROBARM::GetStartHeuristic</a>(<span class="keywordtype">int</span> stateID)
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122 <span class="preprocessor">#if USE_HEUR==0</span>
<a name="l01123"></a>01123 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
<a name="l01124"></a>01124 <span class="preprocessor">#endif</span>
<a name="l01125"></a>01125 <span class="preprocessor"></span>
<a name="l01126"></a>01126 <span class="preprocessor">#if DEBUG</span>
<a name="l01127"></a>01127 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (stateID &gt;= (<span class="keywordtype">int</span>)EnvROBARM.StateID2CoordTable.size()) {
<a name="l01128"></a>01128         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM... function: stateID illegal\n&quot;</span>);
<a name="l01129"></a>01129         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01130"></a>01130     }
<a name="l01131"></a>01131 <span class="preprocessor">#endif</span>
<a name="l01132"></a>01132 <span class="preprocessor"></span>
<a name="l01133"></a>01133     <span class="comment">//define this function if it used in the planner (heuristic backward search would use it)</span>
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM.. function: GetStartHeuristic is undefined\n&quot;</span>);
<a name="l01136"></a>01136     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01137"></a>01137 
<a name="l01138"></a>01138     <span class="keywordflow">return</span> 0;
<a name="l01139"></a>01139 }
<a name="l01140"></a>01140 
<a name="l01141"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a56ac3634ab78d8952eb832e40a2c4800">01141</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a56ac3634ab78d8952eb832e40a2c4800" title="see comments on the same function in the parent class">EnvironmentROBARM::SetAllPreds</a>(<a class="code" href="class_c_m_d_p_s_t_a_t_e.html">CMDPSTATE</a>* state)
<a name="l01142"></a>01142 {
<a name="l01143"></a>01143     <span class="comment">//implement this if the planner needs access to predecessors</span>
<a name="l01144"></a>01144 
<a name="l01145"></a>01145     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM... function: SetAllPreds is undefined\n&quot;</span>);
<a name="l01146"></a>01146     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01147"></a>01147 }
<a name="l01148"></a>01148 
<a name="l01149"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a9dc7c093cf8220ecd653cbf9a566e383">01149</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a9dc7c093cf8220ecd653cbf9a566e383" title="see comments on the same function in the parent class">EnvironmentROBARM::SizeofCreatedEnv</a>()
<a name="l01150"></a>01150 {
<a name="l01151"></a>01151     <span class="keywordflow">return</span> EnvROBARM.StateID2CoordTable.size();
<a name="l01152"></a>01152 }
<a name="l01153"></a>01153 
<a name="l01154"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#af381ad1d659a2ad4730484a36cff1da6">01154</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#af381ad1d659a2ad4730484a36cff1da6" title="see comments on the same function in the parent class">EnvironmentROBARM::PrintState</a>(<span class="keywordtype">int</span> stateID, <span class="keywordtype">bool</span> bVerbose, FILE* fOut <span class="comment">/*=NULL*/</span>)
<a name="l01155"></a>01155 {
<a name="l01156"></a>01156     <span class="keywordtype">bool</span> bLocal = <span class="keyword">false</span>;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158 <span class="preprocessor">#if DEBUG</span>
<a name="l01159"></a>01159 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(stateID &gt;= (<span class="keywordtype">int</span>)EnvROBARM.StateID2CoordTable.size())
<a name="l01160"></a>01160     {
<a name="l01161"></a>01161         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM... function: stateID illegal (2)\n&quot;</span>);
<a name="l01162"></a>01162         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01163"></a>01163     }
<a name="l01164"></a>01164 <span class="preprocessor">#endif</span>
<a name="l01165"></a>01165 <span class="preprocessor"></span>
<a name="l01166"></a>01166     <span class="keywordflow">if</span> (fOut == NULL) fOut = stdout;
<a name="l01167"></a>01167 
<a name="l01168"></a>01168     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* HashEntry = EnvROBARM.StateID2CoordTable[stateID];
<a name="l01169"></a>01169 
<a name="l01170"></a>01170     <span class="keywordtype">bool</span> bGoal = <span class="keyword">false</span>;
<a name="l01171"></a>01171     <span class="keywordflow">if</span> (stateID == EnvROBARM.goalHashEntry-&gt;stateID) bGoal = <span class="keyword">true</span>;
<a name="l01172"></a>01172 
<a name="l01173"></a>01173     <span class="keywordflow">if</span> (stateID == EnvROBARM.goalHashEntry-&gt;stateID &amp;&amp; bVerbose) {
<a name="l01174"></a>01174         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;the state is a goal state\n&quot;</span>);
<a name="l01175"></a>01175         bGoal = <span class="keyword">true</span>;
<a name="l01176"></a>01176     }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178     <span class="keywordflow">if</span> (bLocal) {
<a name="l01179"></a>01179         printangles(fOut, HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>, bGoal, bVerbose, <span class="keyword">true</span>);
<a name="l01180"></a>01180     }
<a name="l01181"></a>01181     <span class="keywordflow">else</span>
<a name="l01182"></a>01182         printangles(fOut, HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>, bGoal, bVerbose, <span class="keyword">false</span>);
<a name="l01183"></a>01183 }
<a name="l01184"></a>01184 
<a name="l01185"></a>01185 <span class="comment">//get the goal as a successor of source state at given cost</span>
<a name="l01186"></a>01186 <span class="comment">//if costtogoal = -1 then the succ is chosen</span>
<a name="l01187"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a28a5430b20b83e0e9bb88345332517bf">01187</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a28a5430b20b83e0e9bb88345332517bf">EnvironmentROBARM::PrintSuccGoal</a>(<span class="keywordtype">int</span> SourceStateID, <span class="keywordtype">int</span> costtogoal, <span class="keywordtype">bool</span> bVerbose, <span class="keywordtype">bool</span> bLocal <span class="comment">/*=false*/</span>,
<a name="l01188"></a>01188                                       FILE* fOut <span class="comment">/*=NULL*/</span>)
<a name="l01189"></a>01189 {
<a name="l01190"></a>01190     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> succcoord[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l01191"></a>01191     <span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l01192"></a>01192     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endeffx, endeffy;
<a name="l01193"></a>01193     <span class="keywordtype">int</span> i, inc;
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="keywordflow">if</span> (fOut == NULL) fOut = stdout;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* HashEntry = EnvROBARM.StateID2CoordTable[SourceStateID];
<a name="l01198"></a>01198 
<a name="l01199"></a>01199     <span class="comment">//default coords of successor</span>
<a name="l01200"></a>01200     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++)
<a name="l01201"></a>01201         succcoord[i] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i];
<a name="l01202"></a>01202 
<a name="l01203"></a>01203     <span class="comment">//iterate through successors of s</span>
<a name="l01204"></a>01204     for (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l01205"></a>01205         <span class="comment">//increase and decrease in ith angle</span>
<a name="l01206"></a>01206         <span class="keywordflow">for</span> (inc = -1; inc &lt; 2; inc = inc + 2) {
<a name="l01207"></a>01207             <span class="keywordflow">if</span> (inc == -1) {
<a name="l01208"></a>01208                 <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i] == 0)
<a name="l01209"></a>01209                     succcoord[i] = EnvROBARMCfg.anglevals[i] - 1;
<a name="l01210"></a>01210                 <span class="keywordflow">else</span>
<a name="l01211"></a>01211                     succcoord[i] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i] + inc;
<a name="l01212"></a>01212             }
<a name="l01213"></a>01213             <span class="keywordflow">else</span> {
<a name="l01214"></a>01214                 succcoord[i] = (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i] + inc) % EnvROBARMCfg.anglevals[i];
<a name="l01215"></a>01215             }
<a name="l01216"></a>01216 
<a name="l01217"></a>01217             <span class="comment">//skip invalid successors</span>
<a name="l01218"></a>01218             <span class="keywordflow">if</span> (!IsValidCoord(succcoord)) <span class="keywordflow">continue</span>;
<a name="l01219"></a>01219 
<a name="l01220"></a>01220             ComputeContAngles(succcoord, angles);
<a name="l01221"></a>01221             ComputeEndEffectorPos(angles, &amp;endeffx, &amp;endeffy);
<a name="l01222"></a>01222             <span class="keywordflow">if</span> (endeffx == EnvROBARMCfg.EndEffGoalX_c &amp;&amp; endeffy == EnvROBARMCfg.EndEffGoalY_c) {
<a name="l01223"></a>01223                 <span class="keywordflow">if</span> (cost(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>, succcoord) == costtogoal || costtogoal == -1) {
<a name="l01224"></a>01224                     <span class="keywordflow">if</span> (bVerbose) <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;the state is a goal state\n&quot;</span>);
<a name="l01225"></a>01225                     printangles(fOut, succcoord, <span class="keyword">true</span>, bVerbose, bLocal);
<a name="l01226"></a>01226                     <span class="keywordflow">return</span>;
<a name="l01227"></a>01227                 }
<a name="l01228"></a>01228             }
<a name="l01229"></a>01229         }
<a name="l01230"></a>01230 
<a name="l01231"></a>01231         <span class="comment">//restore it back</span>
<a name="l01232"></a>01232         succcoord[i] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i];
<a name="l01233"></a>01233     }
<a name="l01234"></a>01234 }
<a name="l01235"></a>01235 
<a name="l01236"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a64a657891dd006c7adc1ce431429e4de">01236</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a64a657891dd006c7adc1ce431429e4de" title="see comments on the same function in the parent class">EnvironmentROBARM::PrintEnv_Config</a>(FILE* fOut)
<a name="l01237"></a>01237 {
<a name="l01238"></a>01238     <span class="comment">//implement this if the planner needs to print out EnvROBARM. configuration</span>
<a name="l01239"></a>01239 
<a name="l01240"></a>01240     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM... function: PrintEnv_Config is undefined\n&quot;</span>);
<a name="l01241"></a>01241     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01244"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#abdbcbacba4e496ff7f2eead41ee5dd96">01244</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#abdbcbacba4e496ff7f2eead41ee5dd96">EnvironmentROBARM::PrintHeader</a>(FILE* fOut)
<a name="l01245"></a>01245 {
<a name="l01246"></a>01246     <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;%d\n&quot;</span>, <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>);
<a name="l01247"></a>01247     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++)
<a name="l01248"></a>01248         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;%.3f &quot;</span>, EnvROBARMCfg.LinkLength_m[i]);
<a name="l01249"></a>01249     <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01250"></a>01250 }
<a name="l01251"></a>01251 
<a name="l01252"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a05db7012d9376e91d97f128d10d0f6b9">01252</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a05db7012d9376e91d97f128d10d0f6b9" title="see comments on the same function in the parent class">EnvironmentROBARM::SetAllActionsandAllOutcomes</a>(<a class="code" href="class_c_m_d_p_s_t_a_t_e.html">CMDPSTATE</a>* state)
<a name="l01253"></a>01253 {
<a name="l01254"></a>01254     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM..function: SetAllActionsandOutcomes is undefined\n&quot;</span>);
<a name="l01255"></a>01255     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01256"></a>01256 }
<a name="l01257"></a>01257 
<a name="l01258"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a9d6703196a08893bede196da75b3b7ba">01258</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a9d6703196a08893bede196da75b3b7ba" title="see comments on the same function in the parent class">EnvironmentROBARM::GetSuccs</a>(<span class="keywordtype">int</span> SourceStateID, vector&lt;int&gt;* SuccIDV, vector&lt;int&gt;* CostV)
<a name="l01259"></a>01259 {
<a name="l01260"></a>01260     <span class="keywordtype">int</span> i, inc;
<a name="l01261"></a>01261     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> succcoord[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l01262"></a>01262     <span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l01263"></a>01263 
<a name="l01264"></a>01264     <span class="comment">//clear the successor array</span>
<a name="l01265"></a>01265     SuccIDV-&gt;clear();
<a name="l01266"></a>01266     CostV-&gt;clear();
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     <span class="comment">//goal state should be absorbing</span>
<a name="l01269"></a>01269     <span class="keywordflow">if</span> (SourceStateID == EnvROBARM.goalHashEntry-&gt;stateID) <span class="keywordflow">return</span>;
<a name="l01270"></a>01270 
<a name="l01271"></a>01271     <span class="comment">//get X, Y for the state</span>
<a name="l01272"></a>01272     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* HashEntry = EnvROBARM.StateID2CoordTable[SourceStateID];
<a name="l01273"></a>01273 
<a name="l01274"></a>01274     <span class="comment">//default coords of successor</span>
<a name="l01275"></a>01275     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++)
<a name="l01276"></a>01276         succcoord[i] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i];
<a name="l01277"></a>01277 
<a name="l01278"></a>01278     <span class="comment">//iterate through successors of s</span>
<a name="l01279"></a>01279     for (i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l01280"></a>01280         <span class="comment">//increase and decrease in ith angle</span>
<a name="l01281"></a>01281         <span class="keywordflow">for</span> (inc = -1; inc &lt; 2; inc = inc + 2) {
<a name="l01282"></a>01282             <span class="keywordflow">if</span> (inc == -1) {
<a name="l01283"></a>01283                 <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i] == 0)
<a name="l01284"></a>01284                     succcoord[i] = EnvROBARMCfg.anglevals[i] - 1;
<a name="l01285"></a>01285                 <span class="keywordflow">else</span>
<a name="l01286"></a>01286                     succcoord[i] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i] + inc;
<a name="l01287"></a>01287             }
<a name="l01288"></a>01288             <span class="keywordflow">else</span> {
<a name="l01289"></a>01289                 succcoord[i] = (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i] + inc) % EnvROBARMCfg.anglevals[i];
<a name="l01290"></a>01290             }
<a name="l01291"></a>01291 
<a name="l01292"></a>01292             <span class="comment">//skip invalid successors</span>
<a name="l01293"></a>01293             <span class="keywordflow">if</span> (!IsValidCoord(succcoord)) <span class="keywordflow">continue</span>;
<a name="l01294"></a>01294 
<a name="l01295"></a>01295             <span class="comment">//get the successor</span>
<a name="l01296"></a>01296             <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* OutHashEntry;
<a name="l01297"></a>01297             <span class="keywordtype">bool</span> bSuccisGoal = <span class="keyword">false</span>;
<a name="l01298"></a>01298             <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endeffx = 0, endeffy = 0;
<a name="l01299"></a>01299             <span class="keywordtype">bool</span> bEndEffComputed = <span class="keyword">false</span>;
<a name="l01300"></a>01300             <span class="keywordflow">if</span> (abs(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a3c2e00865b8a6497e0af07c4ec3a21fe">endeffx</a> - EnvROBARMCfg.EndEffGoalX_c) &lt; 3 || abs(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a0a1085527466008164787ba87a040b49">endeffy</a>
<a name="l01301"></a>01301                 - EnvROBARMCfg.EndEffGoalY_c) &lt; 3) {
<a name="l01302"></a>01302                 <span class="comment">//do a strict checks on the endeff coordinates of the successor</span>
<a name="l01303"></a>01303                 ComputeContAngles(succcoord, angles);
<a name="l01304"></a>01304                 ComputeEndEffectorPos(angles, &amp;endeffx, &amp;endeffy);
<a name="l01305"></a>01305                 <span class="keywordflow">if</span> (endeffx == EnvROBARMCfg.EndEffGoalX_c &amp;&amp; endeffy == EnvROBARMCfg.EndEffGoalY_c) {
<a name="l01306"></a>01306                     bSuccisGoal = <span class="keyword">true</span>;
<a name="l01307"></a>01307                     <span class="comment">//SBPL_PRINTF(&quot;goal succ is generated\n&quot;);</span>
<a name="l01308"></a>01308                 }
<a name="l01309"></a>01309                 bEndEffComputed = <span class="keyword">true</span>;
<a name="l01310"></a>01310             }
<a name="l01311"></a>01311 
<a name="l01312"></a>01312             <span class="keywordflow">if</span> ((OutHashEntry = GetHashEntry(succcoord, NUMOFLINKS, bSuccisGoal)) == NULL) {
<a name="l01313"></a>01313                 <span class="keywordflow">if</span> (bEndEffComputed == <span class="keyword">false</span>) {
<a name="l01314"></a>01314                     ComputeContAngles(succcoord, angles);
<a name="l01315"></a>01315                     ComputeEndEffectorPos(angles, &amp;endeffx, &amp;endeffy);
<a name="l01316"></a>01316                 }
<a name="l01317"></a>01317 
<a name="l01318"></a>01318                 <span class="comment">//have to create a new entry</span>
<a name="l01319"></a>01319                 OutHashEntry = CreateNewHashEntry(succcoord, NUMOFLINKS, endeffx, endeffy);
<a name="l01320"></a>01320             }
<a name="l01321"></a>01321             SuccIDV-&gt;push_back(OutHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>);
<a name="l01322"></a>01322             CostV-&gt;push_back(cost(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>, succcoord));
<a name="l01323"></a>01323         }
<a name="l01324"></a>01324 
<a name="l01325"></a>01325         <span class="comment">//restore it back</span>
<a name="l01326"></a>01326         succcoord[i] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[i];
<a name="l01327"></a>01327     }
<a name="l01328"></a>01328 }
<a name="l01329"></a>01329 
<a name="l01330"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a908c27bf0d49a76dfe26b6379c06c14d">01330</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a908c27bf0d49a76dfe26b6379c06c14d" title="see comments on the same function in the parent class">EnvironmentROBARM::GetPreds</a>(<span class="keywordtype">int</span> TargetStateID, vector&lt;int&gt;* PredIDV, vector&lt;int&gt;* CostV)
<a name="l01331"></a>01331 {
<a name="l01332"></a>01332     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM... function: GetPreds is undefined\n&quot;</span>);
<a name="l01333"></a>01333     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01334"></a>01334 }
<a name="l01335"></a>01335 
<a name="l01336"></a>01336 <span class="comment">//generate succs at some domain-dependent distance - see environment.h for more info</span>
<a name="l01337"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a8e9367c12eb72b1ee18f2249857bafe4">01337</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a8e9367c12eb72b1ee18f2249857bafe4" title="the following two functions generate succs/preds at some domain-dependent distance. The number of generated succs/preds is up to the environment. NOTE: they MUST generate goal state as a succ/pred if it is within the distance from the state CLowV is the corresponding vector of lower bounds on the costs from the state to the successor states (or vice versa for preds function) unless overwritten in a child class, this function is not implemented">EnvironmentROBARM::GetRandomSuccsatDistance</a>(<span class="keywordtype">int</span> SourceStateID, std::vector&lt;int&gt;* SuccIDV, std::vector&lt;int&gt;* CLowV)
<a name="l01338"></a>01338 {
<a name="l01339"></a>01339     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> coord[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l01340"></a>01340     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endeffx, endeffy;
<a name="l01341"></a>01341     <span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l01342"></a>01342 
<a name="l01343"></a>01343     <span class="comment">//clear the successor array</span>
<a name="l01344"></a>01344     SuccIDV-&gt;clear();
<a name="l01345"></a>01345     CLowV-&gt;clear();
<a name="l01346"></a>01346 
<a name="l01347"></a>01347     <span class="comment">//the number of successors</span>
<a name="l01348"></a>01348     <span class="keywordtype">int</span> numofsuccs = <a class="code" href="environment__robarm_8h.html#a7485842f846865fb0b45208412f69d78">ROBARM_NUMOFRANDSUCCSATDIST</a>;
<a name="l01349"></a>01349 
<a name="l01350"></a>01350     <span class="comment">//goal state should be absorbing</span>
<a name="l01351"></a>01351     <span class="keywordflow">if</span> (SourceStateID == EnvROBARM.goalHashEntry-&gt;stateID) <span class="keywordflow">return</span>;
<a name="l01352"></a>01352 
<a name="l01353"></a>01353     <span class="comment">//get X, Y for the state</span>
<a name="l01354"></a>01354     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* HashEntry = EnvROBARM.StateID2CoordTable[SourceStateID];
<a name="l01355"></a>01355 
<a name="l01356"></a>01356     <span class="comment">//iterate through random actions</span>
<a name="l01357"></a>01357     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> succind = 0; succind &lt; numofsuccs; succind++) {
<a name="l01358"></a>01358         <span class="comment">//pick the coordinate that will have dist = longactiondist</span>
<a name="l01359"></a>01359         <span class="keywordtype">int</span> maxcoordind = (int)(<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a> * (((<span class="keywordtype">double</span>)rand()) / RAND_MAX));
<a name="l01360"></a>01360 
<a name="l01361"></a>01361         <span class="comment">//now iterate over the coordinates</span>
<a name="l01362"></a>01362         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cind = 0; cind &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; cind++) {
<a name="l01363"></a>01363 
<a name="l01364"></a>01364             <span class="keywordflow">if</span> (cind == maxcoordind) {
<a name="l01365"></a>01365                 <span class="comment">//we know the magnitude and just need to set sign</span>
<a name="l01366"></a>01366                 <span class="keywordflow">if</span> ((((<span class="keywordtype">double</span>)rand()) / RAND_MAX) &gt; 0.5) {
<a name="l01367"></a>01367                     <span class="comment">//positive sign</span>
<a name="l01368"></a>01368                     coord[cind] = (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[cind] + <a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a>) % EnvROBARMCfg.anglevals[cind];
<a name="l01369"></a>01369                 }
<a name="l01370"></a>01370                 <span class="keywordflow">else</span> {
<a name="l01371"></a>01371                     <span class="comment">//negative sign</span>
<a name="l01372"></a>01372                     <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[cind] &lt; <a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a>)
<a name="l01373"></a>01373                         coord[cind] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[cind] + EnvROBARMCfg.anglevals[cind] -
<a name="l01374"></a>01374                                       <a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a>;
<a name="l01375"></a>01375                     <span class="keywordflow">else</span>
<a name="l01376"></a>01376                         coord[cind] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[cind] - <a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a>;
<a name="l01377"></a>01377                     <span class="comment">//if(coord[cind] &lt; 0)</span>
<a name="l01378"></a>01378                     <span class="comment">//{</span>
<a name="l01379"></a>01379                     <span class="comment">//    SBPL_ERROR(&quot;ERROR: ROBARM_LONGACTIONDIST_CELLS is too large for dim %d\n&quot;, cind);</span>
<a name="l01380"></a>01380                     <span class="comment">//    throw new SBPL_Exception();</span>
<a name="l01381"></a>01381                     <span class="comment">//}</span>
<a name="l01382"></a>01382                 }
<a name="l01383"></a>01383             }
<a name="l01384"></a>01384             <span class="keywordflow">else</span> {
<a name="l01385"></a>01385                 <span class="comment">//any value within ROBARM_LONGACTIONDIST_CELLS from the center</span>
<a name="l01386"></a>01386                 <span class="keywordtype">int</span> offset = (int)(<a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a> * (((<span class="keywordtype">double</span>)rand()) / RAND_MAX));
<a name="l01387"></a>01387                 <span class="keywordflow">if</span> ((((<span class="keywordtype">double</span>)rand()) / RAND_MAX) &gt; 0.5) offset = -offset;
<a name="l01388"></a>01388 
<a name="l01389"></a>01389                 <span class="comment">//we know the magnitude and just need to set sign</span>
<a name="l01390"></a>01390                 <span class="keywordflow">if</span> (offset &gt;= 0) {
<a name="l01391"></a>01391                     <span class="comment">//positive sign</span>
<a name="l01392"></a>01392                     coord[cind] = (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[cind] + offset) % EnvROBARMCfg.anglevals[cind];
<a name="l01393"></a>01393                 }
<a name="l01394"></a>01394                 <span class="keywordflow">else</span> {
<a name="l01395"></a>01395                     <span class="comment">//negative sign</span>
<a name="l01396"></a>01396                     coord[cind] = (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[cind] + offset);
<a name="l01397"></a>01397                     <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[cind] &lt; -offset) coord[cind] = HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>[cind]
<a name="l01398"></a>01398                         + EnvROBARMCfg.anglevals[cind] + offset;
<a name="l01399"></a>01399                     <span class="comment">//if(coord[cind] &lt; 0)</span>
<a name="l01400"></a>01400                     <span class="comment">//{</span>
<a name="l01401"></a>01401                     <span class="comment">//    SBPL_ERROR(&quot;ERROR: ROBARM_LONGACTIONDIST_CELLS is too large for dim %d\n&quot;, cind);</span>
<a name="l01402"></a>01402                     <span class="comment">//    throw new SBPL_Exception();</span>
<a name="l01403"></a>01403                     <span class="comment">//}</span>
<a name="l01404"></a>01404                 }
<a name="l01405"></a>01405             }<span class="comment">//else random offset</span>
<a name="l01406"></a>01406         }<span class="comment">//over coordinates</span>
<a name="l01407"></a>01407 
<a name="l01408"></a>01408         <span class="comment">//skip the invalid sample</span>
<a name="l01409"></a>01409         <span class="keywordflow">if</span> (!IsValidCoord(coord)) <span class="keywordflow">continue</span>;
<a name="l01410"></a>01410 
<a name="l01411"></a>01411         <span class="comment">//clock_t currenttime = clock();</span>
<a name="l01412"></a>01412 
<a name="l01413"></a>01413         <span class="comment">//compute end effector</span>
<a name="l01414"></a>01414         ComputeContAngles(coord, angles);
<a name="l01415"></a>01415         ComputeEndEffectorPos(angles, &amp;endeffx, &amp;endeffy);
<a name="l01416"></a>01416 
<a name="l01417"></a>01417         <span class="comment">//skip the ones whose end-effector is outside</span>
<a name="l01418"></a>01418         <span class="keywordflow">if</span> (abs(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a3c2e00865b8a6497e0af07c4ec3a21fe">endeffx</a> - endeffx) &gt; <a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a> || abs(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a0a1085527466008164787ba87a040b49">endeffy</a> - endeffy)
<a name="l01419"></a>01419             &gt; <a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a>) <span class="keywordflow">continue</span>;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421         <span class="keywordtype">bool</span> bIsGoal = <span class="keyword">false</span>;
<a name="l01422"></a>01422         <span class="keywordflow">if</span> (endeffx == EnvROBARMCfg.EndEffGoalX_c &amp;&amp; endeffy == EnvROBARMCfg.EndEffGoalY_c) {
<a name="l01423"></a>01423             bIsGoal = <span class="keyword">true</span>;
<a name="l01424"></a>01424             <span class="comment">//SBPL_PRINTF(&quot;goal succ is generated\n&quot;);</span>
<a name="l01425"></a>01425         }
<a name="l01426"></a>01426 
<a name="l01427"></a>01427         <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* OutHashEntry = NULL;
<a name="l01428"></a>01428         <span class="keywordflow">if</span> ((OutHashEntry = GetHashEntry(coord, NUMOFLINKS, bIsGoal)) == NULL) {
<a name="l01429"></a>01429             <span class="comment">//have to create a new entry</span>
<a name="l01430"></a>01430             OutHashEntry = CreateNewHashEntry(coord, NUMOFLINKS, endeffx, endeffy);
<a name="l01431"></a>01431         }
<a name="l01432"></a>01432 
<a name="l01433"></a>01433         <span class="comment">//compute clow</span>
<a name="l01434"></a>01434         <span class="keywordtype">int</span> clow;
<a name="l01435"></a>01435         clow = <a class="code" href="class_environment_r_o_b_a_r_m.html#a2c51eed62a4115aeeea57edacd0c8785" title="see comments on the same function in the parent class">EnvironmentROBARM::GetFromToHeuristic</a>(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>, OutHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>);
<a name="l01436"></a>01436 
<a name="l01437"></a>01437         SuccIDV-&gt;push_back(OutHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>);
<a name="l01438"></a>01438         CLowV-&gt;push_back(clow);
<a name="l01439"></a>01439 
<a name="l01440"></a>01440         <span class="comment">//time3_addallout += clock()-currenttime;</span>
<a name="l01441"></a>01441     }
<a name="l01442"></a>01442 
<a name="l01443"></a>01443     <span class="comment">//see if the goal belongs to the inside area and if yes then add it to SUCCS as well</span>
<a name="l01444"></a>01444     <span class="keywordflow">if</span> (abs(EnvROBARMCfg.EndEffGoalX_c - HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a3c2e00865b8a6497e0af07c4ec3a21fe">endeffx</a>) &lt;= <a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a> &amp;&amp;
<a name="l01445"></a>01445         abs(EnvROBARMCfg.EndEffGoalY_c - HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a0a1085527466008164787ba87a040b49">endeffy</a>) &lt;= <a class="code" href="environment__robarm_8h.html#a7daca2c21cdab8f2f6b020e6ff75d46d">ROBARM_LONGACTIONDIST_CELLS</a>)
<a name="l01446"></a>01446     {
<a name="l01447"></a>01447         <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* OutHashEntry = EnvROBARM.goalHashEntry;
<a name="l01448"></a>01448 
<a name="l01449"></a>01449         <span class="keywordtype">int</span> clow = <a class="code" href="class_environment_r_o_b_a_r_m.html#a2c51eed62a4115aeeea57edacd0c8785" title="see comments on the same function in the parent class">EnvironmentROBARM::GetFromToHeuristic</a>(HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>, OutHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>);
<a name="l01450"></a>01450 
<a name="l01451"></a>01451         SuccIDV-&gt;push_back(OutHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>);
<a name="l01452"></a>01452         CLowV-&gt;push_back(clow);
<a name="l01453"></a>01453     }
<a name="l01454"></a>01454 }
<a name="l01455"></a>01455 
<a name="l01456"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#ac13d1fcea0facfdf9ad290adb68a7dfc">01456</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#ac13d1fcea0facfdf9ad290adb68a7dfc">EnvironmentROBARM::GetEdgeCost</a>(<span class="keywordtype">int</span> FromStateID, <span class="keywordtype">int</span> ToStateID)
<a name="l01457"></a>01457 {
<a name="l01458"></a>01458 <span class="preprocessor">#if DEBUG</span>
<a name="l01459"></a>01459 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(FromStateID &gt;= (<span class="keywordtype">int</span>)EnvROBARM.StateID2CoordTable.size() ||
<a name="l01460"></a>01460        ToStateID &gt;= (int)EnvROBARM.StateID2CoordTable.size())
<a name="l01461"></a>01461     {
<a name="l01462"></a>01462         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvROBARM... function: stateID illegal\n&quot;</span>);
<a name="l01463"></a>01463         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01464"></a>01464     }
<a name="l01465"></a>01465 <span class="preprocessor">#endif</span>
<a name="l01466"></a>01466 <span class="preprocessor"></span>
<a name="l01467"></a>01467     <span class="comment">//get X, Y for the state</span>
<a name="l01468"></a>01468     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* FromHashEntry = EnvROBARM.StateID2CoordTable[FromStateID];
<a name="l01469"></a>01469     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* ToHashEntry = EnvROBARM.StateID2CoordTable[ToStateID];
<a name="l01470"></a>01470 
<a name="l01471"></a>01471     <span class="keywordflow">return</span> cost(FromHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>, ToHashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a2cd644463c7983a1c9974e7d471049de">coord</a>);
<a name="l01472"></a>01472 }
<a name="l01473"></a>01473 
<a name="l01474"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a1cd505c9029da66c2815ed38fd45c583">01474</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a1cd505c9029da66c2815ed38fd45c583">EnvironmentROBARM::GetRandomState</a>()
<a name="l01475"></a>01475 {
<a name="l01476"></a>01476     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> coord[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l01477"></a>01477     <span class="keywordtype">double</span> angles[<a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>];
<a name="l01478"></a>01478     <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endeffx, endeffy;
<a name="l01479"></a>01479     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* HashEntry = NULL;
<a name="l01480"></a>01480 
<a name="l01481"></a>01481     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;picking a random state...\n&quot;</span>);
<a name="l01482"></a>01482     <span class="keywordflow">while</span> (1) {
<a name="l01483"></a>01483         <span class="comment">//iterate over links</span>
<a name="l01484"></a>01484         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>; i++) {
<a name="l01485"></a>01485             <span class="comment">//give it a shot</span>
<a name="l01486"></a>01486             coord[i] = (<span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> int)(EnvROBARMCfg.anglevals[i] * (((<span class="keywordtype">double</span>)rand()) / (((<span class="keywordtype">double</span>)RAND_MAX) + 1)));
<a name="l01487"></a>01487         }
<a name="l01488"></a>01488 
<a name="l01489"></a>01489         <span class="comment">/*</span>
<a name="l01490"></a>01490 <span class="comment">        //iterate over links</span>
<a name="l01491"></a>01491 <span class="comment">        double endx[NUMOFLINKS];</span>
<a name="l01492"></a>01492 <span class="comment">        double endy[NUMOFLINKS];</span>
<a name="l01493"></a>01493 <span class="comment">        double x0, y0, x1, y1;</span>
<a name="l01494"></a>01494 <span class="comment"></span>
<a name="l01495"></a>01495 <span class="comment">        for(int i = 0; i &lt; NUMOFLINKS; i++)</span>
<a name="l01496"></a>01496 <span class="comment">        {</span>
<a name="l01497"></a>01497 <span class="comment">            int j = 0;</span>
<a name="l01498"></a>01498 <span class="comment"></span>
<a name="l01499"></a>01499 <span class="comment">            //set the start of the link</span>
<a name="l01500"></a>01500 <span class="comment">            if(i == 0)</span>
<a name="l01501"></a>01501 <span class="comment">                Cell2ContXY(EnvROBARMCfg.BaseX_c, EnvROBARMCfg.EnvHeight_c-1,&amp;x0,&amp;y0);</span>
<a name="l01502"></a>01502 <span class="comment">            else</span>
<a name="l01503"></a>01503 <span class="comment">            {</span>
<a name="l01504"></a>01504 <span class="comment">                x0 = endx[i-1];</span>
<a name="l01505"></a>01505 <span class="comment">                y0 = endy[i-1];</span>
<a name="l01506"></a>01506 <span class="comment">            }</span>
<a name="l01507"></a>01507 <span class="comment"></span>
<a name="l01508"></a>01508 <span class="comment">            //try to set the angle</span>
<a name="l01509"></a>01509 <span class="comment">            int numoftrials = 100;</span>
<a name="l01510"></a>01510 <span class="comment">            for(j = 0; j &lt; numoftrials; j++)</span>
<a name="l01511"></a>01511 <span class="comment">            {</span>
<a name="l01512"></a>01512 <span class="comment">                //give it a shot</span>
<a name="l01513"></a>01513 <span class="comment">                coord[i] = EnvROBARMCfg.anglevals[i]*(((double)rand())/(RAND_MAX+1));</span>
<a name="l01514"></a>01514 <span class="comment"></span>
<a name="l01515"></a>01515 <span class="comment">                //check the new link</span>
<a name="l01516"></a>01516 <span class="comment">                ComputeContAngles(coord, angles);</span>
<a name="l01517"></a>01517 <span class="comment">                x1 = x0 + EnvROBARMCfg.LinkLength_m[i]*cos(angles[i]);</span>
<a name="l01518"></a>01518 <span class="comment">                y1 = y0 - EnvROBARMCfg.LinkLength_m[i]*sin(angles[i]);</span>
<a name="l01519"></a>01519 <span class="comment"></span>
<a name="l01520"></a>01520 <span class="comment">                //check the validity of the corresponding line segment</span>
<a name="l01521"></a>01521 <span class="comment">                if(IsValidLineSegment(x0,y0,x1,y1, EnvROBARMCfg.Grid2D, NULL))</span>
<a name="l01522"></a>01522 <span class="comment">                {</span>
<a name="l01523"></a>01523 <span class="comment">                    break;</span>
<a name="l01524"></a>01524 <span class="comment">                }</span>
<a name="l01525"></a>01525 <span class="comment">            }</span>
<a name="l01526"></a>01526 <span class="comment"></span>
<a name="l01527"></a>01527 <span class="comment">            //see if we found it</span>
<a name="l01528"></a>01528 <span class="comment">            if(j == numoftrials)</span>
<a name="l01529"></a>01529 <span class="comment">            {</span>
<a name="l01530"></a>01530 <span class="comment">                //failed, reset</span>
<a name="l01531"></a>01531 <span class="comment">                SBPL_PRINTF(&quot;have to reset\n&quot;);</span>
<a name="l01532"></a>01532 <span class="comment">                break;</span>
<a name="l01533"></a>01533 <span class="comment">            }</span>
<a name="l01534"></a>01534 <span class="comment">            else</span>
<a name="l01535"></a>01535 <span class="comment">            {</span>
<a name="l01536"></a>01536 <span class="comment">                endx[i] = x1;</span>
<a name="l01537"></a>01537 <span class="comment">                endy[i] = y1;</span>
<a name="l01538"></a>01538 <span class="comment">            }</span>
<a name="l01539"></a>01539 <span class="comment">        }</span>
<a name="l01540"></a>01540 <span class="comment">        */</span>
<a name="l01541"></a>01541 
<a name="l01542"></a>01542         <span class="comment">//if not valid then try something else</span>
<a name="l01543"></a>01543         <span class="keywordflow">if</span> (!IsValidCoord(coord)) {
<a name="l01544"></a>01544             <span class="comment">//SBPL_ERROR(&quot;ERROR: we could not have gotten an invalid sample\n&quot;);</span>
<a name="l01545"></a>01545             <span class="keywordflow">continue</span>;
<a name="l01546"></a>01546         }
<a name="l01547"></a>01547         <span class="keywordflow">else</span>
<a name="l01548"></a>01548             <span class="comment">//done - found</span>
<a name="l01549"></a>01549             <span class="keywordflow">break</span>;
<a name="l01550"></a>01550     }
<a name="l01551"></a>01551     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;done\n&quot;</span>);
<a name="l01552"></a>01552 
<a name="l01553"></a>01553     <span class="comment">//compute end effector</span>
<a name="l01554"></a>01554     ComputeContAngles(coord, angles);
<a name="l01555"></a>01555     ComputeEndEffectorPos(angles, &amp;endeffx, &amp;endeffy);
<a name="l01556"></a>01556     <span class="keywordtype">bool</span> bIsGoal = <span class="keyword">false</span>;
<a name="l01557"></a>01557     <span class="keywordflow">if</span> (endeffx == EnvROBARMCfg.EndEffGoalX_c &amp;&amp; endeffy == EnvROBARMCfg.EndEffGoalY_c) {
<a name="l01558"></a>01558         bIsGoal = <span class="keyword">true</span>;
<a name="l01559"></a>01559         <span class="comment">//SBPL_PRINTF(&quot;goal succ is generated\n&quot;);</span>
<a name="l01560"></a>01560     }
<a name="l01561"></a>01561 
<a name="l01562"></a>01562     <span class="keywordflow">if</span> ((HashEntry = GetHashEntry(coord, <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>, bIsGoal)) == NULL) {
<a name="l01563"></a>01563         <span class="comment">//have to create a new entry</span>
<a name="l01564"></a>01564         HashEntry = CreateNewHashEntry(coord, <a class="code" href="environment__robarm_8h.html#a058ffaa2a8f1a80cdfb429e2d90d6e5f">NUMOFLINKS</a>, endeffx, endeffy);
<a name="l01565"></a>01565     }
<a name="l01566"></a>01566 
<a name="l01567"></a>01567     <span class="keywordflow">return</span> HashEntry-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a1596c06544d54f86cdd2e401cd43ca74">stateID</a>;
<a name="l01568"></a>01568 }
<a name="l01569"></a>01569 
<a name="l01570"></a><a class="code" href="class_environment_r_o_b_a_r_m.html#a77257219cadaa1fa2a2af16097290a32">01570</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_r_o_b_a_r_m.html#a77257219cadaa1fa2a2af16097290a32" title="returns true if two states meet the same condition, brief this is used in some planners to figure out...">EnvironmentROBARM::AreEquivalent</a>(<span class="keywordtype">int</span> State1ID, <span class="keywordtype">int</span> State2ID)
<a name="l01571"></a>01571 {
<a name="l01572"></a>01572     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* HashEntry1 = EnvROBARM.StateID2CoordTable[State1ID];
<a name="l01573"></a>01573     <a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html">EnvROBARMHashEntry_t</a>* HashEntry2 = EnvROBARM.StateID2CoordTable[State2ID];
<a name="l01574"></a>01574 
<a name="l01575"></a>01575     <span class="keywordflow">return</span> (HashEntry1-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a3c2e00865b8a6497e0af07c4ec3a21fe">endeffx</a> == HashEntry2-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a3c2e00865b8a6497e0af07c4ec3a21fe">endeffx</a> &amp;&amp; HashEntry1-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a0a1085527466008164787ba87a040b49">endeffy</a> == HashEntry2-&gt;<a class="code" href="struct_e_n_v_r_o_b_a_r_m_h_a_s_h_e_n_t_r_y.html#a0a1085527466008164787ba87a040b49">endeffy</a>);
<a name="l01576"></a>01576 }
<a name="l01577"></a>01577 
<a name="l01578"></a>01578 <span class="comment">//------------------------------------------------------------------------------</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="environment__robarm_8cpp.html">environment_robarm.cpp</a>      </li>

    <li class="footer">Generated on Thu Mar 21 2013 12:14:23 for SBPL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
