<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SBPL: src/discrete_space_information/environment_navxythetalat.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SBPL
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('environment__navxythetalat_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/discrete_space_information/environment_navxythetalat.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="environment__navxythetalat_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2008, Maxim Likhachev</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> * </span>
<a name="l00005"></a>00005 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00006"></a>00006 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"> * </span>
<a name="l00008"></a>00008 <span class="comment"> *     * Redistributions of source code must retain the above copyright</span>
<a name="l00009"></a>00009 <span class="comment"> *       notice, this list of conditions and the following disclaimer.</span>
<a name="l00010"></a>00010 <span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00011"></a>00011 <span class="comment"> *       notice, this list of conditions and the following disclaimer in the</span>
<a name="l00012"></a>00012 <span class="comment"> *       documentation and/or other materials provided with the distribution.</span>
<a name="l00013"></a>00013 <span class="comment"> *     * Neither the name of the University of Pennsylvania nor the names of its</span>
<a name="l00014"></a>00014 <span class="comment"> *       contributors may be used to endorse or promote products derived from</span>
<a name="l00015"></a>00015 <span class="comment"> *       this software without specific prior written permission.</span>
<a name="l00016"></a>00016 <span class="comment"> * </span>
<a name="l00017"></a>00017 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<a name="l00018"></a>00018 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00019"></a>00019 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00020"></a>00020 <span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<a name="l00021"></a>00021 <span class="comment"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a name="l00022"></a>00022 <span class="comment"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a name="l00023"></a>00023 <span class="comment"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<a name="l00024"></a>00024 <span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<a name="l00025"></a>00025 <span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="l00026"></a>00026 <span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00027"></a>00027 <span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00028"></a>00028 <span class="comment"> */</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;ctime&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="environment__navxythetalat_8h.html">sbpl/discrete_space_information/environment_navxythetalat.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="2_dgridsearch_8h.html">sbpl/utils/2Dgridsearch.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="key_8h.html">sbpl/utils/key.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="mdp_8h.html">sbpl/utils/mdp.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="mdpconfig_8h.html">sbpl/utils/mdpconfig.h</a>&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="keyword">using namespace </span>std;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="keyword">static</span> clock_t time3_addallout = 0;
<a name="l00043"></a>00043 <span class="keyword">static</span> clock_t time_gethash = 0;
<a name="l00044"></a>00044 <span class="keyword">static</span> clock_t time_createhash = 0;
<a name="l00045"></a>00045 <span class="keyword">static</span> clock_t time_getsuccs = 0;
<a name="l00046"></a>00046 <span class="preprocessor">#endif</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048 <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> checks = 0;
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="environment__navxythetalat_8cpp.html#ad0288ed61a50f6443eed0416f679e61f">00050</a> <span class="preprocessor">#define XYTHETA2INDEX(X,Y,THETA) (THETA + X*EnvNAVXYTHETALATCfg.NumThetaDirs + \</span>
<a name="l00051"></a>00051 <span class="preprocessor">                                  Y*EnvNAVXYTHETALATCfg.EnvWidth_c*EnvNAVXYTHETALATCfg.NumThetaDirs)</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a>00053 <span class="comment">//-----------------constructors/destructors-------------------------------</span>
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a225e5721553d45b8d3603cbf874ca3b5">00055</a> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a225e5721553d45b8d3603cbf874ca3b5">EnvironmentNAVXYTHETALATTICE::EnvironmentNAVXYTHETALATTICE</a>()
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057     EnvNAVXYTHETALATCfg.obsthresh = <a class="code" href="environment__navxythetalat_8h.html#a89309eb33e6e4225eb2787a567202253">ENVNAVXYTHETALAT_DEFAULTOBSTHRESH</a>;
<a name="l00058"></a>00058     <span class="comment">//the value that pretty much makes it disabled</span>
<a name="l00059"></a>00059     EnvNAVXYTHETALATCfg.cost_inscribed_thresh = EnvNAVXYTHETALATCfg.obsthresh; 
<a name="l00060"></a>00060     <span class="comment">//the value that pretty much makes it disabled</span>
<a name="l00061"></a>00061     EnvNAVXYTHETALATCfg.cost_possibly_circumscribed_thresh = -1; 
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     grid2Dsearchfromstart = NULL;
<a name="l00064"></a>00064     grid2Dsearchfromgoal = NULL;
<a name="l00065"></a>00065     bNeedtoRecomputeStartHeuristics = <span class="keyword">true</span>;
<a name="l00066"></a>00066     bNeedtoRecomputeGoalHeuristics = <span class="keyword">true</span>;
<a name="l00067"></a>00067     iteration = 0;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069     EnvNAVXYTHETALAT.bInitialized = <span class="keyword">false</span>;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071     EnvNAVXYTHETALATCfg.actionwidth = <a class="code" href="environment__navxythetalat_8h.html#a3f2cb52602461cddc4cf55366c388ea4">NAVXYTHETALAT_DEFAULT_ACTIONWIDTH</a>;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     EnvNAVXYTHETALATCfg.NumThetaDirs = <a class="code" href="environment__navxythetalat_8h.html#a3cf28c4ad26810d8b957047d10418d52">NAVXYTHETALAT_THETADIRS</a>;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075     <span class="comment">//no memory allocated in cfg yet</span>
<a name="l00076"></a>00076     EnvNAVXYTHETALATCfg.Grid2D = NULL;
<a name="l00077"></a>00077     EnvNAVXYTHETALATCfg.ActionsV = NULL;
<a name="l00078"></a>00078     EnvNAVXYTHETALATCfg.PredActionsV = NULL;
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ad393338a6deeb83a4f61ad126ca00ba1">00081</a> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ad393338a6deeb83a4f61ad126ca00ba1">EnvironmentNAVXYTHETALATTICE::~EnvironmentNAVXYTHETALATTICE</a>()
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;destroying XYTHETALATTICE\n&quot;</span>);
<a name="l00084"></a>00084     <span class="keywordflow">if</span> (grid2Dsearchfromstart != NULL) <span class="keyword">delete</span> grid2Dsearchfromstart;
<a name="l00085"></a>00085     grid2Dsearchfromstart = NULL;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (grid2Dsearchfromgoal != NULL) <span class="keyword">delete</span> grid2Dsearchfromgoal;
<a name="l00088"></a>00088     grid2Dsearchfromgoal = NULL;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.Grid2D != NULL) {
<a name="l00091"></a>00091         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; EnvNAVXYTHETALATCfg.EnvWidth_c; x++)
<a name="l00092"></a>00092             <span class="keyword">delete</span>[] EnvNAVXYTHETALATCfg.Grid2D[x];
<a name="l00093"></a>00093         <span class="keyword">delete</span>[] EnvNAVXYTHETALATCfg.Grid2D;
<a name="l00094"></a>00094         EnvNAVXYTHETALATCfg.Grid2D = NULL;
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="comment">//delete actions</span>
<a name="l00098"></a>00098     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.ActionsV != NULL) {
<a name="l00099"></a>00099         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> tind = 0; tind &lt; EnvNAVXYTHETALATCfg.NumThetaDirs; tind++)
<a name="l00100"></a>00100             <span class="keyword">delete</span>[] EnvNAVXYTHETALATCfg.ActionsV[tind];
<a name="l00101"></a>00101         <span class="keyword">delete</span>[] EnvNAVXYTHETALATCfg.ActionsV;
<a name="l00102"></a>00102         EnvNAVXYTHETALATCfg.ActionsV = NULL;
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.PredActionsV != NULL) {
<a name="l00105"></a>00105         <span class="keyword">delete</span>[] EnvNAVXYTHETALATCfg.PredActionsV;
<a name="l00106"></a>00106         EnvNAVXYTHETALATCfg.PredActionsV = NULL;
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">//---------------------------------------------------------------------</span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="comment">//-------------------problem specific and local functions---------------------</span>
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> inthash(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key)
<a name="l00115"></a>00115 {
<a name="l00116"></a>00116     key += (key &lt;&lt; 12);
<a name="l00117"></a>00117     key ^= (key &gt;&gt; 22);
<a name="l00118"></a>00118     key += (key &lt;&lt; 4);
<a name="l00119"></a>00119     key ^= (key &gt;&gt; 9);
<a name="l00120"></a>00120     key += (key &lt;&lt; 10);
<a name="l00121"></a>00121     key ^= (key &gt;&gt; 2);
<a name="l00122"></a>00122     key += (key &lt;&lt; 7);
<a name="l00123"></a>00123     key ^= (key &gt;&gt; 12);
<a name="l00124"></a>00124     <span class="keywordflow">return</span> key;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#af16d41b5d5933f9ec92d3222610bfd09">00127</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#af16d41b5d5933f9ec92d3222610bfd09">EnvironmentNAVXYTHETALATTICE::SetConfiguration</a>(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* mapdata, <span class="keywordtype">int</span> startx,
<a name="l00128"></a>00128                                                     <span class="keywordtype">int</span> starty, <span class="keywordtype">int</span> starttheta, <span class="keywordtype">int</span> goalx, <span class="keywordtype">int</span> goaly, <span class="keywordtype">int</span> goaltheta,
<a name="l00129"></a>00129                                                     <span class="keywordtype">double</span> cellsize_m, <span class="keywordtype">double</span> nominalvel_mpersecs,
<a name="l00130"></a>00130                                                     <span class="keywordtype">double</span> timetoturn45degsinplace_secs,
<a name="l00131"></a>00131                                                     <span class="keyword">const</span> vector&lt;sbpl_2Dpt_t&gt; &amp; robot_perimeterV)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     EnvNAVXYTHETALATCfg.EnvWidth_c = width;
<a name="l00134"></a>00134     EnvNAVXYTHETALATCfg.EnvHeight_c = height;
<a name="l00135"></a>00135     EnvNAVXYTHETALATCfg.StartX_c = startx;
<a name="l00136"></a>00136     EnvNAVXYTHETALATCfg.StartY_c = starty;
<a name="l00137"></a>00137     EnvNAVXYTHETALATCfg.StartTheta = starttheta;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.StartX_c &lt; 0 || EnvNAVXYTHETALATCfg.StartX_c &gt;= EnvNAVXYTHETALATCfg.EnvWidth_c) {
<a name="l00140"></a>00140         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal start coordinates\n&quot;</span>);
<a name="l00141"></a>00141         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.StartY_c &lt; 0 || EnvNAVXYTHETALATCfg.StartY_c &gt;= EnvNAVXYTHETALATCfg.EnvHeight_c) {
<a name="l00144"></a>00144         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal start coordinates\n&quot;</span>);
<a name="l00145"></a>00145         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.StartTheta &lt; 0 || EnvNAVXYTHETALATCfg.StartTheta &gt;= EnvNAVXYTHETALATCfg.NumThetaDirs) {
<a name="l00148"></a>00148         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal start coordinates for theta\n&quot;</span>);
<a name="l00149"></a>00149         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     EnvNAVXYTHETALATCfg.EndX_c = goalx;
<a name="l00153"></a>00153     EnvNAVXYTHETALATCfg.EndY_c = goaly;
<a name="l00154"></a>00154     EnvNAVXYTHETALATCfg.EndTheta = goaltheta;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.EndX_c &lt; 0 || EnvNAVXYTHETALATCfg.EndX_c &gt;= EnvNAVXYTHETALATCfg.EnvWidth_c) {
<a name="l00157"></a>00157         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal goal coordinates\n&quot;</span>);
<a name="l00158"></a>00158         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.EndY_c &lt; 0 || EnvNAVXYTHETALATCfg.EndY_c &gt;= EnvNAVXYTHETALATCfg.EnvHeight_c) {
<a name="l00161"></a>00161         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal goal coordinates\n&quot;</span>);
<a name="l00162"></a>00162         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.EndTheta &lt; 0 || EnvNAVXYTHETALATCfg.EndTheta &gt;= EnvNAVXYTHETALATCfg.NumThetaDirs) {
<a name="l00165"></a>00165         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal goal coordinates for theta\n&quot;</span>);
<a name="l00166"></a>00166         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     EnvNAVXYTHETALATCfg.FootprintPolygon = robot_perimeterV;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     EnvNAVXYTHETALATCfg.nominalvel_mpersecs = nominalvel_mpersecs;
<a name="l00172"></a>00172     EnvNAVXYTHETALATCfg.cellsize_m = cellsize_m;
<a name="l00173"></a>00173     EnvNAVXYTHETALATCfg.timetoturn45degsinplace_secs = timetoturn45degsinplace_secs;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="comment">//allocate the 2D environment</span>
<a name="l00176"></a>00176     EnvNAVXYTHETALATCfg.Grid2D = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*[EnvNAVXYTHETALATCfg.EnvWidth_c];
<a name="l00177"></a>00177     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; EnvNAVXYTHETALATCfg.EnvWidth_c; x++) {
<a name="l00178"></a>00178         EnvNAVXYTHETALATCfg.Grid2D[x] = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[EnvNAVXYTHETALATCfg.EnvHeight_c];
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <span class="comment">//environment:</span>
<a name="l00182"></a>00182     <span class="keywordflow">if</span> (0 == mapdata) {
<a name="l00183"></a>00183         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; EnvNAVXYTHETALATCfg.EnvHeight_c; y++) {
<a name="l00184"></a>00184             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; EnvNAVXYTHETALATCfg.EnvWidth_c; x++) {
<a name="l00185"></a>00185                 EnvNAVXYTHETALATCfg.Grid2D[x][y] = 0;
<a name="l00186"></a>00186             }
<a name="l00187"></a>00187         }
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189     <span class="keywordflow">else</span> {
<a name="l00190"></a>00190         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; EnvNAVXYTHETALATCfg.EnvHeight_c; y++) {
<a name="l00191"></a>00191             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; EnvNAVXYTHETALATCfg.EnvWidth_c; x++) {
<a name="l00192"></a>00192                 EnvNAVXYTHETALATCfg.Grid2D[x][y] = mapdata[x + y * width];
<a name="l00193"></a>00193             }
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#aba831d6c7b4637500f4413e8e6378d77">00198</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#aba831d6c7b4637500f4413e8e6378d77">EnvironmentNAVXYTHETALATTICE::ReadConfiguration</a>(FILE* fCfg)
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200     <span class="comment">//read in the configuration of environment and initialize  EnvNAVXYTHETALATCfg structure</span>
<a name="l00201"></a>00201     <span class="keywordtype">char</span> sTemp[1024], sTemp1[1024];
<a name="l00202"></a>00202     <span class="keywordtype">int</span> dTemp;
<a name="l00203"></a>00203     <span class="keywordtype">int</span> x, y;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="comment">//discretization(cells)</span>
<a name="l00206"></a>00206     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00207"></a>00207         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early (discretization)\n&quot;</span>);
<a name="l00208"></a>00208         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210     strcpy(sTemp1, <span class="stringliteral">&quot;discretization(cells):&quot;</span>);
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00212"></a>00212         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: configuration file has incorrect format (discretization)\n&quot;</span>);
<a name="l00213"></a>00213         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Expected %s got %s\n&quot;</span>, sTemp1, sTemp);
<a name="l00214"></a>00214         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00217"></a>00217         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early (discretization)\n&quot;</span>);
<a name="l00218"></a>00218         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     EnvNAVXYTHETALATCfg.EnvWidth_c = atoi(sTemp);
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00222"></a>00222         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early (discretization)\n&quot;</span>);
<a name="l00223"></a>00223         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225     EnvNAVXYTHETALATCfg.EnvHeight_c = atoi(sTemp);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">// Scan for optional NumThetaDirs parameter. Check for following obsthresh.</span>
<a name="l00228"></a>00228     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00229"></a>00229         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00230"></a>00230         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232     strcpy(sTemp1, <span class="stringliteral">&quot;NumThetaDirs:&quot;</span>);
<a name="l00233"></a>00233     <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00234"></a>00234         <span class="comment">// optional NumThetaDirs not available; default is NAVXYTHETALAT_THETADIRS (16)</span>
<a name="l00235"></a>00235         strcpy(sTemp1, <span class="stringliteral">&quot;obsthresh:&quot;</span>);
<a name="l00236"></a>00236         <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00237"></a>00237             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: configuration file has incorrect format\n&quot;</span>);
<a name="l00238"></a>00238             <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Expected %s got %s\n&quot;</span>, sTemp1, sTemp);
<a name="l00239"></a>00239             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241         <span class="keywordflow">else</span> {
<a name="l00242"></a>00242             EnvNAVXYTHETALATCfg.NumThetaDirs = <a class="code" href="environment__navxythetalat_8h.html#a3cf28c4ad26810d8b957047d10418d52">NAVXYTHETALAT_THETADIRS</a>;
<a name="l00243"></a>00243         }
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245     <span class="keywordflow">else</span> {
<a name="l00246"></a>00246         <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00247"></a>00247             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early (NumThetaDirs)\n&quot;</span>);
<a name="l00248"></a>00248             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250         EnvNAVXYTHETALATCfg.NumThetaDirs = atoi(sTemp);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <span class="comment">//obsthresh: </span>
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00254"></a>00254             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early (obsthresh)\n&quot;</span>);
<a name="l00255"></a>00255             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00256"></a>00256         }
<a name="l00257"></a>00257         strcpy(sTemp1, <span class="stringliteral">&quot;obsthresh:&quot;</span>);
<a name="l00258"></a>00258         <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00259"></a>00259             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: configuration file has incorrect format\n&quot;</span>);
<a name="l00260"></a>00260             <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Expected %s got %s\n&quot;</span>, sTemp1, sTemp);
<a name="l00261"></a>00261             <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;see existing examples of env files for the right format of heading\n&quot;</span>);
<a name="l00262"></a>00262             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="comment">// obsthresh</span>
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00268"></a>00268         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00269"></a>00269         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271     EnvNAVXYTHETALATCfg.obsthresh = atoi(sTemp);
<a name="l00272"></a>00272     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;obsthresh = %d\n&quot;</span>, EnvNAVXYTHETALATCfg.obsthresh);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="comment">//cost_inscribed_thresh: </span>
<a name="l00275"></a>00275     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00276"></a>00276         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00277"></a>00277         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279     strcpy(sTemp1, <span class="stringliteral">&quot;cost_inscribed_thresh:&quot;</span>);
<a name="l00280"></a>00280     <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00281"></a>00281         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: configuration file has incorrect format\n&quot;</span>);
<a name="l00282"></a>00282         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Expected %s got %s\n&quot;</span>, sTemp1, sTemp);
<a name="l00283"></a>00283         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;see existing examples of env files for the right format of heading\n&quot;</span>);
<a name="l00284"></a>00284         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00285"></a>00285     }
<a name="l00286"></a>00286     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00287"></a>00287         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00288"></a>00288         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290     EnvNAVXYTHETALATCfg.cost_inscribed_thresh = atoi(sTemp);
<a name="l00291"></a>00291     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;cost_inscribed_thresh = %d\n&quot;</span>, EnvNAVXYTHETALATCfg.cost_inscribed_thresh);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <span class="comment">//cost_possibly_circumscribed_thresh: </span>
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00295"></a>00295         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00296"></a>00296         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298     strcpy(sTemp1, <span class="stringliteral">&quot;cost_possibly_circumscribed_thresh:&quot;</span>);
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00300"></a>00300         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: configuration file has incorrect format\n&quot;</span>);
<a name="l00301"></a>00301         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Expected %s got %s\n&quot;</span>, sTemp1, sTemp);
<a name="l00302"></a>00302         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;see existing examples of env files for the right format of heading\n&quot;</span>);
<a name="l00303"></a>00303         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00306"></a>00306         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00307"></a>00307         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     EnvNAVXYTHETALATCfg.cost_possibly_circumscribed_thresh = atoi(sTemp);
<a name="l00310"></a>00310     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;cost_possibly_circumscribed_thresh = %d\n&quot;</span>, EnvNAVXYTHETALATCfg.cost_possibly_circumscribed_thresh);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="comment">//cellsize</span>
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00314"></a>00314         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00315"></a>00315         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317     strcpy(sTemp1, <span class="stringliteral">&quot;cellsize(meters):&quot;</span>);
<a name="l00318"></a>00318     <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00319"></a>00319         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: configuration file has incorrect format\n&quot;</span>);
<a name="l00320"></a>00320         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Expected %s got %s\n&quot;</span>, sTemp1, sTemp);
<a name="l00321"></a>00321         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00324"></a>00324         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00325"></a>00325         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00326"></a>00326     }
<a name="l00327"></a>00327     EnvNAVXYTHETALATCfg.cellsize_m = atof(sTemp);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">//speeds</span>
<a name="l00330"></a>00330     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00331"></a>00331         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00332"></a>00332         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334     strcpy(sTemp1, <span class="stringliteral">&quot;nominalvel(mpersecs):&quot;</span>);
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00336"></a>00336         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: configuration file has incorrect format\n&quot;</span>);
<a name="l00337"></a>00337         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Expected %s got %s\n&quot;</span>, sTemp1, sTemp);
<a name="l00338"></a>00338         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00341"></a>00341         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00342"></a>00342         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344     EnvNAVXYTHETALATCfg.nominalvel_mpersecs = atof(sTemp);
<a name="l00345"></a>00345     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00346"></a>00346         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00347"></a>00347         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00348"></a>00348     }
<a name="l00349"></a>00349     strcpy(sTemp1, <span class="stringliteral">&quot;timetoturn45degsinplace(secs):&quot;</span>);
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (strcmp(sTemp1, sTemp) != 0) {
<a name="l00351"></a>00351         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: configuration file has incorrect format\n&quot;</span>);
<a name="l00352"></a>00352         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Expected %s got %s\n&quot;</span>, sTemp1, sTemp);
<a name="l00353"></a>00353         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00356"></a>00356         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00357"></a>00357         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359     EnvNAVXYTHETALATCfg.timetoturn45degsinplace_secs = atof(sTemp);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="comment">//start(meters,rads):</span>
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00363"></a>00363         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00364"></a>00364         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00367"></a>00367         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00368"></a>00368         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00369"></a>00369     }
<a name="l00370"></a>00370     EnvNAVXYTHETALATCfg.StartX_c = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(atof(sTemp), EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00372"></a>00372         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00373"></a>00373         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375     EnvNAVXYTHETALATCfg.StartY_c = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(atof(sTemp), EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00376"></a>00376     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00377"></a>00377         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00378"></a>00378         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380     EnvNAVXYTHETALATCfg.StartTheta = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(atof(sTemp), EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.StartX_c &lt; 0 || EnvNAVXYTHETALATCfg.StartX_c &gt;= EnvNAVXYTHETALATCfg.EnvWidth_c) {
<a name="l00383"></a>00383         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal start coordinates\n&quot;</span>);
<a name="l00384"></a>00384         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.StartY_c &lt; 0 || EnvNAVXYTHETALATCfg.StartY_c &gt;= EnvNAVXYTHETALATCfg.EnvHeight_c) {
<a name="l00387"></a>00387         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal start coordinates\n&quot;</span>);
<a name="l00388"></a>00388         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.StartTheta &lt; 0 || EnvNAVXYTHETALATCfg.StartTheta &gt;= EnvNAVXYTHETALATCfg.NumThetaDirs) {
<a name="l00391"></a>00391         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal start coordinates for theta\n&quot;</span>);
<a name="l00392"></a>00392         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="comment">//end(meters,rads):</span>
<a name="l00396"></a>00396     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00397"></a>00397         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00398"></a>00398         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00401"></a>00401         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00402"></a>00402         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404     EnvNAVXYTHETALATCfg.EndX_c = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(atof(sTemp), EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00406"></a>00406         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00407"></a>00407         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409     EnvNAVXYTHETALATCfg.EndY_c = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(atof(sTemp), EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00410"></a>00410     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00411"></a>00411         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00412"></a>00412         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414     EnvNAVXYTHETALATCfg.EndTheta = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(atof(sTemp), EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00415"></a>00415     ;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.EndX_c &lt; 0 || EnvNAVXYTHETALATCfg.EndX_c &gt;= EnvNAVXYTHETALATCfg.EnvWidth_c) {
<a name="l00418"></a>00418         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal end coordinates\n&quot;</span>);
<a name="l00419"></a>00419         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.EndY_c &lt; 0 || EnvNAVXYTHETALATCfg.EndY_c &gt;= EnvNAVXYTHETALATCfg.EnvHeight_c) {
<a name="l00422"></a>00422         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal end coordinates\n&quot;</span>);
<a name="l00423"></a>00423         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.EndTheta &lt; 0 || EnvNAVXYTHETALATCfg.EndTheta &gt;= EnvNAVXYTHETALATCfg.NumThetaDirs) {
<a name="l00426"></a>00426         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: illegal goal coordinates for theta\n&quot;</span>);
<a name="l00427"></a>00427         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="comment">//allocate the 2D environment</span>
<a name="l00431"></a>00431     EnvNAVXYTHETALATCfg.Grid2D = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*[EnvNAVXYTHETALATCfg.EnvWidth_c];
<a name="l00432"></a>00432     <span class="keywordflow">for</span> (x = 0; x &lt; EnvNAVXYTHETALATCfg.EnvWidth_c; x++) {
<a name="l00433"></a>00433         EnvNAVXYTHETALATCfg.Grid2D[x] = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[EnvNAVXYTHETALATCfg.EnvHeight_c];
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <span class="comment">//environment:</span>
<a name="l00437"></a>00437     <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) != 1) {
<a name="l00438"></a>00438         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: ran out of env file early\n&quot;</span>);
<a name="l00439"></a>00439         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441     <span class="keywordflow">for</span> (y = 0; y &lt; EnvNAVXYTHETALATCfg.EnvHeight_c; y++)
<a name="l00442"></a>00442         <span class="keywordflow">for</span> (x = 0; x &lt; EnvNAVXYTHETALATCfg.EnvWidth_c; x++) {
<a name="l00443"></a>00443             <span class="keywordflow">if</span> (fscanf(fCfg, <span class="stringliteral">&quot;%d&quot;</span>, &amp;dTemp) != 1) {
<a name="l00444"></a>00444                 <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: incorrect format of config file\n&quot;</span>);
<a name="l00445"></a>00445                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447             EnvNAVXYTHETALATCfg.Grid2D[x][y] = dTemp;
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 
<a name="l00451"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a8b70a8010d37fb663ef7f2a2b55fd7d3">00451</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a8b70a8010d37fb663ef7f2a2b55fd7d3">EnvironmentNAVXYTHETALATTICE::ReadinCell</a>(<a class="code" href="classsbpl__xy__theta__cell__t.html">sbpl_xy_theta_cell_t</a>* cell, FILE* fIn)
<a name="l00452"></a>00452 {
<a name="l00453"></a>00453     <span class="keywordtype">char</span> sTemp[60];
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00456"></a>00456     cell-&gt;<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = atoi(sTemp);
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00458"></a>00458     cell-&gt;<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = atoi(sTemp);
<a name="l00459"></a>00459     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00460"></a>00460     cell-&gt;<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = atoi(sTemp);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     <span class="comment">//normalize the angle</span>
<a name="l00463"></a>00463     cell-&gt;<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = <a class="code" href="utils_8h.html#a78721379426df9924c9d694c41cd195d">NORMALIZEDISCTHETA</a>(cell-&gt;<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a>, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a25d44d521751d8e62cf5668fb58c1327">00468</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a25d44d521751d8e62cf5668fb58c1327">EnvironmentNAVXYTHETALATTICE::ReadinPose</a>(<a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a>* pose, FILE* fIn)
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470     <span class="keywordtype">char</span> sTemp[60];
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00473"></a>00473     pose-&gt;<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = atof(sTemp);
<a name="l00474"></a>00474     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00475"></a>00475     pose-&gt;<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = atof(sTemp);
<a name="l00476"></a>00476     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00477"></a>00477     pose-&gt;<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = atof(sTemp);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     pose-&gt;<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = <a class="code" href="utils_8h.html#a8b909c7be741a1e355bd0b822df0645e">normalizeAngle</a>(pose-&gt;<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>);
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a771a4e212985dd2aefaaeb506d8d92cb">00484</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a771a4e212985dd2aefaaeb506d8d92cb">EnvironmentNAVXYTHETALATTICE::ReadinMotionPrimitive</a>(<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html">SBPL_xytheta_mprimitive</a>* pMotPrim, FILE* fIn)
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486     <span class="keywordtype">char</span> sTemp[1024];
<a name="l00487"></a>00487     <span class="keywordtype">int</span> dTemp;
<a name="l00488"></a>00488     <span class="keywordtype">char</span> sExpected[1024];
<a name="l00489"></a>00489     <span class="keywordtype">int</span> numofIntermPoses;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="comment">//read in actionID</span>
<a name="l00492"></a>00492     strcpy(sExpected, <span class="stringliteral">&quot;primID:&quot;</span>);
<a name="l00493"></a>00493     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00494"></a>00494     <span class="keywordflow">if</span> (strcmp(sTemp, sExpected) != 0) {
<a name="l00495"></a>00495         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: expected %s but got %s\n&quot;</span>, sExpected, sTemp);
<a name="l00496"></a>00496         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%d&quot;</span>, &amp;pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#a051f0b744591a6c6eb61e05d913d3523">motprimID</a>) != 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="comment">//read in start angle</span>
<a name="l00501"></a>00501     strcpy(sExpected, <span class="stringliteral">&quot;startangle_c:&quot;</span>);
<a name="l00502"></a>00502     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00503"></a>00503     <span class="keywordflow">if</span> (strcmp(sTemp, sExpected) != 0) {
<a name="l00504"></a>00504         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: expected %s but got %s\n&quot;</span>, sExpected, sTemp);
<a name="l00505"></a>00505         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%d&quot;</span>, &amp;dTemp) == 0) {
<a name="l00508"></a>00508         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR reading startangle\n&quot;</span>);
<a name="l00509"></a>00509         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00510"></a>00510     }
<a name="l00511"></a>00511     pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aa90c76f569b3a21144dc28340c0ae8c6">starttheta_c</a> = dTemp;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="comment">//read in end pose</span>
<a name="l00514"></a>00514     strcpy(sExpected, <span class="stringliteral">&quot;endpose_c:&quot;</span>);
<a name="l00515"></a>00515     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00516"></a>00516     <span class="keywordflow">if</span> (strcmp(sTemp, sExpected) != 0) {
<a name="l00517"></a>00517         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: expected %s but got %s\n&quot;</span>, sExpected, sTemp);
<a name="l00518"></a>00518         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (ReadinCell(&amp;pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#acfc900fa620af2780b386a1cbe731234">endcell</a>, fIn) == <span class="keyword">false</span>) {
<a name="l00522"></a>00522         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: failed to read in endsearchpose\n&quot;</span>);
<a name="l00523"></a>00523         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     <span class="comment">//read in action cost</span>
<a name="l00527"></a>00527     strcpy(sExpected, <span class="stringliteral">&quot;additionalactioncostmult:&quot;</span>);
<a name="l00528"></a>00528     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00529"></a>00529     <span class="keywordflow">if</span> (strcmp(sTemp, sExpected) != 0) {
<a name="l00530"></a>00530         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: expected %s but got %s\n&quot;</span>, sExpected, sTemp);
<a name="l00531"></a>00531         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%d&quot;</span>, &amp;dTemp) != 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00534"></a>00534     pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#a5c630603a6a5e81673da5e0c29acb48b">additionalactioncostmult</a> = dTemp;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536     <span class="comment">//read in intermediate poses</span>
<a name="l00537"></a>00537     strcpy(sExpected, <span class="stringliteral">&quot;intermediateposes:&quot;</span>);
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00539"></a>00539     <span class="keywordflow">if</span> (strcmp(sTemp, sExpected) != 0) {
<a name="l00540"></a>00540         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: expected %s but got %s\n&quot;</span>, sExpected, sTemp);
<a name="l00541"></a>00541         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543     <span class="keywordflow">if</span> (fscanf(fIn, <span class="stringliteral">&quot;%d&quot;</span>, &amp;numofIntermPoses) != 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00544"></a>00544     <span class="comment">//all intermposes should be with respect to 0,0 as starting pose since it will be added later and should be done</span>
<a name="l00545"></a>00545     <span class="comment">//after the action is rotated by initial orientation</span>
<a name="l00546"></a>00546     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numofIntermPoses; i++) {
<a name="l00547"></a>00547         <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> intermpose;
<a name="l00548"></a>00548         <span class="keywordflow">if</span> (ReadinPose(&amp;intermpose, fIn) == <span class="keyword">false</span>) {
<a name="l00549"></a>00549             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: failed to read in intermediate poses\n&quot;</span>);
<a name="l00550"></a>00550             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00551"></a>00551         }
<a name="l00552"></a>00552         pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>.push_back(intermpose);
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     <span class="comment">//check that the last pose corresponds correctly to the last pose</span>
<a name="l00556"></a>00556     <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> sourcepose;
<a name="l00557"></a>00557     sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(0, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00558"></a>00558     sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(0, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00559"></a>00559     sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aa90c76f569b3a21144dc28340c0ae8c6">starttheta_c</a>, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00560"></a>00560     <span class="keywordtype">double</span> mp_endx_m = sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> + pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>[pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>.size() - 1].x;
<a name="l00561"></a>00561     <span class="keywordtype">double</span> mp_endy_m = sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> + pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>[pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>.size() - 1].y;
<a name="l00562"></a>00562     <span class="keywordtype">double</span> mp_endtheta_rad = pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>[pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>.size() - 1].theta;
<a name="l00563"></a>00563     <span class="keywordtype">int</span> endx_c = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(mp_endx_m, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00564"></a>00564     <span class="keywordtype">int</span> endy_c = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(mp_endy_m, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00565"></a>00565     <span class="keywordtype">int</span> endtheta_c = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(mp_endtheta_rad, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00566"></a>00566     <span class="keywordflow">if</span> (endx_c != pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#acfc900fa620af2780b386a1cbe731234">endcell</a>.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> || endy_c != pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#acfc900fa620af2780b386a1cbe731234">endcell</a>.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> || endtheta_c != pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#acfc900fa620af2780b386a1cbe731234">endcell</a>.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a>) {
<a name="l00567"></a>00567         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>( <span class="stringliteral">&quot;ERROR: incorrect primitive %d with startangle=%d &quot;</span>
<a name="l00568"></a>00568                    <span class="stringliteral">&quot;last interm point %f %f %f does not match end pose %d %d %d\n&quot;</span>,
<a name="l00569"></a>00569                    pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#a051f0b744591a6c6eb61e05d913d3523">motprimID</a>, pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aa90c76f569b3a21144dc28340c0ae8c6">starttheta_c</a>,
<a name="l00570"></a>00570                    pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>[pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>.size() - 1].x,
<a name="l00571"></a>00571                    pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>[pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>.size() - 1].y,
<a name="l00572"></a>00572                    pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>[pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#aace9686ed1b4723d42f078cccaef90a2">intermptV</a>.size() - 1].theta,
<a name="l00573"></a>00573                    pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#acfc900fa620af2780b386a1cbe731234">endcell</a>.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a>, pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#acfc900fa620af2780b386a1cbe731234">endcell</a>.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a>,
<a name="l00574"></a>00574                    pMotPrim-&gt;<a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html#acfc900fa620af2780b386a1cbe731234">endcell</a>.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a>);
<a name="l00575"></a>00575         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00579"></a>00579 }
<a name="l00580"></a>00580 
<a name="l00581"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#af1c44337cb6332300c2d4e4f2e276c7c">00581</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#af1c44337cb6332300c2d4e4f2e276c7c">EnvironmentNAVXYTHETALATTICE::ReadMotionPrimitives</a>(FILE* fMotPrims)
<a name="l00582"></a>00582 {
<a name="l00583"></a>00583     <span class="keywordtype">char</span> sTemp[1024], sExpected[1024];
<a name="l00584"></a>00584     <span class="keywordtype">float</span> fTemp;
<a name="l00585"></a>00585     <span class="keywordtype">int</span> dTemp;
<a name="l00586"></a>00586     <span class="keywordtype">int</span> totalNumofActions = 0;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Reading in motion primitives...&quot;</span>);
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <span class="comment">//read in the resolution</span>
<a name="l00591"></a>00591     strcpy(sExpected, <span class="stringliteral">&quot;resolution_m:&quot;</span>);
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (fscanf(fMotPrims, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00593"></a>00593     <span class="keywordflow">if</span> (strcmp(sTemp, sExpected) != 0) {
<a name="l00594"></a>00594         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: expected %s but got %s\n&quot;</span>, sExpected, sTemp);
<a name="l00595"></a>00595         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00596"></a>00596     }
<a name="l00597"></a>00597     <span class="keywordflow">if</span> (fscanf(fMotPrims, <span class="stringliteral">&quot;%f&quot;</span>, &amp;fTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00598"></a>00598     <span class="keywordflow">if</span> (fabs(fTemp - EnvNAVXYTHETALATCfg.cellsize_m) &gt; <a class="code" href="config_8h.html#a29ae4e604fefa794868e5f091d6db180" title="small epsilon for various floating error checking">ERR_EPS</a>) {
<a name="l00599"></a>00599         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid resolution %f (instead of %f) in the dynamics file\n&quot;</span>, fTemp,
<a name="l00600"></a>00600                    EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00601"></a>00601         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <span class="comment">//read in the angular resolution</span>
<a name="l00605"></a>00605     strcpy(sExpected, <span class="stringliteral">&quot;numberofangles:&quot;</span>);
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (fscanf(fMotPrims, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00607"></a>00607     <span class="keywordflow">if</span> (strcmp(sTemp, sExpected) != 0) {
<a name="l00608"></a>00608         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: expected %s but got %s\n&quot;</span>, sExpected, sTemp);
<a name="l00609"></a>00609         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611     <span class="keywordflow">if</span> (fscanf(fMotPrims, <span class="stringliteral">&quot;%d&quot;</span>, &amp;dTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00612"></a>00612     <span class="keywordflow">if</span> (dTemp != EnvNAVXYTHETALATCfg.NumThetaDirs) {
<a name="l00613"></a>00613         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid angular resolution %d angles (instead of %d angles) in the motion primitives file\n&quot;</span>,
<a name="l00614"></a>00614                    dTemp, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00615"></a>00615         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     <span class="comment">//read in the total number of actions</span>
<a name="l00619"></a>00619     strcpy(sExpected, <span class="stringliteral">&quot;totalnumberofprimitives:&quot;</span>);
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (fscanf(fMotPrims, <span class="stringliteral">&quot;%s&quot;</span>, sTemp) == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00621"></a>00621     <span class="keywordflow">if</span> (strcmp(sTemp, sExpected) != 0) {
<a name="l00622"></a>00622         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: expected %s but got %s\n&quot;</span>, sExpected, sTemp);
<a name="l00623"></a>00623         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (fscanf(fMotPrims, <span class="stringliteral">&quot;%d&quot;</span>, &amp;totalNumofActions) == 0) {
<a name="l00626"></a>00626         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; totalNumofActions; i++) {
<a name="l00630"></a>00630         <a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html">SBPL_xytheta_mprimitive</a> motprim;
<a name="l00631"></a>00631 
<a name="l00632"></a>00632         <span class="keywordflow">if</span> (<a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a771a4e212985dd2aefaaeb506d8d92cb">EnvironmentNAVXYTHETALATTICE::ReadinMotionPrimitive</a>(&amp;motprim, fMotPrims) == <span class="keyword">false</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         EnvNAVXYTHETALATCfg.mprimV.push_back(motprim);
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;done &quot;</span>);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00641"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ae9a4f66cc4e121c5f6e754b813a402b3">00641</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ae9a4f66cc4e121c5f6e754b813a402b3">EnvironmentNAVXYTHETALATTICE::ComputeReplanningDataforAction</a>(<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>* action)
<a name="l00642"></a>00642 {
<a name="l00643"></a>00643     <span class="keywordtype">int</span> j;
<a name="l00644"></a>00644 
<a name="l00645"></a>00645     <span class="comment">//iterate over all the cells involved in the action</span>
<a name="l00646"></a>00646     <a class="code" href="classsbpl__xy__theta__cell__t.html">sbpl_xy_theta_cell_t</a> startcell3d, endcell3d;
<a name="l00647"></a>00647     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ade0b6d3a6a7f6bcb093ba4a53270bc90">intersectingcellsV</a>.size(); i++) {
<a name="l00648"></a>00648         <span class="comment">//compute the translated affected search Pose - what state has an</span>
<a name="l00649"></a>00649         <span class="comment">//outgoing action whose intersecting cell is at 0,0</span>
<a name="l00650"></a>00650         startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ac7128ff990bf24d3fc7d6250a7cfeee4">starttheta</a>;
<a name="l00651"></a>00651         startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = -action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ade0b6d3a6a7f6bcb093ba4a53270bc90">intersectingcellsV</a>.at(i).x;
<a name="l00652"></a>00652         startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = -action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ade0b6d3a6a7f6bcb093ba4a53270bc90">intersectingcellsV</a>.at(i).y;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654         <span class="comment">//compute the translated affected search Pose - what state has an</span>
<a name="l00655"></a>00655         <span class="comment">//incoming action whose intersecting cell is at 0,0</span>
<a name="l00656"></a>00656         endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = <a class="code" href="utils_8h.html#a78721379426df9924c9d694c41cd195d">NORMALIZEDISCTHETA</a>(action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#a8f62400ae7def338cfd8fb89436f9aae">endtheta</a>, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00657"></a>00657         endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>;
<a name="l00658"></a>00658         endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660         <span class="comment">//store the cells if not already there</span>
<a name="l00661"></a>00661         <span class="keywordflow">for</span> (j = 0; j &lt; (int)affectedsuccstatesV.size(); j++) {
<a name="l00662"></a>00662             <span class="keywordflow">if</span> (affectedsuccstatesV.at(j) == endcell3d) <span class="keywordflow">break</span>;
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664         <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)affectedsuccstatesV.size()) affectedsuccstatesV.push_back(endcell3d);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         <span class="keywordflow">for</span> (j = 0; j &lt; (int)affectedpredstatesV.size(); j++) {
<a name="l00667"></a>00667             <span class="keywordflow">if</span> (affectedpredstatesV.at(j) == startcell3d) <span class="keywordflow">break</span>;
<a name="l00668"></a>00668         }
<a name="l00669"></a>00669         <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)affectedpredstatesV.size()) affectedpredstatesV.push_back(startcell3d);
<a name="l00670"></a>00670     }<span class="comment">//over intersecting cells</span>
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     <span class="comment">//add the centers since with h2d we are using these in cost computations</span>
<a name="l00673"></a>00673     <span class="comment">//---intersecting cell = origin</span>
<a name="l00674"></a>00674     <span class="comment">//compute the translated affected search Pose - what state has an outgoing action whose intersecting cell is at 0,0</span>
<a name="l00675"></a>00675     startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ac7128ff990bf24d3fc7d6250a7cfeee4">starttheta</a>;
<a name="l00676"></a>00676     startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = -0;
<a name="l00677"></a>00677     startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = -0;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679     <span class="comment">//compute the translated affected search Pose - what state has an incoming action whose intersecting cell is at 0,0</span>
<a name="l00680"></a>00680     endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = <a class="code" href="utils_8h.html#a78721379426df9924c9d694c41cd195d">NORMALIZEDISCTHETA</a>(action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#a8f62400ae7def338cfd8fb89436f9aae">endtheta</a>, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00681"></a>00681     endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>;
<a name="l00682"></a>00682     endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>;
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="comment">//store the cells if not already there</span>
<a name="l00685"></a>00685     <span class="keywordflow">for</span> (j = 0; j &lt; (int)affectedsuccstatesV.size(); j++) {
<a name="l00686"></a>00686         <span class="keywordflow">if</span> (affectedsuccstatesV.at(j) == endcell3d) <span class="keywordflow">break</span>;
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)affectedsuccstatesV.size()) affectedsuccstatesV.push_back(endcell3d);
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <span class="keywordflow">for</span> (j = 0; j &lt; (int)affectedpredstatesV.size(); j++) {
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (affectedpredstatesV.at(j) == startcell3d) <span class="keywordflow">break</span>;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693     <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)affectedpredstatesV.size()) affectedpredstatesV.push_back(startcell3d);
<a name="l00694"></a>00694 
<a name="l00695"></a>00695     <span class="comment">//---intersecting cell = outcome state</span>
<a name="l00696"></a>00696     <span class="comment">//compute the translated affected search Pose - what state has an outgoing action whose intersecting cell is at 0,0</span>
<a name="l00697"></a>00697     startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ac7128ff990bf24d3fc7d6250a7cfeee4">starttheta</a>;
<a name="l00698"></a>00698     startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = -action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>;
<a name="l00699"></a>00699     startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = -action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <span class="comment">//compute the translated affected search Pose - what state has an incoming action whose intersecting cell is at 0,0</span>
<a name="l00702"></a>00702     endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = <a class="code" href="utils_8h.html#a78721379426df9924c9d694c41cd195d">NORMALIZEDISCTHETA</a>(action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#a8f62400ae7def338cfd8fb89436f9aae">endtheta</a>, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00703"></a>00703     endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>;
<a name="l00704"></a>00704     endcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = startcell3d.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>;
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     <span class="keywordflow">for</span> (j = 0; j &lt; (int)affectedsuccstatesV.size(); j++) {
<a name="l00707"></a>00707         <span class="keywordflow">if</span> (affectedsuccstatesV.at(j) == endcell3d) <span class="keywordflow">break</span>;
<a name="l00708"></a>00708     }
<a name="l00709"></a>00709     <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)affectedsuccstatesV.size()) affectedsuccstatesV.push_back(endcell3d);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711     <span class="keywordflow">for</span> (j = 0; j &lt; (int)affectedpredstatesV.size(); j++) {
<a name="l00712"></a>00712         <span class="keywordflow">if</span> (affectedpredstatesV.at(j) == startcell3d) <span class="keywordflow">break</span>;
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714     <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)affectedpredstatesV.size()) affectedpredstatesV.push_back(startcell3d);
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 <span class="comment">//computes all the 3D states whose outgoing actions are potentially affected</span>
<a name="l00718"></a>00718 <span class="comment">//when cell (0,0) changes its status it also does the same for the 3D states</span>
<a name="l00719"></a>00719 <span class="comment">//whose incoming actions are potentially affected when cell (0,0) changes its</span>
<a name="l00720"></a>00720 <span class="comment">//status</span>
<a name="l00721"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ad3e4abf77f7fa69bdf8b5c41a0531a58">00721</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ad3e4abf77f7fa69bdf8b5c41a0531a58">EnvironmentNAVXYTHETALATTICE::ComputeReplanningData</a>()
<a name="l00722"></a>00722 {
<a name="l00723"></a>00723     <span class="comment">//iterate over all actions</span>
<a name="l00724"></a>00724     <span class="comment">//orientations</span>
<a name="l00725"></a>00725     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> tind = 0; tind &lt; EnvNAVXYTHETALATCfg.NumThetaDirs; tind++) {
<a name="l00726"></a>00726         <span class="comment">//actions</span>
<a name="l00727"></a>00727         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> aind = 0; aind &lt; EnvNAVXYTHETALATCfg.actionwidth; aind++) {
<a name="l00728"></a>00728             <span class="comment">//compute replanning data for this action </span>
<a name="l00729"></a>00729             ComputeReplanningDataforAction(&amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind]);
<a name="l00730"></a>00730         }
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732 }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 <span class="comment">//here motionprimitivevector contains actions only for 0 angle</span>
<a name="l00735"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a9ed3867cdb6f49fb29705c716fbd431c">00735</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a9ed3867cdb6f49fb29705c716fbd431c">EnvironmentNAVXYTHETALATTICE::PrecomputeActionswithBaseMotionPrimitive</a>(
<a name="l00736"></a>00736         vector&lt;SBPL_xytheta_mprimitive&gt;* motionprimitiveV)
<a name="l00737"></a>00737 {
<a name="l00738"></a>00738     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Pre-computing action data using base motion primitives...\n&quot;</span>);
<a name="l00739"></a>00739     EnvNAVXYTHETALATCfg.ActionsV = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>*[EnvNAVXYTHETALATCfg.NumThetaDirs];
<a name="l00740"></a>00740     EnvNAVXYTHETALATCfg.PredActionsV = <span class="keyword">new</span> vector&lt;EnvNAVXYTHETALATAction_t*&gt; [EnvNAVXYTHETALATCfg.NumThetaDirs];
<a name="l00741"></a>00741     vector&lt;sbpl_2Dcell_t&gt; footprint;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743     <span class="comment">//iterate over source angles</span>
<a name="l00744"></a>00744     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> tind = 0; tind &lt; EnvNAVXYTHETALATCfg.NumThetaDirs; tind++) {
<a name="l00745"></a>00745         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;pre-computing for angle %d out of %d angles\n&quot;</span>, tind, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00746"></a>00746         EnvNAVXYTHETALATCfg.ActionsV[tind] = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>[motionprimitiveV-&gt;size()];
<a name="l00747"></a>00747 
<a name="l00748"></a>00748         <span class="comment">//compute sourcepose</span>
<a name="l00749"></a>00749         <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> sourcepose;
<a name="l00750"></a>00750         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(0, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00751"></a>00751         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(0, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00752"></a>00752         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(tind, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00753"></a>00753 
<a name="l00754"></a>00754         <span class="comment">//iterate over motion primitives</span>
<a name="l00755"></a>00755         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> aind = 0; aind &lt; motionprimitiveV-&gt;size(); aind++) {
<a name="l00756"></a>00756             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].aind = aind;
<a name="l00757"></a>00757             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].starttheta = tind;
<a name="l00758"></a>00758             <span class="keywordtype">double</span> mp_endx_m = motionprimitiveV-&gt;at(aind).intermptV[motionprimitiveV-&gt;at(aind).intermptV.size() - 1].x;
<a name="l00759"></a>00759             <span class="keywordtype">double</span> mp_endy_m = motionprimitiveV-&gt;at(aind).intermptV[motionprimitiveV-&gt;at(aind).intermptV.size() - 1].y;
<a name="l00760"></a>00760             <span class="keywordtype">double</span> mp_endtheta_rad =
<a name="l00761"></a>00761                     motionprimitiveV-&gt;at(aind).intermptV[motionprimitiveV-&gt;at(aind).intermptV.size() - 1].theta;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763             <span class="keywordtype">double</span> endx = sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> + (mp_endx_m * cos(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>) - mp_endy_m * sin(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>));
<a name="l00764"></a>00764             <span class="keywordtype">double</span> endy = sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> + (mp_endx_m * sin(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>) + mp_endy_m * cos(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>));
<a name="l00765"></a>00765 
<a name="l00766"></a>00766             <span class="keywordtype">int</span> endx_c = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(endx, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00767"></a>00767             <span class="keywordtype">int</span> endy_c = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(endy, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00768"></a>00768 
<a name="l00769"></a>00769             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(mp_endtheta_rad + sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>,
<a name="l00770"></a>00770                                                                                EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00771"></a>00771             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX = endx_c;
<a name="l00772"></a>00772             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY = endy_c;
<a name="l00773"></a>00773             <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY != 0 || EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX != 0)
<a name="l00774"></a>00774                 EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost = (int)(ceil(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a>
<a name="l00775"></a>00775                     * EnvNAVXYTHETALATCfg.cellsize_m / EnvNAVXYTHETALATCfg.nominalvel_mpersecs
<a name="l00776"></a>00776                     * sqrt((<span class="keywordtype">double</span>)(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX
<a name="l00777"></a>00777                         * EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX + EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY
<a name="l00778"></a>00778                         * EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY))));
<a name="l00779"></a>00779             <span class="keywordflow">else</span>
<a name="l00780"></a>00780                 <span class="comment">//cost of turn in place</span>
<a name="l00781"></a>00781                 EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost = (int)(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a>
<a name="l00782"></a>00782                     * EnvNAVXYTHETALATCfg.timetoturn45degsinplace_secs
<a name="l00783"></a>00783                     * fabs(<a class="code" href="utils_8h.html#ae4120d0126410a772a754207f4c34a18" title="computes minimum unsigned difference between two angles in radians">computeMinUnsignedAngleDiff</a>(mp_endtheta_rad, 0)) / (<a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a> / 4.0));
<a name="l00784"></a>00784 
<a name="l00785"></a>00785             <span class="comment">//compute and store interm points as well as intersecting cells</span>
<a name="l00786"></a>00786             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV.clear();
<a name="l00787"></a>00787             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.clear();
<a name="l00788"></a>00788             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].interm3DcellsV.clear();
<a name="l00789"></a>00789             <a class="code" href="classsbpl__xy__theta__cell__t.html">sbpl_xy_theta_cell_t</a> previnterm3Dcell;
<a name="l00790"></a>00790             previnterm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a> = previnterm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = previnterm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = 0;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pind = 0; pind &lt; (int)motionprimitiveV-&gt;at(aind).intermptV.size(); pind++) {
<a name="l00793"></a>00793                 <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> intermpt = motionprimitiveV-&gt;at(aind).intermptV[pind];
<a name="l00794"></a>00794 
<a name="l00795"></a>00795                 <span class="comment">//rotate it appropriately</span>
<a name="l00796"></a>00796                 <span class="keywordtype">double</span> rotx = intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> * cos(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>) - intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> * sin(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>);
<a name="l00797"></a>00797                 <span class="keywordtype">double</span> roty = intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> * sin(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>) + intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> * cos(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>);
<a name="l00798"></a>00798                 intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = rotx;
<a name="l00799"></a>00799                 intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = roty;
<a name="l00800"></a>00800                 intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = <a class="code" href="utils_8h.html#a8b909c7be741a1e355bd0b822df0645e">normalizeAngle</a>(sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> + intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>);
<a name="l00801"></a>00801 
<a name="l00802"></a>00802                 <span class="comment">//store it (they are with reference to 0,0,stattheta (not</span>
<a name="l00803"></a>00803                 <span class="comment">//sourcepose.x,sourcepose.y,starttheta (that is, half-bin))</span>
<a name="l00804"></a>00804                 EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.push_back(intermpt);
<a name="l00805"></a>00805             }
<a name="l00806"></a>00806             <span class="comment">//now compute the intersecting cells for this motion (including ignoring the source footprint)</span>
<a name="l00807"></a>00807             <a class="code" href="utils_8h.html#a382e88667b4449c3d45c6629715c1054">get_2d_motion_cells</a>(EnvNAVXYTHETALATCfg.FootprintPolygon,
<a name="l00808"></a>00808                                 EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV,
<a name="l00809"></a>00809                                 &amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV,
<a name="l00810"></a>00810                                 EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 <span class="preprocessor">#if DEBUG</span>
<a name="l00813"></a>00813 <span class="preprocessor"></span>            <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb,
<a name="l00814"></a>00814                          <span class="stringliteral">&quot;action tind=%d aind=%d: dX=%d dY=%d endtheta=%d (%.2f degs -&gt; %.2f degs) &quot;</span>
<a name="l00815"></a>00815                          <span class="stringliteral">&quot;cost=%d (mprim: %.2f %.2f %.2f)\n&quot;</span>,
<a name="l00816"></a>00816                          tind,
<a name="l00817"></a>00817                          (<span class="keywordtype">int</span>)aind,
<a name="l00818"></a>00818                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX,
<a name="l00819"></a>00819                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY,
<a name="l00820"></a>00820                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta,
<a name="l00821"></a>00821                          sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> * 180.0 / <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a>,
<a name="l00822"></a>00822                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV[EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.size() - 1].theta * 180.0 / <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a>,
<a name="l00823"></a>00823                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost,
<a name="l00824"></a>00824                          mp_endx_m,
<a name="l00825"></a>00825                          mp_endy_m,
<a name="l00826"></a>00826                          mp_endtheta_rad);
<a name="l00827"></a>00827 <span class="preprocessor">#endif</span>
<a name="l00828"></a>00828 <span class="preprocessor"></span>
<a name="l00829"></a>00829             <span class="comment">//add to the list of backward actions</span>
<a name="l00830"></a>00830             <span class="keywordtype">int</span> targettheta = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta;
<a name="l00831"></a>00831             <span class="keywordflow">if</span> (targettheta &lt; 0) targettheta = targettheta + EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l00832"></a>00832             EnvNAVXYTHETALATCfg.PredActionsV[targettheta].push_back(&amp;(EnvNAVXYTHETALATCfg.ActionsV[tind][aind]));
<a name="l00833"></a>00833         }
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836     <span class="comment">//set number of actions</span>
<a name="l00837"></a>00837     EnvNAVXYTHETALATCfg.actionwidth = motionprimitiveV-&gt;size();
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="comment">//now compute replanning data</span>
<a name="l00840"></a>00840     ComputeReplanningData();
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;done pre-computing action data based on motion primitives\n&quot;</span>);
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="comment">//here motionprimitivevector contains actions for all angles</span>
<a name="l00846"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a5c2b97b6b2c815ac2502dc72c482df55">00846</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a5c2b97b6b2c815ac2502dc72c482df55">EnvironmentNAVXYTHETALATTICE::PrecomputeActionswithCompleteMotionPrimitive</a>(
<a name="l00847"></a>00847         vector&lt;SBPL_xytheta_mprimitive&gt;* motionprimitiveV)
<a name="l00848"></a>00848 {
<a name="l00849"></a>00849     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Pre-computing action data using motion primitives for every angle...\n&quot;</span>);
<a name="l00850"></a>00850     EnvNAVXYTHETALATCfg.ActionsV = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>*[EnvNAVXYTHETALATCfg.NumThetaDirs];
<a name="l00851"></a>00851     EnvNAVXYTHETALATCfg.PredActionsV = <span class="keyword">new</span> vector&lt;EnvNAVXYTHETALATAction_t*&gt; [EnvNAVXYTHETALATCfg.NumThetaDirs];
<a name="l00852"></a>00852     vector&lt;sbpl_2Dcell_t&gt; footprint;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854     <span class="keywordflow">if</span> (motionprimitiveV-&gt;size() % EnvNAVXYTHETALATCfg.NumThetaDirs != 0) {
<a name="l00855"></a>00855         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: motionprimitives should be uniform across actions\n&quot;</span>);
<a name="l00856"></a>00856         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     EnvNAVXYTHETALATCfg.actionwidth = ((int)motionprimitiveV-&gt;size()) / EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     <span class="comment">//iterate over source angles</span>
<a name="l00862"></a>00862     <span class="keywordtype">int</span> maxnumofactions = 0;
<a name="l00863"></a>00863     for (<span class="keywordtype">int</span> tind = 0; tind &lt; EnvNAVXYTHETALATCfg.NumThetaDirs; tind++) {
<a name="l00864"></a>00864         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;pre-computing for angle %d out of %d angles\n&quot;</span>, tind, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00865"></a>00865 
<a name="l00866"></a>00866         EnvNAVXYTHETALATCfg.ActionsV[tind] = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>[EnvNAVXYTHETALATCfg.actionwidth];
<a name="l00867"></a>00867 
<a name="l00868"></a>00868         <span class="comment">//compute sourcepose</span>
<a name="l00869"></a>00869         <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> sourcepose;
<a name="l00870"></a>00870         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(0, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00871"></a>00871         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(0, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00872"></a>00872         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(tind, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00873"></a>00873 
<a name="l00874"></a>00874         <span class="comment">//iterate over motion primitives</span>
<a name="l00875"></a>00875         <span class="keywordtype">int</span> numofactions = 0;
<a name="l00876"></a>00876         <span class="keywordtype">int</span> aind = -1;
<a name="l00877"></a>00877         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> mind = 0; mind &lt; (int)motionprimitiveV-&gt;size(); mind++) {
<a name="l00878"></a>00878             <span class="comment">//find a motion primitive for this angle</span>
<a name="l00879"></a>00879             <span class="keywordflow">if</span> (motionprimitiveV-&gt;at(mind).starttheta_c != tind) <span class="keywordflow">continue</span>;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881             aind++;
<a name="l00882"></a>00882             numofactions++;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884             <span class="comment">//action index</span>
<a name="l00885"></a>00885             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].aind = aind;
<a name="l00886"></a>00886 
<a name="l00887"></a>00887             <span class="comment">//start angle</span>
<a name="l00888"></a>00888             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].starttheta = tind;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890             <span class="comment">//compute dislocation</span>
<a name="l00891"></a>00891             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta = motionprimitiveV-&gt;at(mind).endcell.theta;
<a name="l00892"></a>00892             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX = motionprimitiveV-&gt;at(mind).endcell.x;
<a name="l00893"></a>00893             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY = motionprimitiveV-&gt;at(mind).endcell.y;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895             <span class="comment">//compute and store interm points as well as intersecting cells</span>
<a name="l00896"></a>00896             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV.clear();
<a name="l00897"></a>00897             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.clear();
<a name="l00898"></a>00898             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].interm3DcellsV.clear();
<a name="l00899"></a>00899 
<a name="l00900"></a>00900             <a class="code" href="classsbpl__xy__theta__cell__t.html">sbpl_xy_theta_cell_t</a> previnterm3Dcell;
<a name="l00901"></a>00901             previnterm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = 0;
<a name="l00902"></a>00902             previnterm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = 0;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904             <span class="comment">// Compute all the intersected cells for this action (intermptV and interm3DcellsV)</span>
<a name="l00905"></a>00905             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pind = 0; pind &lt; (int)motionprimitiveV-&gt;at(mind).intermptV.size(); pind++) {
<a name="l00906"></a>00906                 <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> intermpt = motionprimitiveV-&gt;at(mind).intermptV[pind];
<a name="l00907"></a>00907                 EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.push_back(intermpt);
<a name="l00908"></a>00908 
<a name="l00909"></a>00909                 <span class="comment">// also compute the intermediate discrete cells if not there already</span>
<a name="l00910"></a>00910                 <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> pose;
<a name="l00911"></a>00911                 pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> + sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a>;
<a name="l00912"></a>00912                 pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> + sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a>;
<a name="l00913"></a>00913                 pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915                 <a class="code" href="classsbpl__xy__theta__cell__t.html">sbpl_xy_theta_cell_t</a> intermediate2dCell;
<a name="l00916"></a>00916                 intermediate2dCell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a>, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00917"></a>00917                 intermediate2dCell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a>, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919                 <span class="comment">// add unique cells to the list</span>
<a name="l00920"></a>00920                 <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.ActionsV[tind][aind].interm3DcellsV.size() == 0 || intermediate2dCell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a>
<a name="l00921"></a>00921                     != previnterm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> || intermediate2dCell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> != previnterm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a>) {
<a name="l00922"></a>00922                     EnvNAVXYTHETALATCfg.ActionsV[tind][aind].interm3DcellsV.push_back(intermediate2dCell);
<a name="l00923"></a>00923                 }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925                 previnterm3Dcell = intermediate2dCell;
<a name="l00926"></a>00926             }
<a name="l00927"></a>00927 
<a name="l00928"></a>00928             <span class="comment">//compute linear and angular time</span>
<a name="l00929"></a>00929             <span class="keywordtype">double</span> linear_distance = 0;
<a name="l00930"></a>00930             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.size(); i++) {
<a name="l00931"></a>00931                 <span class="keywordtype">double</span> x0 = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV[i - 1].<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a>;
<a name="l00932"></a>00932                 <span class="keywordtype">double</span> y0 = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV[i - 1].y;
<a name="l00933"></a>00933                 <span class="keywordtype">double</span> x1 = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV[i].x;
<a name="l00934"></a>00934                 <span class="keywordtype">double</span> y1 = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV[i].y;
<a name="l00935"></a>00935                 <span class="keywordtype">double</span> <a class="code" href="environment__robarm_8cpp.html#a81993d0f2b730f2ba6b34ebfc3189d8c">dx</a> = x1 - x0;
<a name="l00936"></a>00936                 <span class="keywordtype">double</span> <a class="code" href="environment__robarm_8cpp.html#a5355ebd24fef21214f574784f9acaeed">dy</a> = y1 - y0;
<a name="l00937"></a>00937                 linear_distance += sqrt(dx * dx + dy * dy);
<a name="l00938"></a>00938             }
<a name="l00939"></a>00939             <span class="keywordtype">double</span> linear_time = linear_distance / EnvNAVXYTHETALATCfg.nominalvel_mpersecs;
<a name="l00940"></a>00940             <span class="keywordtype">double</span> angular_distance =
<a name="l00941"></a>00941                     fabs(<a class="code" href="utils_8h.html#ae4120d0126410a772a754207f4c34a18" title="computes minimum unsigned difference between two angles in radians">computeMinUnsignedAngleDiff</a>(<a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta,
<a name="l00942"></a>00942                                                                     EnvNAVXYTHETALATCfg.NumThetaDirs),
<a name="l00943"></a>00943                                                      <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].starttheta,
<a name="l00944"></a>00944                                                                     EnvNAVXYTHETALATCfg.NumThetaDirs)));
<a name="l00945"></a>00945             <span class="keywordtype">double</span> angular_time = angular_distance / ((<a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a> / 4.0) /
<a name="l00946"></a>00946                                   EnvNAVXYTHETALATCfg.timetoturn45degsinplace_secs);
<a name="l00947"></a>00947             <span class="comment">//make the cost the max of the two times</span>
<a name="l00948"></a>00948             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost =
<a name="l00949"></a>00949                     (int)(ceil(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a> * max(linear_time, angular_time)));
<a name="l00950"></a>00950             <span class="comment">//use any additional cost multiplier</span>
<a name="l00951"></a>00951             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost *= motionprimitiveV-&gt;at(mind).additionalactioncostmult;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953             <span class="comment">//now compute the intersecting cells for this motion (including ignoring the source footprint)</span>
<a name="l00954"></a>00954             <a class="code" href="utils_8h.html#a382e88667b4449c3d45c6629715c1054">get_2d_motion_cells</a>(EnvNAVXYTHETALATCfg.FootprintPolygon, motionprimitiveV-&gt;at(mind).intermptV,
<a name="l00955"></a>00955                                 &amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV,
<a name="l00956"></a>00956                                 EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958 <span class="preprocessor">#if DEBUG</span>
<a name="l00959"></a>00959 <span class="preprocessor"></span>            <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb,
<a name="l00960"></a>00960                          <span class="stringliteral">&quot;action tind=%2d aind=%2d: dX=%3d dY=%3d endtheta=%3d (%6.2f degs -&gt; %6.2f degs) &quot;</span>
<a name="l00961"></a>00961                          <span class="stringliteral">&quot;cost=%4d (mprimID %3d: %3d %3d %3d) numofintermcells = %d numofintercells=%d\n&quot;</span>,
<a name="l00962"></a>00962                          tind,
<a name="l00963"></a>00963                          aind,
<a name="l00964"></a>00964                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX,
<a name="l00965"></a>00965                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY,
<a name="l00966"></a>00966                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta,
<a name="l00967"></a>00967                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV[0].theta * 180 / <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a>,
<a name="l00968"></a>00968                          EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV[EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.size() - 1].theta * 180 / <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a>, EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost,
<a name="l00969"></a>00969                          motionprimitiveV-&gt;at(mind).motprimID, motionprimitiveV-&gt;at(mind).endcell.x,
<a name="l00970"></a>00970                          motionprimitiveV-&gt;at(mind).endcell.y, motionprimitiveV-&gt;at(mind).endcell.theta,
<a name="l00971"></a>00971                          (int)EnvNAVXYTHETALATCfg.ActionsV[tind][aind].interm3DcellsV.size(),
<a name="l00972"></a>00972                          (int)EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV.size());
<a name="l00973"></a>00973 <span class="preprocessor">#endif</span>
<a name="l00974"></a>00974 <span class="preprocessor"></span>
<a name="l00975"></a>00975             <span class="comment">//add to the list of backward actions</span>
<a name="l00976"></a>00976             <span class="keywordtype">int</span> targettheta = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta;
<a name="l00977"></a>00977             <span class="keywordflow">if</span> (targettheta &lt; 0) targettheta = targettheta + EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l00978"></a>00978             EnvNAVXYTHETALATCfg.PredActionsV[targettheta].push_back(&amp;(EnvNAVXYTHETALATCfg.ActionsV[tind][aind]));
<a name="l00979"></a>00979         }
<a name="l00980"></a>00980 
<a name="l00981"></a>00981         <span class="keywordflow">if</span> (maxnumofactions &lt; numofactions) maxnumofactions = numofactions;
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983 
<a name="l00984"></a>00984     <span class="comment">//at this point we don&#39;t allow nonuniform number of actions</span>
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (motionprimitiveV-&gt;size() != (size_t)(EnvNAVXYTHETALATCfg.NumThetaDirs * maxnumofactions)) {
<a name="l00986"></a>00986         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: nonuniform number of actions is not supported &quot;</span>
<a name="l00987"></a>00987                    <span class="stringliteral">&quot;(maxnumofactions=%d while motprims=%d thetas=%d\n&quot;</span>,
<a name="l00988"></a>00988                    maxnumofactions, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)motionprimitiveV-&gt;size(), EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l00989"></a>00989         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l00990"></a>00990     }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992     <span class="comment">//now compute replanning data</span>
<a name="l00993"></a>00993     ComputeReplanningData();
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;done pre-computing action data based on motion primitives\n&quot;</span>);
<a name="l00996"></a>00996 }
<a name="l00997"></a>00997 
<a name="l00998"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#af5dfba515ba87f8ed8334eecef248011">00998</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#af5dfba515ba87f8ed8334eecef248011">EnvironmentNAVXYTHETALATTICE::DeprecatedPrecomputeActions</a>()
<a name="l00999"></a>00999 {
<a name="l01000"></a>01000     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Use of DeprecatedPrecomputeActions() is deprecated and probably doesn&#39;t work!\n&quot;</span>);
<a name="l01001"></a>01001 
<a name="l01002"></a>01002     <span class="comment">//construct list of actions</span>
<a name="l01003"></a>01003     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Pre-computing action data using the motion primitives for a 3D kinematic planning...\n&quot;</span>);
<a name="l01004"></a>01004     EnvNAVXYTHETALATCfg.ActionsV = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>*[EnvNAVXYTHETALATCfg.NumThetaDirs];
<a name="l01005"></a>01005     EnvNAVXYTHETALATCfg.PredActionsV = <span class="keyword">new</span> vector&lt;EnvNAVXYTHETALATAction_t*&gt; [EnvNAVXYTHETALATCfg.NumThetaDirs];
<a name="l01006"></a>01006     vector&lt;sbpl_2Dcell_t&gt; footprint;
<a name="l01007"></a>01007     <span class="comment">//iterate over source angles</span>
<a name="l01008"></a>01008     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> tind = 0; tind &lt; EnvNAVXYTHETALATCfg.NumThetaDirs; tind++) {
<a name="l01009"></a>01009         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;processing angle %d\n&quot;</span>, tind);
<a name="l01010"></a>01010         EnvNAVXYTHETALATCfg.ActionsV[tind] = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>[EnvNAVXYTHETALATCfg.actionwidth];
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         <span class="comment">//compute sourcepose</span>
<a name="l01013"></a>01013         <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> sourcepose;
<a name="l01014"></a>01014         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(0, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01015"></a>01015         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(0, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01016"></a>01016         sourcepose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(tind, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01017"></a>01017 
<a name="l01018"></a>01018         <span class="comment">//the construction assumes that the robot first turns and then goes along this new theta</span>
<a name="l01019"></a>01019         <span class="keywordtype">int</span> aind = 0;
<a name="l01020"></a>01020         <span class="keywordflow">for</span> (; aind &lt; 3; aind++) {
<a name="l01021"></a>01021             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].aind = aind;
<a name="l01022"></a>01022             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].starttheta = tind;
<a name="l01023"></a>01023             <span class="comment">//-1,0,1</span>
<a name="l01024"></a>01024             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta = (tind + aind - 1) % EnvNAVXYTHETALATCfg.NumThetaDirs; 
<a name="l01025"></a>01025             <span class="keywordtype">double</span> angle = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta,
<a name="l01026"></a>01026                                           EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01027"></a>01027             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX = (int)(cos(angle) + 0.5 * (cos(angle) &gt; 0 ? 1 : -1));
<a name="l01028"></a>01028             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY = (int)(sin(angle) + 0.5 * (sin(angle) &gt; 0 ? 1 : -1));
<a name="l01029"></a>01029             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost = (int)(ceil(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a>
<a name="l01030"></a>01030                 * EnvNAVXYTHETALATCfg.cellsize_m / EnvNAVXYTHETALATCfg.nominalvel_mpersecs
<a name="l01031"></a>01031                 * sqrt((<span class="keywordtype">double</span>)(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX
<a name="l01032"></a>01032                     * EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX + EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY
<a name="l01033"></a>01033                     * EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY))));
<a name="l01034"></a>01034 
<a name="l01035"></a>01035             <span class="comment">//compute intersecting cells</span>
<a name="l01036"></a>01036             <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> pose;
<a name="l01037"></a>01037             pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01038"></a>01038             pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01039"></a>01039             pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = angle;
<a name="l01040"></a>01040             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.clear();
<a name="l01041"></a>01041             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV.clear();
<a name="l01042"></a>01042             <a class="code" href="utils_8h.html#aa1d716066678dafff330461b04b5de60">get_2d_footprint_cells</a>(EnvNAVXYTHETALATCfg.FootprintPolygon,
<a name="l01043"></a>01043                                    &amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV, pose,
<a name="l01044"></a>01044                                    EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01045"></a>01045             RemoveSourceFootprint(sourcepose, &amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV);
<a name="l01046"></a>01046 
<a name="l01047"></a>01047 <span class="preprocessor">#if DEBUG</span>
<a name="l01048"></a>01048 <span class="preprocessor"></span>            <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;action tind=%d aind=%d: endtheta=%d (%f) dX=%d dY=%d cost=%d\n&quot;</span>,
<a name="l01049"></a>01049                         tind, aind, EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta, angle,
<a name="l01050"></a>01050                         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX, EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY,
<a name="l01051"></a>01051                         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost);
<a name="l01052"></a>01052 <span class="preprocessor">#endif</span>
<a name="l01053"></a>01053 <span class="preprocessor"></span>
<a name="l01054"></a>01054             <span class="comment">//add to the list of backward actions</span>
<a name="l01055"></a>01055             <span class="keywordtype">int</span> targettheta = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta;
<a name="l01056"></a>01056             <span class="keywordflow">if</span> (targettheta &lt; 0) targettheta = targettheta + EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l01057"></a>01057             EnvNAVXYTHETALATCfg.PredActionsV[targettheta].push_back(&amp;(EnvNAVXYTHETALATCfg.ActionsV[tind][aind]));
<a name="l01058"></a>01058         }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060         <span class="comment">//decrease and increase angle without movement</span>
<a name="l01061"></a>01061         aind = 3;
<a name="l01062"></a>01062         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].aind = aind;
<a name="l01063"></a>01063         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].starttheta = tind;
<a name="l01064"></a>01064         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta = tind - 1;
<a name="l01065"></a>01065         <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta &lt; 0)
<a name="l01066"></a>01066             EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta += EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l01067"></a>01067         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX = 0;
<a name="l01068"></a>01068         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY = 0;
<a name="l01069"></a>01069         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost = (int)(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a> *
<a name="l01070"></a>01070                                                               EnvNAVXYTHETALATCfg.timetoturn45degsinplace_secs);
<a name="l01071"></a>01071 
<a name="l01072"></a>01072         <span class="comment">//compute intersecting cells</span>
<a name="l01073"></a>01073         <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> pose;
<a name="l01074"></a>01074         pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01075"></a>01075         pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01076"></a>01076         pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> =
<a name="l01077"></a>01077                 <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01078"></a>01078         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.clear();
<a name="l01079"></a>01079         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV.clear();
<a name="l01080"></a>01080         <a class="code" href="utils_8h.html#aa1d716066678dafff330461b04b5de60">get_2d_footprint_cells</a>(EnvNAVXYTHETALATCfg.FootprintPolygon,
<a name="l01081"></a>01081                                &amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV, pose,
<a name="l01082"></a>01082                                EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01083"></a>01083         RemoveSourceFootprint(sourcepose, &amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV);
<a name="l01084"></a>01084 
<a name="l01085"></a>01085 <span class="preprocessor">#if DEBUG</span>
<a name="l01086"></a>01086 <span class="preprocessor"></span>        <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;action tind=%d aind=%d: endtheta=%d (%f) dX=%d dY=%d cost=%d\n&quot;</span>,
<a name="l01087"></a>01087                     tind, aind, EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta,
<a name="l01088"></a>01088                     <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta, EnvNAVXYTHETALATCfg.NumThetaDirs),
<a name="l01089"></a>01089                     EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX, EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY,
<a name="l01090"></a>01090                     EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost);
<a name="l01091"></a>01091 <span class="preprocessor">#endif</span>
<a name="l01092"></a>01092 <span class="preprocessor"></span>
<a name="l01093"></a>01093         <span class="comment">//add to the list of backward actions</span>
<a name="l01094"></a>01094         <span class="keywordtype">int</span> targettheta = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta;
<a name="l01095"></a>01095         <span class="keywordflow">if</span> (targettheta &lt; 0) targettheta = targettheta + EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l01096"></a>01096         EnvNAVXYTHETALATCfg.PredActionsV[targettheta].push_back(&amp;(EnvNAVXYTHETALATCfg.ActionsV[tind][aind]));
<a name="l01097"></a>01097 
<a name="l01098"></a>01098         aind = 4;
<a name="l01099"></a>01099         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].aind = aind;
<a name="l01100"></a>01100         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].starttheta = tind;
<a name="l01101"></a>01101         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta = (tind + 1) % EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l01102"></a>01102         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX = 0;
<a name="l01103"></a>01103         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY = 0;
<a name="l01104"></a>01104         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost = (<span class="keywordtype">int</span>)(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a> *
<a name="l01105"></a>01105                                                               EnvNAVXYTHETALATCfg.timetoturn45degsinplace_secs);
<a name="l01106"></a>01106 
<a name="l01107"></a>01107         <span class="comment">//compute intersecting cells</span>
<a name="l01108"></a>01108         pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01109"></a>01109         pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01110"></a>01110         pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> =
<a name="l01111"></a>01111                 <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01112"></a>01112         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intermptV.clear();
<a name="l01113"></a>01113         EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV.clear();
<a name="l01114"></a>01114         <a class="code" href="utils_8h.html#aa1d716066678dafff330461b04b5de60">get_2d_footprint_cells</a>(EnvNAVXYTHETALATCfg.FootprintPolygon,
<a name="l01115"></a>01115                                &amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV, pose,
<a name="l01116"></a>01116                                EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01117"></a>01117         RemoveSourceFootprint(sourcepose, &amp;EnvNAVXYTHETALATCfg.ActionsV[tind][aind].intersectingcellsV);
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="preprocessor">#if DEBUG</span>
<a name="l01120"></a>01120 <span class="preprocessor"></span>        <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;action tind=%d aind=%d: endtheta=%d (%f) dX=%d dY=%d cost=%d\n&quot;</span>,
<a name="l01121"></a>01121                     tind, aind, EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta, <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta, EnvNAVXYTHETALATCfg.NumThetaDirs),
<a name="l01122"></a>01122                     EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dX, EnvNAVXYTHETALATCfg.ActionsV[tind][aind].dY,
<a name="l01123"></a>01123                     EnvNAVXYTHETALATCfg.ActionsV[tind][aind].cost);
<a name="l01124"></a>01124 <span class="preprocessor">#endif</span>
<a name="l01125"></a>01125 <span class="preprocessor"></span>
<a name="l01126"></a>01126         <span class="comment">//add to the list of backward actions</span>
<a name="l01127"></a>01127         targettheta = EnvNAVXYTHETALATCfg.ActionsV[tind][aind].endtheta;
<a name="l01128"></a>01128         <span class="keywordflow">if</span> (targettheta &lt; 0) targettheta = targettheta + EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l01129"></a>01129         EnvNAVXYTHETALATCfg.PredActionsV[targettheta].push_back(&amp;(EnvNAVXYTHETALATCfg.ActionsV[tind][aind]));
<a name="l01130"></a>01130     }
<a name="l01131"></a>01131 
<a name="l01132"></a>01132     <span class="comment">//now compute replanning data</span>
<a name="l01133"></a>01133     ComputeReplanningData();
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;done pre-computing action data\n&quot;</span>);
<a name="l01136"></a>01136 }
<a name="l01137"></a>01137 
<a name="l01138"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ab6299d4fc0cbd3f6ae1dfdba92bbbd06">01138</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ab6299d4fc0cbd3f6ae1dfdba92bbbd06">EnvironmentNAVXYTHETALATTICE::InitializeEnvConfig</a>(vector&lt;SBPL_xytheta_mprimitive&gt;* motionprimitiveV)
<a name="l01139"></a>01139 {
<a name="l01140"></a>01140     <span class="comment">//aditional to configuration file initialization of EnvNAVXYTHETALATCfg if necessary</span>
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <span class="comment">//dXY dirs</span>
<a name="l01143"></a>01143     EnvNAVXYTHETALATCfg.dXY[0][0] = -1;
<a name="l01144"></a>01144     EnvNAVXYTHETALATCfg.dXY[0][1] = -1;
<a name="l01145"></a>01145     EnvNAVXYTHETALATCfg.dXY[1][0] = -1;
<a name="l01146"></a>01146     EnvNAVXYTHETALATCfg.dXY[1][1] = 0;
<a name="l01147"></a>01147     EnvNAVXYTHETALATCfg.dXY[2][0] = -1;
<a name="l01148"></a>01148     EnvNAVXYTHETALATCfg.dXY[2][1] = 1;
<a name="l01149"></a>01149     EnvNAVXYTHETALATCfg.dXY[3][0] = 0;
<a name="l01150"></a>01150     EnvNAVXYTHETALATCfg.dXY[3][1] = -1;
<a name="l01151"></a>01151     EnvNAVXYTHETALATCfg.dXY[4][0] = 0;
<a name="l01152"></a>01152     EnvNAVXYTHETALATCfg.dXY[4][1] = 1;
<a name="l01153"></a>01153     EnvNAVXYTHETALATCfg.dXY[5][0] = 1;
<a name="l01154"></a>01154     EnvNAVXYTHETALATCfg.dXY[5][1] = -1;
<a name="l01155"></a>01155     EnvNAVXYTHETALATCfg.dXY[6][0] = 1;
<a name="l01156"></a>01156     EnvNAVXYTHETALATCfg.dXY[6][1] = 0;
<a name="l01157"></a>01157     EnvNAVXYTHETALATCfg.dXY[7][0] = 1;
<a name="l01158"></a>01158     EnvNAVXYTHETALATCfg.dXY[7][1] = 1;
<a name="l01159"></a>01159 
<a name="l01160"></a>01160     <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> temppose;
<a name="l01161"></a>01161     temppose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = 0.0;
<a name="l01162"></a>01162     temppose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = 0.0;
<a name="l01163"></a>01163     temppose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = 0.0;
<a name="l01164"></a>01164     vector&lt;sbpl_2Dcell_t&gt; footprint;
<a name="l01165"></a>01165     <a class="code" href="utils_8h.html#aa1d716066678dafff330461b04b5de60">get_2d_footprint_cells</a>(EnvNAVXYTHETALATCfg.FootprintPolygon, &amp;footprint, temppose, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01166"></a>01166     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;number of cells in footprint of the robot = %d\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)footprint.size());
<a name="l01167"></a>01167 
<a name="l01168"></a>01168     <span class="keywordflow">for</span> (vector&lt;sbpl_2Dcell_t&gt;::iterator it = footprint.begin(); it != footprint.end(); ++it) {
<a name="l01169"></a>01169         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Footprint cell at (%d, %d)\n&quot;</span>, it-&gt;x, it-&gt;y);
<a name="l01170"></a>01170     }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172 <span class="preprocessor">#if DEBUG</span>
<a name="l01173"></a>01173 <span class="preprocessor"></span>    <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;footprint cells (size=%d):\n&quot;</span>, (<span class="keywordtype">int</span>)footprint.size());
<a name="l01174"></a>01174     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; (int) footprint.size(); i++)
<a name="l01175"></a>01175     {
<a name="l01176"></a>01176         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;%d %d (cont: %.3f %.3f)\n&quot;</span>, footprint.at(i).x, footprint.at(i).y,
<a name="l01177"></a>01177                      <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(footprint.at(i).x, EnvNAVXYTHETALATCfg.cellsize_m),
<a name="l01178"></a>01178                      <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(footprint.at(i).y, EnvNAVXYTHETALATCfg.cellsize_m));
<a name="l01179"></a>01179     }
<a name="l01180"></a>01180 <span class="preprocessor">#endif</span>
<a name="l01181"></a>01181 <span class="preprocessor"></span>
<a name="l01182"></a>01182     <span class="keywordflow">if</span> (motionprimitiveV == NULL)
<a name="l01183"></a>01183         DeprecatedPrecomputeActions();
<a name="l01184"></a>01184     <span class="keywordflow">else</span>
<a name="l01185"></a>01185         PrecomputeActionswithCompleteMotionPrimitive(motionprimitiveV);
<a name="l01186"></a>01186 }
<a name="l01187"></a>01187 
<a name="l01188"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a7cff16321e1d7c1500f3e4154cb98671">01188</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a7cff16321e1d7c1500f3e4154cb98671">EnvironmentNAVXYTHETALATTICE::IsValidCell</a>(<span class="keywordtype">int</span> X, <span class="keywordtype">int</span> Y)
<a name="l01189"></a>01189 {
<a name="l01190"></a>01190     <span class="keywordflow">return</span> (X &gt;= 0 &amp;&amp; X &lt; EnvNAVXYTHETALATCfg.EnvWidth_c &amp;&amp; Y &gt;= 0 &amp;&amp; Y &lt; EnvNAVXYTHETALATCfg.EnvHeight_c &amp;&amp;
<a name="l01191"></a>01191             EnvNAVXYTHETALATCfg.Grid2D[X][Y] &lt; EnvNAVXYTHETALATCfg.obsthresh);
<a name="l01192"></a>01192 }
<a name="l01193"></a>01193 
<a name="l01194"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a5a8d9f94ed44a9457a025a1a4a896e96">01194</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a5a8d9f94ed44a9457a025a1a4a896e96" title="returns true if cell is within map">EnvironmentNAVXYTHETALATTICE::IsWithinMapCell</a>(<span class="keywordtype">int</span> X, <span class="keywordtype">int</span> Y)
<a name="l01195"></a>01195 {
<a name="l01196"></a>01196     <span class="keywordflow">return</span> (X &gt;= 0 &amp;&amp; X &lt; EnvNAVXYTHETALATCfg.EnvWidth_c &amp;&amp; Y &gt;= 0 &amp;&amp; Y &lt; EnvNAVXYTHETALATCfg.EnvHeight_c);
<a name="l01197"></a>01197 }
<a name="l01198"></a>01198 
<a name="l01199"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ab16e1250b7dc53260be17da85a6b0450">01199</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ab16e1250b7dc53260be17da85a6b0450" title="returns false if robot intersects obstacles or lies outside of the map. Note this is pretty expensive...">EnvironmentNAVXYTHETALATTICE::IsValidConfiguration</a>(<span class="keywordtype">int</span> X, <span class="keywordtype">int</span> Y, <span class="keywordtype">int</span> Theta)
<a name="l01200"></a>01200 {
<a name="l01201"></a>01201     vector&lt;sbpl_2Dcell_t&gt; footprint;
<a name="l01202"></a>01202     <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> pose;
<a name="l01203"></a>01203 
<a name="l01204"></a>01204     <span class="comment">//compute continuous pose</span>
<a name="l01205"></a>01205     pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(X, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01206"></a>01206     pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(Y, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01207"></a>01207     pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a> = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(Theta, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209     <span class="comment">//compute footprint cells</span>
<a name="l01210"></a>01210     <a class="code" href="utils_8h.html#aa1d716066678dafff330461b04b5de60">get_2d_footprint_cells</a>(EnvNAVXYTHETALATCfg.FootprintPolygon, &amp;footprint, pose, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212     <span class="comment">//iterate over all footprint cells</span>
<a name="l01213"></a>01213     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> find = 0; find &lt; (int)footprint.size(); find++) {
<a name="l01214"></a>01214         <span class="keywordtype">int</span> x = footprint.at(find).x;
<a name="l01215"></a>01215         <span class="keywordtype">int</span> y = footprint.at(find).y;
<a name="l01216"></a>01216 
<a name="l01217"></a>01217         <span class="keywordflow">if</span> (x &lt; 0 || x &gt;= EnvNAVXYTHETALATCfg.EnvWidth_c || y &lt; 0 || y &gt;= EnvNAVXYTHETALATCfg.EnvHeight_c ||
<a name="l01218"></a>01218             EnvNAVXYTHETALATCfg.Grid2D[x][y] &gt;= EnvNAVXYTHETALATCfg.obsthresh)
<a name="l01219"></a>01219         {
<a name="l01220"></a>01220             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01221"></a>01221         }
<a name="l01222"></a>01222     }
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01225"></a>01225 }
<a name="l01226"></a>01226 
<a name="l01227"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a084fd43713376c321fbb84c850bf589f">01227</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a084fd43713376c321fbb84c850bf589f">EnvironmentNAVXYTHETALATTICE::GetActionCost</a>(<span class="keywordtype">int</span> SourceX, <span class="keywordtype">int</span> SourceY, <span class="keywordtype">int</span> SourceTheta,
<a name="l01228"></a>01228                                                 <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>* action)
<a name="l01229"></a>01229 {
<a name="l01230"></a>01230     <a class="code" href="classsbpl__2_dcell__t.html">sbpl_2Dcell_t</a> cell;
<a name="l01231"></a>01231     <a class="code" href="classsbpl__xy__theta__cell__t.html">sbpl_xy_theta_cell_t</a> interm3Dcell;
<a name="l01232"></a>01232     <span class="keywordtype">int</span> i;
<a name="l01233"></a>01233 
<a name="l01234"></a>01234     <span class="comment">//TODO - go over bounding box (minpt and maxpt) to test validity and skip</span>
<a name="l01235"></a>01235     <span class="comment">//testing boundaries below, also order intersect cells so that the four</span>
<a name="l01236"></a>01236     <span class="comment">//farthest pts go first</span>
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     <span class="keywordflow">if</span> (!IsValidCell(SourceX, SourceY)) <span class="keywordflow">return</span> <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l01239"></a>01239     <span class="keywordflow">if</span> (!IsValidCell(SourceX + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>, SourceY + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>)) <span class="keywordflow">return</span> <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l01240"></a>01240 
<a name="l01241"></a>01241     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.Grid2D[SourceX + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>][SourceY + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>] &gt;=
<a name="l01242"></a>01242         EnvNAVXYTHETALATCfg.cost_inscribed_thresh) 
<a name="l01243"></a>01243     {
<a name="l01244"></a>01244         <span class="keywordflow">return</span> <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l01245"></a>01245     }
<a name="l01246"></a>01246 
<a name="l01247"></a>01247     <span class="comment">//need to iterate over discretized center cells and compute cost based on them</span>
<a name="l01248"></a>01248     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> maxcellcost = 0;
<a name="l01249"></a>01249     <span class="keywordflow">for</span> (i = 0; i &lt; (int)action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#a7eab45f24eee48b225cdfe2967a79e47">interm3DcellsV</a>.size(); i++) {
<a name="l01250"></a>01250         interm3Dcell = action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#a7eab45f24eee48b225cdfe2967a79e47">interm3DcellsV</a>.at(i);
<a name="l01251"></a>01251         interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> + SourceX;
<a name="l01252"></a>01252         interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> + SourceY;
<a name="l01253"></a>01253 
<a name="l01254"></a>01254         <span class="keywordflow">if</span> (interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> &lt; 0 || interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> &gt;= EnvNAVXYTHETALATCfg.EnvWidth_c || interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> &lt; 0
<a name="l01255"></a>01255             || interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> &gt;= EnvNAVXYTHETALATCfg.EnvHeight_c) <span class="keywordflow">return</span> <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l01256"></a>01256 
<a name="l01257"></a>01257         maxcellcost = <a class="code" href="utils_8h.html#af643213a7d426b69429d1430cef4ecbb">__max</a>(maxcellcost, EnvNAVXYTHETALATCfg.Grid2D[interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a>][interm3Dcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a>]);
<a name="l01258"></a>01258 
<a name="l01259"></a>01259         <span class="comment">//check that the robot is NOT in the cell at which there is no valid orientation</span>
<a name="l01260"></a>01260         <span class="keywordflow">if</span> (maxcellcost &gt;= EnvNAVXYTHETALATCfg.cost_inscribed_thresh) <span class="keywordflow">return</span> <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l01261"></a>01261     }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263     <span class="comment">//check collisions that for the particular footprint orientation along the action</span>
<a name="l01264"></a>01264     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.FootprintPolygon.size() &gt; 1 &amp;&amp; (int)maxcellcost &gt;=
<a name="l01265"></a>01265         EnvNAVXYTHETALATCfg.cost_possibly_circumscribed_thresh)
<a name="l01266"></a>01266     {
<a name="l01267"></a>01267         checks++;
<a name="l01268"></a>01268 
<a name="l01269"></a>01269         <span class="keywordflow">for</span> (i = 0; i &lt; (int)action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ade0b6d3a6a7f6bcb093ba4a53270bc90">intersectingcellsV</a>.size(); i++) {
<a name="l01270"></a>01270             <span class="comment">//get the cell in the map</span>
<a name="l01271"></a>01271             cell = action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ade0b6d3a6a7f6bcb093ba4a53270bc90">intersectingcellsV</a>.at(i);
<a name="l01272"></a>01272             cell.<a class="code" href="classsbpl__2_dcell__t.html#a30bc3b76157701214faf27b29eb954af">x</a> = cell.<a class="code" href="classsbpl__2_dcell__t.html#a30bc3b76157701214faf27b29eb954af">x</a> + SourceX;
<a name="l01273"></a>01273             cell.<a class="code" href="classsbpl__2_dcell__t.html#ab474c032c107f010381228610a0493a0">y</a> = cell.<a class="code" href="classsbpl__2_dcell__t.html#ab474c032c107f010381228610a0493a0">y</a> + SourceY;
<a name="l01274"></a>01274 
<a name="l01275"></a>01275             <span class="comment">//check validity</span>
<a name="l01276"></a>01276             <span class="keywordflow">if</span> (!IsValidCell(cell.<a class="code" href="classsbpl__2_dcell__t.html#a30bc3b76157701214faf27b29eb954af">x</a>, cell.<a class="code" href="classsbpl__2_dcell__t.html#ab474c032c107f010381228610a0493a0">y</a>)) <span class="keywordflow">return</span> <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l01277"></a>01277 
<a name="l01278"></a>01278             <span class="comment">//if(EnvNAVXYTHETALATCfg.Grid2D[cell.x][cell.y] &gt; currentmaxcost)</span>
<a name="l01280"></a>01280 <span class="comment"></span>            <span class="comment">//robot along action)</span>
<a name="l01281"></a>01281             <span class="comment">//  currentmaxcost = EnvNAVXYTHETALATCfg.Grid2D[cell.x][cell.y];</span>
<a name="l01282"></a>01282             <span class="comment">//  //intersecting cells are only used for collision checking</span>
<a name="l01283"></a>01283         }
<a name="l01284"></a>01284     }
<a name="l01285"></a>01285 
<a name="l01286"></a>01286     <span class="comment">//to ensure consistency of h2D:</span>
<a name="l01287"></a>01287     maxcellcost = <a class="code" href="utils_8h.html#af643213a7d426b69429d1430cef4ecbb">__max</a>(maxcellcost, EnvNAVXYTHETALATCfg.Grid2D[SourceX][SourceY]);
<a name="l01288"></a>01288     <span class="keywordtype">int</span> currentmaxcost =
<a name="l01289"></a>01289             (int)<a class="code" href="utils_8h.html#af643213a7d426b69429d1430cef4ecbb">__max</a>(maxcellcost, EnvNAVXYTHETALATCfg.Grid2D[SourceX + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>][SourceY + action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>]);
<a name="l01290"></a>01290 
<a name="l01291"></a>01291     <span class="keywordflow">return</span> action-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#abed9f11cce67565f6c9f5ff90740ccd7">cost</a> * (currentmaxcost + 1); <span class="comment">//use cell cost as multiplicative factor</span>
<a name="l01292"></a>01292 }
<a name="l01293"></a>01293 
<a name="l01294"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a30b6b2ae4124dbec7b70c1b513cc5e8b">01294</a> <span class="keywordtype">double</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a30b6b2ae4124dbec7b70c1b513cc5e8b">EnvironmentNAVXYTHETALATTICE::EuclideanDistance_m</a>(<span class="keywordtype">int</span> X1, <span class="keywordtype">int</span> Y1, <span class="keywordtype">int</span> X2, <span class="keywordtype">int</span> Y2)
<a name="l01295"></a>01295 {
<a name="l01296"></a>01296     <span class="keywordtype">int</span> sqdist = ((X1 - X2) * (X1 - X2) + (Y1 - Y2) * (Y1 - Y2));
<a name="l01297"></a>01297     <span class="keywordflow">return</span> EnvNAVXYTHETALATCfg.cellsize_m * sqrt((<span class="keywordtype">double</span>)sqdist);
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300 <span class="comment">//calculates a set of cells that correspond to the specified footprint</span>
<a name="l01301"></a>01301 <span class="comment">//adds points to it (does not clear it beforehand)</span>
<a name="l01302"></a>01302 <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a51e822c2abc1da2949a59fa495c5cda1">EnvironmentNAVXYTHETALATTICE::CalculateFootprintForPose</a>(<a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> pose, vector&lt;sbpl_2Dcell_t&gt;* footprint,
<a name="l01303"></a>01303                                                              <span class="keyword">const</span> vector&lt;sbpl_2Dpt_t&gt;&amp; FootprintPolygon)
<a name="l01304"></a>01304 {
<a name="l01305"></a>01305     <span class="keywordtype">int</span> pind;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307 <span class="preprocessor">#if DEBUG</span>
<a name="l01308"></a>01308 <span class="preprocessor"></span>    <span class="comment">//  SBPL_PRINTF(&quot;---Calculating Footprint for Pose: %f %f %f---\n&quot;,</span>
<a name="l01309"></a>01309     <span class="comment">//   pose.x, pose.y, pose.theta);</span>
<a name="l01310"></a>01310 <span class="preprocessor">#endif</span>
<a name="l01311"></a>01311 <span class="preprocessor"></span>
<a name="l01312"></a>01312     <span class="comment">//handle special case where footprint is just a point</span>
<a name="l01313"></a>01313     <span class="keywordflow">if</span> (FootprintPolygon.size() &lt;= 1) {
<a name="l01314"></a>01314         <a class="code" href="classsbpl__2_dcell__t.html">sbpl_2Dcell_t</a> cell;
<a name="l01315"></a>01315         cell.<a class="code" href="classsbpl__2_dcell__t.html#a30bc3b76157701214faf27b29eb954af">x</a> = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a>, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01316"></a>01316         cell.<a class="code" href="classsbpl__2_dcell__t.html#ab474c032c107f010381228610a0493a0">y</a> = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a>, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01317"></a>01317 
<a name="l01318"></a>01318         <span class="keywordflow">for</span> (pind = 0; pind &lt; (int)footprint-&gt;size(); pind++) {
<a name="l01319"></a>01319             <span class="keywordflow">if</span> (cell.<a class="code" href="classsbpl__2_dcell__t.html#a30bc3b76157701214faf27b29eb954af">x</a> == footprint-&gt;at(pind).x &amp;&amp; cell.<a class="code" href="classsbpl__2_dcell__t.html#ab474c032c107f010381228610a0493a0">y</a> == footprint-&gt;at(pind).y) <span class="keywordflow">break</span>;
<a name="l01320"></a>01320         }
<a name="l01321"></a>01321         <span class="keywordflow">if</span> (pind == (<span class="keywordtype">int</span>)footprint-&gt;size()) footprint-&gt;push_back(cell);
<a name="l01322"></a>01322         <span class="keywordflow">return</span>;
<a name="l01323"></a>01323     }
<a name="l01324"></a>01324 
<a name="l01325"></a>01325     vector&lt;sbpl_2Dpt_t&gt; bounding_polygon;
<a name="l01326"></a>01326     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> find;
<a name="l01327"></a>01327     <span class="keywordtype">double</span> max_x = -<a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>, min_x = <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>, max_y = -<a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>, min_y = <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l01328"></a>01328     <a class="code" href="classsbpl__2_dpt__t.html">sbpl_2Dpt_t</a> pt(0, 0);
<a name="l01329"></a>01329     <span class="keywordflow">for</span> (find = 0; find &lt; FootprintPolygon.size(); find++) {
<a name="l01330"></a>01330         <span class="comment">//rotate and translate the corner of the robot</span>
<a name="l01331"></a>01331         pt = FootprintPolygon[find];
<a name="l01332"></a>01332 
<a name="l01333"></a>01333         <span class="comment">//rotate and translate the point</span>
<a name="l01334"></a>01334         <a class="code" href="classsbpl__2_dpt__t.html">sbpl_2Dpt_t</a> corner;
<a name="l01335"></a>01335         corner.<a class="code" href="classsbpl__2_dpt__t.html#a17ac7c9476ed0b5aac2b2b157c5afc86">x</a> = cos(pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>) * pt.x - sin(pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>) * pt.y + pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a>;
<a name="l01336"></a>01336         corner.<a class="code" href="classsbpl__2_dpt__t.html#a0baa548c47bf8dcd9f31086013d4d1e1">y</a> = sin(pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>) * pt.x + cos(pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>) * pt.y + pose.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a>;
<a name="l01337"></a>01337         bounding_polygon.push_back(corner);
<a name="l01338"></a>01338 <span class="preprocessor">#if DEBUG</span>
<a name="l01339"></a>01339 <span class="preprocessor"></span>        <span class="comment">//    SBPL_PRINTF(&quot;Pt: %f %f, Corner: %f %f\n&quot;, pt.x, pt.y, corner.x, corner.y);</span>
<a name="l01340"></a>01340 <span class="preprocessor">#endif</span>
<a name="l01341"></a>01341 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (corner.<a class="code" href="classsbpl__2_dpt__t.html#a17ac7c9476ed0b5aac2b2b157c5afc86">x</a> &lt; min_x || find == 0) {
<a name="l01342"></a>01342             min_x = corner.<a class="code" href="classsbpl__2_dpt__t.html#a17ac7c9476ed0b5aac2b2b157c5afc86">x</a>;
<a name="l01343"></a>01343         }
<a name="l01344"></a>01344         <span class="keywordflow">if</span> (corner.<a class="code" href="classsbpl__2_dpt__t.html#a17ac7c9476ed0b5aac2b2b157c5afc86">x</a> &gt; max_x || find == 0) {
<a name="l01345"></a>01345             max_x = corner.<a class="code" href="classsbpl__2_dpt__t.html#a17ac7c9476ed0b5aac2b2b157c5afc86">x</a>;
<a name="l01346"></a>01346         }
<a name="l01347"></a>01347         <span class="keywordflow">if</span> (corner.<a class="code" href="classsbpl__2_dpt__t.html#a0baa548c47bf8dcd9f31086013d4d1e1">y</a> &lt; min_y || find == 0) {
<a name="l01348"></a>01348             min_y = corner.<a class="code" href="classsbpl__2_dpt__t.html#a0baa548c47bf8dcd9f31086013d4d1e1">y</a>;
<a name="l01349"></a>01349         }
<a name="l01350"></a>01350         <span class="keywordflow">if</span> (corner.<a class="code" href="classsbpl__2_dpt__t.html#a0baa548c47bf8dcd9f31086013d4d1e1">y</a> &gt; max_y || find == 0) {
<a name="l01351"></a>01351             max_y = corner.<a class="code" href="classsbpl__2_dpt__t.html#a0baa548c47bf8dcd9f31086013d4d1e1">y</a>;
<a name="l01352"></a>01352         }
<a name="l01353"></a>01353     }
<a name="l01354"></a>01354 
<a name="l01355"></a>01355 <span class="preprocessor">#if DEBUG</span>
<a name="l01356"></a>01356 <span class="preprocessor"></span>    <span class="comment">//  SBPL_PRINTF(&quot;Footprint bounding box: %f %f %f %f\n&quot;, min_x, max_x, min_y, max_y);</span>
<a name="l01357"></a>01357 <span class="preprocessor">#endif</span>
<a name="l01358"></a>01358 <span class="preprocessor"></span>    <span class="comment">//initialize previous values to something that will fail the if condition during the first iteration in the for loop</span>
<a name="l01359"></a>01359     <span class="keywordtype">int</span> prev_discrete_x = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(pt.x, EnvNAVXYTHETALATCfg.cellsize_m) + 1;
<a name="l01360"></a>01360     <span class="keywordtype">int</span> prev_discrete_y = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(pt.y, EnvNAVXYTHETALATCfg.cellsize_m) + 1;
<a name="l01361"></a>01361     <span class="keywordtype">int</span> prev_inside = 0;
<a name="l01362"></a>01362     <span class="keywordtype">int</span> discrete_x;
<a name="l01363"></a>01363     <span class="keywordtype">int</span> discrete_y;
<a name="l01364"></a>01364 
<a name="l01365"></a>01365     <span class="keywordflow">for</span> (<span class="keywordtype">double</span> x = min_x; x &lt;= max_x; x += EnvNAVXYTHETALATCfg.cellsize_m / 3) {
<a name="l01366"></a>01366         <span class="keywordflow">for</span> (<span class="keywordtype">double</span> y = min_y; y &lt;= max_y; y += EnvNAVXYTHETALATCfg.cellsize_m / 3) {
<a name="l01367"></a>01367             pt.x = x;
<a name="l01368"></a>01368             pt.y = y;
<a name="l01369"></a>01369             discrete_x = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(pt.x, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01370"></a>01370             discrete_y = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(pt.y, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01371"></a>01371 
<a name="l01372"></a>01372             <span class="comment">//see if we just tested this point</span>
<a name="l01373"></a>01373             <span class="keywordflow">if</span> (discrete_x != prev_discrete_x || discrete_y != prev_discrete_y || prev_inside == 0) {
<a name="l01374"></a>01374 
<a name="l01375"></a>01375 <span class="preprocessor">#if DEBUG</span>
<a name="l01376"></a>01376 <span class="preprocessor"></span>                <span class="comment">//              SBPL_PRINTF(&quot;Testing point: %f %f Discrete: %d %d\n&quot;, pt.x, pt.y, discrete_x, discrete_y);</span>
<a name="l01377"></a>01377 <span class="preprocessor">#endif</span>
<a name="l01378"></a>01378 <span class="preprocessor"></span>
<a name="l01379"></a>01379                 <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a6c7dbec20364cda8d5d47be248351f65" title="returns true if 2D point is within the specified polygon given by ordered sequence of 2D points (last...">IsInsideFootprint</a>(pt, &amp;bounding_polygon)) {
<a name="l01380"></a>01380                     <span class="comment">//convert to a grid point</span>
<a name="l01381"></a>01381 
<a name="l01382"></a>01382 <span class="preprocessor">#if DEBUG</span>
<a name="l01383"></a>01383 <span class="preprocessor"></span>                    <span class="comment">//                  SBPL_PRINTF(&quot;Pt Inside %f %f\n&quot;, pt.x, pt.y);</span>
<a name="l01384"></a>01384 <span class="preprocessor">#endif</span>
<a name="l01385"></a>01385 <span class="preprocessor"></span>
<a name="l01386"></a>01386                     <a class="code" href="classsbpl__2_dcell__t.html">sbpl_2Dcell_t</a> cell;
<a name="l01387"></a>01387                     cell.<a class="code" href="classsbpl__2_dcell__t.html#a30bc3b76157701214faf27b29eb954af">x</a> = discrete_x;
<a name="l01388"></a>01388                     cell.<a class="code" href="classsbpl__2_dcell__t.html#ab474c032c107f010381228610a0493a0">y</a> = discrete_y;
<a name="l01389"></a>01389 
<a name="l01390"></a>01390                     <span class="comment">//insert point if not there already</span>
<a name="l01391"></a>01391                     <span class="keywordtype">int</span> pind = 0;
<a name="l01392"></a>01392                     <span class="keywordflow">for</span> (pind = 0; pind &lt; (int)footprint-&gt;size(); pind++) {
<a name="l01393"></a>01393                         <span class="keywordflow">if</span> (cell.<a class="code" href="classsbpl__2_dcell__t.html#a30bc3b76157701214faf27b29eb954af">x</a> == footprint-&gt;at(pind).x &amp;&amp; cell.<a class="code" href="classsbpl__2_dcell__t.html#ab474c032c107f010381228610a0493a0">y</a> == footprint-&gt;at(pind).y) <span class="keywordflow">break</span>;
<a name="l01394"></a>01394                     }
<a name="l01395"></a>01395                     <span class="keywordflow">if</span> (pind == (<span class="keywordtype">int</span>)footprint-&gt;size()) footprint-&gt;push_back(cell);
<a name="l01396"></a>01396 
<a name="l01397"></a>01397                     prev_inside = 1;
<a name="l01398"></a>01398 
<a name="l01399"></a>01399 <span class="preprocessor">#if DEBUG</span>
<a name="l01400"></a>01400 <span class="preprocessor"></span>                    <span class="comment">//                  SBPL_PRINTF(&quot;Added pt to footprint: %f %f\n&quot;, pt.x, pt.y);</span>
<a name="l01401"></a>01401 <span class="preprocessor">#endif</span>
<a name="l01402"></a>01402 <span class="preprocessor"></span>                }
<a name="l01403"></a>01403                 <span class="keywordflow">else</span> {
<a name="l01404"></a>01404                     prev_inside = 0;
<a name="l01405"></a>01405                 }
<a name="l01406"></a>01406 
<a name="l01407"></a>01407             }
<a name="l01408"></a>01408             <span class="keywordflow">else</span> {
<a name="l01409"></a>01409 <span class="preprocessor">#if DEBUG</span>
<a name="l01410"></a>01410 <span class="preprocessor"></span>                <span class="comment">//SBPL_PRINTF(&quot;Skipping pt: %f %f\n&quot;, pt.x, pt.y);</span>
<a name="l01411"></a>01411 <span class="preprocessor">#endif</span>
<a name="l01412"></a>01412 <span class="preprocessor"></span>            }
<a name="l01413"></a>01413 
<a name="l01414"></a>01414             prev_discrete_x = discrete_x;
<a name="l01415"></a>01415             prev_discrete_y = discrete_y;
<a name="l01416"></a>01416         }<span class="comment">//over x_min...x_max</span>
<a name="l01417"></a>01417     }
<a name="l01418"></a>01418 }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420 <span class="comment">//calculates a set of cells that correspond to the footprint of the base</span>
<a name="l01421"></a>01421 <span class="comment">//adds points to it (does not clear it beforehand) </span>
<a name="l01422"></a>01422 <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a51e822c2abc1da2949a59fa495c5cda1">EnvironmentNAVXYTHETALATTICE::CalculateFootprintForPose</a>(<a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> pose, vector&lt;sbpl_2Dcell_t&gt;* footprint)
<a name="l01423"></a>01423 {
<a name="l01424"></a>01424     CalculateFootprintForPose(pose, footprint, EnvNAVXYTHETALATCfg.FootprintPolygon);
<a name="l01425"></a>01425 }
<a name="l01426"></a>01426 
<a name="l01427"></a>01427 <span class="comment">//removes a set of cells that correspond to the specified footprint at the sourcepose</span>
<a name="l01428"></a>01428 <span class="comment">//adds points to it (does not clear it beforehand) </span>
<a name="l01429"></a>01429 <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ae625f1346306dc57d8e10faa45bfe3e2">EnvironmentNAVXYTHETALATTICE::RemoveSourceFootprint</a>(<a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> sourcepose,
<a name="l01430"></a>01430                                                          vector&lt;sbpl_2Dcell_t&gt;* footprint,
<a name="l01431"></a>01431                                                          <span class="keyword">const</span> vector&lt;sbpl_2Dpt_t&gt;&amp; FootprintPolygon)
<a name="l01432"></a>01432 {
<a name="l01433"></a>01433     vector&lt;sbpl_2Dcell_t&gt; sourcefootprint;
<a name="l01434"></a>01434 
<a name="l01435"></a>01435     <span class="comment">//compute source footprint</span>
<a name="l01436"></a>01436     <a class="code" href="utils_8h.html#aa1d716066678dafff330461b04b5de60">get_2d_footprint_cells</a>(FootprintPolygon, &amp;sourcefootprint, sourcepose, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01437"></a>01437 
<a name="l01438"></a>01438     <span class="comment">//now remove the source cells from the footprint</span>
<a name="l01439"></a>01439     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sind = 0; sind &lt; (int)sourcefootprint.size(); sind++) {
<a name="l01440"></a>01440         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> find = 0; find &lt; (int)footprint-&gt;size(); find++) {
<a name="l01441"></a>01441             <span class="keywordflow">if</span> (sourcefootprint.at(sind).x == footprint-&gt;at(find).x &amp;&amp; sourcefootprint.at(sind).y
<a name="l01442"></a>01442                 == footprint-&gt;at(find).y) {
<a name="l01443"></a>01443                 footprint-&gt;erase(footprint-&gt;begin() + find);
<a name="l01444"></a>01444                 <span class="keywordflow">break</span>;
<a name="l01445"></a>01445             }
<a name="l01446"></a>01446         }<span class="comment">//over footprint</span>
<a name="l01447"></a>01447     }<span class="comment">//over source</span>
<a name="l01448"></a>01448 }
<a name="l01449"></a>01449 
<a name="l01450"></a>01450 <span class="comment">//removes a set of cells that correspond to the footprint of the base at the sourcepose</span>
<a name="l01451"></a>01451 <span class="comment">//adds points to it (does not clear it beforehand) </span>
<a name="l01452"></a>01452 <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ae625f1346306dc57d8e10faa45bfe3e2">EnvironmentNAVXYTHETALATTICE::RemoveSourceFootprint</a>(<a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> sourcepose,
<a name="l01453"></a>01453                                                          vector&lt;sbpl_2Dcell_t&gt;* footprint)
<a name="l01454"></a>01454 {
<a name="l01455"></a>01455     RemoveSourceFootprint(sourcepose, footprint, EnvNAVXYTHETALATCfg.FootprintPolygon);
<a name="l01456"></a>01456 }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l01459"></a>01459 
<a name="l01460"></a>01460 <span class="comment">//------------------------------Heuristic computation--------------------------</span>
<a name="l01461"></a>01461 
<a name="l01462"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a68a0e6797baded537bff67b544998bd5">01462</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a68a0e6797baded537bff67b544998bd5" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALATTICE::EnsureHeuristicsUpdated</a>(<span class="keywordtype">bool</span> bGoalHeuristics)
<a name="l01463"></a>01463 {
<a name="l01464"></a>01464     <span class="keywordflow">if</span> (bNeedtoRecomputeStartHeuristics &amp;&amp; !bGoalHeuristics) {
<a name="l01465"></a>01465         grid2Dsearchfromstart-&gt;search(EnvNAVXYTHETALATCfg.Grid2D, EnvNAVXYTHETALATCfg.cost_inscribed_thresh,
<a name="l01466"></a>01466                                       EnvNAVXYTHETALATCfg.StartX_c, EnvNAVXYTHETALATCfg.StartY_c,
<a name="l01467"></a>01467                                       EnvNAVXYTHETALATCfg.EndX_c, EnvNAVXYTHETALATCfg.EndY_c,
<a name="l01468"></a>01468                                       <a class="code" href="2_dgridsearch_8h.html#a966f68e754058798c004bcb0e6dde86ba29052a8c8b576fef6ee4de7e3fef0616">SBPL_2DGRIDSEARCH_TERM_CONDITION_TWOTIMESOPTPATH</a>);
<a name="l01469"></a>01469         bNeedtoRecomputeStartHeuristics = <span class="keyword">false</span>;
<a name="l01470"></a>01470         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;2dsolcost_infullunits=%d\n&quot;</span>,
<a name="l01471"></a>01471                     (<span class="keywordtype">int</span>)(grid2Dsearchfromstart-&gt;getlowerboundoncostfromstart_inmm(EnvNAVXYTHETALATCfg.EndX_c,
<a name="l01472"></a>01472                                                                                    EnvNAVXYTHETALATCfg.EndY_c) /
<a name="l01473"></a>01473                           EnvNAVXYTHETALATCfg.nominalvel_mpersecs));
<a name="l01474"></a>01474 
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     <span class="keywordflow">if</span> (bNeedtoRecomputeGoalHeuristics &amp;&amp; bGoalHeuristics) {
<a name="l01478"></a>01478         grid2Dsearchfromgoal-&gt;search(EnvNAVXYTHETALATCfg.Grid2D, EnvNAVXYTHETALATCfg.cost_inscribed_thresh,
<a name="l01479"></a>01479                                      EnvNAVXYTHETALATCfg.EndX_c, EnvNAVXYTHETALATCfg.EndY_c,
<a name="l01480"></a>01480                                      EnvNAVXYTHETALATCfg.StartX_c, EnvNAVXYTHETALATCfg.StartY_c,
<a name="l01481"></a>01481                                      <a class="code" href="2_dgridsearch_8h.html#a966f68e754058798c004bcb0e6dde86ba29052a8c8b576fef6ee4de7e3fef0616">SBPL_2DGRIDSEARCH_TERM_CONDITION_TWOTIMESOPTPATH</a>);
<a name="l01482"></a>01482         bNeedtoRecomputeGoalHeuristics = <span class="keyword">false</span>;
<a name="l01483"></a>01483         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;2dsolcost_infullunits=%d\n&quot;</span>,
<a name="l01484"></a>01484                     (<span class="keywordtype">int</span>)(grid2Dsearchfromgoal-&gt;getlowerboundoncostfromstart_inmm(EnvNAVXYTHETALATCfg.StartX_c,
<a name="l01485"></a>01485                                                                                   EnvNAVXYTHETALATCfg.StartY_c) /
<a name="l01486"></a>01486                           EnvNAVXYTHETALATCfg.nominalvel_mpersecs));
<a name="l01487"></a>01487     }
<a name="l01488"></a>01488 }
<a name="l01489"></a>01489 
<a name="l01490"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a7908b3287bdc65531e59bcd4246cbb97">01490</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a7908b3287bdc65531e59bcd4246cbb97">EnvironmentNAVXYTHETALATTICE::ComputeHeuristicValues</a>()
<a name="l01491"></a>01491 {
<a name="l01492"></a>01492     <span class="comment">//whatever necessary pre-computation of heuristic values is done here</span>
<a name="l01493"></a>01493     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;Precomputing heuristics...\n&quot;</span>);
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     <span class="comment">//allocated 2D grid searches</span>
<a name="l01496"></a>01496     grid2Dsearchfromstart = <span class="keyword">new</span> <a class="code" href="class_s_b_p_l2_d_grid_search.html" title="2D search itself">SBPL2DGridSearch</a>(EnvNAVXYTHETALATCfg.EnvWidth_c, EnvNAVXYTHETALATCfg.EnvHeight_c,
<a name="l01497"></a>01497                                                  (<span class="keywordtype">float</span>)EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01498"></a>01498     grid2Dsearchfromgoal = <span class="keyword">new</span> <a class="code" href="class_s_b_p_l2_d_grid_search.html" title="2D search itself">SBPL2DGridSearch</a>(EnvNAVXYTHETALATCfg.EnvWidth_c, EnvNAVXYTHETALATCfg.EnvHeight_c,
<a name="l01499"></a>01499                                                 (<span class="keywordtype">float</span>)EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01500"></a>01500 
<a name="l01501"></a>01501     <span class="comment">//set OPEN type to sliding buckets</span>
<a name="l01502"></a>01502     grid2Dsearchfromstart-&gt;setOPENdatastructure(<a class="code" href="2_dgridsearch_8h.html#a0580f285fb96a3d7ea2f60c3d57bddb5ac92d13518f588a31b9a690e4ce4d9800">SBPL_2DGRIDSEARCH_OPENTYPE_SLIDINGBUCKETS</a>);
<a name="l01503"></a>01503     grid2Dsearchfromgoal-&gt;setOPENdatastructure(<a class="code" href="2_dgridsearch_8h.html#a0580f285fb96a3d7ea2f60c3d57bddb5ac92d13518f588a31b9a690e4ce4d9800">SBPL_2DGRIDSEARCH_OPENTYPE_SLIDINGBUCKETS</a>);
<a name="l01504"></a>01504 
<a name="l01505"></a>01505     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;done\n&quot;</span>);
<a name="l01506"></a>01506 }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508 <span class="comment">//------------debugging functions---------------------------------------------</span>
<a name="l01509"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a91cf128feb1844ed0075bd0da878caf4">01509</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a91cf128feb1844ed0075bd0da878caf4">EnvironmentNAVXYTHETALATTICE::CheckQuant</a>(FILE* fOut)
<a name="l01510"></a>01510 {
<a name="l01511"></a>01511     <span class="keywordflow">for</span> (<span class="keywordtype">double</span> theta = -10; theta &lt; 10; theta += 2.0 * <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a> / EnvNAVXYTHETALATCfg.NumThetaDirs * 0.01) {
<a name="l01512"></a>01512         <span class="keywordtype">int</span> nTheta = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(theta, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01513"></a>01513         <span class="keywordtype">double</span> newTheta = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(nTheta, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01514"></a>01514         <span class="keywordtype">int</span> nnewTheta = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(newTheta, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01515"></a>01515 
<a name="l01516"></a>01516         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;theta=%f(%f)-&gt;%d-&gt;%f-&gt;%d\n&quot;</span>, theta, theta * 180 / <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a>, nTheta, newTheta, nnewTheta);
<a name="l01517"></a>01517 
<a name="l01518"></a>01518         <span class="keywordflow">if</span> (nTheta != nnewTheta) {
<a name="l01519"></a>01519             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid quantization\n&quot;</span>);
<a name="l01520"></a>01520             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01521"></a>01521         }
<a name="l01522"></a>01522     }
<a name="l01523"></a>01523 
<a name="l01524"></a>01524     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01525"></a>01525 }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l01528"></a>01528 
<a name="l01529"></a>01529 <span class="comment">//-----------interface with outside functions-----------------------------------</span>
<a name="l01530"></a>01530 
<a name="l01531"></a>01531 <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a6b3fd093390d711e1f5b58be4758f213" title="initialization of environment from file. See .cfg files for examples it also takes the perimeter of t...">EnvironmentNAVXYTHETALATTICE::InitializeEnv</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* sEnvFile, <span class="keyword">const</span> vector&lt;sbpl_2Dpt_t&gt;&amp; perimeterptsV,
<a name="l01532"></a>01532                                                  <span class="keyword">const</span> <span class="keywordtype">char</span>* sMotPrimFile)
<a name="l01533"></a>01533 {
<a name="l01534"></a>01534     EnvNAVXYTHETALATCfg.FootprintPolygon = perimeterptsV;
<a name="l01535"></a>01535 
<a name="l01536"></a>01536     FILE* fCfg = fopen(sEnvFile, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01537"></a>01537     <span class="keywordflow">if</span> (fCfg == NULL) {
<a name="l01538"></a>01538         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: unable to open %s\n&quot;</span>, sEnvFile);
<a name="l01539"></a>01539         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01540"></a>01540     }
<a name="l01541"></a>01541     ReadConfiguration(fCfg);
<a name="l01542"></a>01542     fclose(fCfg);
<a name="l01543"></a>01543 
<a name="l01544"></a>01544     <span class="keywordflow">if</span> (sMotPrimFile != NULL) {
<a name="l01545"></a>01545         FILE* fMotPrim = fopen(sMotPrimFile, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01546"></a>01546         <span class="keywordflow">if</span> (fMotPrim == NULL) {
<a name="l01547"></a>01547             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: unable to open %s\n&quot;</span>, sMotPrimFile);
<a name="l01548"></a>01548             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01549"></a>01549         }
<a name="l01550"></a>01550         <span class="keywordflow">if</span> (ReadMotionPrimitives(fMotPrim) == <span class="keyword">false</span>) {
<a name="l01551"></a>01551             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: failed to read in motion primitive file\n&quot;</span>);
<a name="l01552"></a>01552             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01553"></a>01553         }
<a name="l01554"></a>01554         InitGeneral(&amp;EnvNAVXYTHETALATCfg.mprimV);
<a name="l01555"></a>01555         fclose(fMotPrim);
<a name="l01556"></a>01556     }
<a name="l01557"></a>01557     <span class="keywordflow">else</span>
<a name="l01558"></a>01558         InitGeneral( NULL);
<a name="l01559"></a>01559 
<a name="l01560"></a>01560     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;size of env: %d by %d\n&quot;</span>, EnvNAVXYTHETALATCfg.EnvWidth_c, EnvNAVXYTHETALATCfg.EnvHeight_c);
<a name="l01561"></a>01561 
<a name="l01562"></a>01562     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01563"></a>01563 }
<a name="l01564"></a>01564 
<a name="l01565"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ac1059d2c43b0619f673a5bc7b0235651">01565</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a6b3fd093390d711e1f5b58be4758f213" title="initialization of environment from file. See .cfg files for examples it also takes the perimeter of t...">EnvironmentNAVXYTHETALATTICE::InitializeEnv</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* sEnvFile)
<a name="l01566"></a>01566 {
<a name="l01567"></a>01567     FILE* fCfg = fopen(sEnvFile, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01568"></a>01568     <span class="keywordflow">if</span> (fCfg == NULL) {
<a name="l01569"></a>01569         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: unable to open %s\n&quot;</span>, sEnvFile);
<a name="l01570"></a>01570         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01571"></a>01571     }
<a name="l01572"></a>01572     ReadConfiguration(fCfg);
<a name="l01573"></a>01573     fclose(fCfg);
<a name="l01574"></a>01574 
<a name="l01575"></a>01575     InitGeneral( NULL);
<a name="l01576"></a>01576 
<a name="l01577"></a>01577     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01578"></a>01578 }
<a name="l01579"></a>01579 
<a name="l01580"></a>01580 <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a6b3fd093390d711e1f5b58be4758f213" title="initialization of environment from file. See .cfg files for examples it also takes the perimeter of t...">EnvironmentNAVXYTHETALATTICE::InitializeEnv</a>(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, <span class="keyword">const</span> vector&lt;sbpl_2Dpt_t&gt; &amp; perimeterptsV,
<a name="l01581"></a>01581                                                  <span class="keywordtype">double</span> cellsize_m, <span class="keywordtype">double</span> nominalvel_mpersecs,
<a name="l01582"></a>01582                                                  <span class="keywordtype">double</span> timetoturn45degsinplace_secs, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> obsthresh,
<a name="l01583"></a>01583                                                  <span class="keyword">const</span> <span class="keywordtype">char</span>* sMotPrimFile, <a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html">EnvNAVXYTHETALAT_InitParms</a> params)
<a name="l01584"></a>01584 {
<a name="l01585"></a>01585     EnvNAVXYTHETALATCfg.NumThetaDirs = params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a27f31867aeb7482ccceaf5b1c6277cb1">numThetas</a>;
<a name="l01586"></a>01586 
<a name="l01587"></a>01587     <span class="keywordflow">return</span> InitializeEnv(width, height, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#acf547fbf57d0126a9206cc080d7593d0">mapdata</a>, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a1ea66bce7ec3b8029cc2fca19e3af9be">startx</a>, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a3fdf93fbd108b6dd296a1b62c39474c9">starty</a>, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a8b21572d52cb7e0de669758815d75e1e">starttheta</a>, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#aa0d721f5082fb1f96057bc4df1d4970c">goalx</a>,
<a name="l01588"></a>01588                          params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a93cc6f9242d5468d0153c7d4d10a1bc7">goaly</a>, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a7ea9654ef0e7879b5d320329475866b1">goaltheta</a>, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a44ae2ff54900e46aeeed513d7f3e6c1a">goaltol_x</a>, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a5458b4a81004be3f0ac3cf338fc85052">goaltol_y</a>, params.<a class="code" href="class_env_n_a_v_x_y_t_h_e_t_a_l_a_t___init_parms.html#a888a67e7f474fc4030fbe844cd5e2417">goaltol_theta</a>,
<a name="l01589"></a>01589                          perimeterptsV, cellsize_m, nominalvel_mpersecs, timetoturn45degsinplace_secs, obsthresh,
<a name="l01590"></a>01590                          sMotPrimFile);
<a name="l01591"></a>01591 }
<a name="l01592"></a>01592 
<a name="l01593"></a>01593 <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a6b3fd093390d711e1f5b58be4758f213" title="initialization of environment from file. See .cfg files for examples it also takes the perimeter of t...">EnvironmentNAVXYTHETALATTICE::InitializeEnv</a>(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* mapdata, <span class="keywordtype">double</span> startx,
<a name="l01594"></a>01594                                                  <span class="keywordtype">double</span> starty, <span class="keywordtype">double</span> starttheta, <span class="keywordtype">double</span> goalx, <span class="keywordtype">double</span> goaly,
<a name="l01595"></a>01595                                                  <span class="keywordtype">double</span> goaltheta, <span class="keywordtype">double</span> goaltol_x, <span class="keywordtype">double</span> goaltol_y,
<a name="l01596"></a>01596                                                  <span class="keywordtype">double</span> goaltol_theta, <span class="keyword">const</span> vector&lt;sbpl_2Dpt_t&gt; &amp; perimeterptsV,
<a name="l01597"></a>01597                                                  <span class="keywordtype">double</span> cellsize_m, <span class="keywordtype">double</span> nominalvel_mpersecs,
<a name="l01598"></a>01598                                                  <span class="keywordtype">double</span> timetoturn45degsinplace_secs, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> obsthresh,
<a name="l01599"></a>01599                                                  <span class="keyword">const</span> <span class="keywordtype">char</span>* sMotPrimFile)
<a name="l01600"></a>01600 {
<a name="l01601"></a>01601     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;env: initialize with width=%d height=%d start=%.3f %.3f %.3f &quot;</span>
<a name="l01602"></a>01602                 <span class="stringliteral">&quot;goalx=%.3f %.3f %.3f cellsize=%.3f nomvel=%.3f timetoturn=%.3f, obsthresh=%d\n&quot;</span>,
<a name="l01603"></a>01603                 width, height, startx, starty, starttheta, goalx, goaly, goaltheta, cellsize_m, nominalvel_mpersecs,
<a name="l01604"></a>01604                 timetoturn45degsinplace_secs, obsthresh);
<a name="l01605"></a>01605 
<a name="l01606"></a>01606     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;NOTE: goaltol parameters currently unused\n&quot;</span>);
<a name="l01607"></a>01607 
<a name="l01608"></a>01608     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;perimeter has size=%d\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)perimeterptsV.size());
<a name="l01609"></a>01609 
<a name="l01610"></a>01610     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)perimeterptsV.size(); i++) {
<a name="l01611"></a>01611         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;perimeter(%d) = %.4f %.4f\n&quot;</span>, i, perimeterptsV.at(i).x, perimeterptsV.at(i).y);
<a name="l01612"></a>01612     }
<a name="l01613"></a>01613 
<a name="l01614"></a>01614     EnvNAVXYTHETALATCfg.obsthresh = obsthresh;
<a name="l01615"></a>01615 
<a name="l01616"></a>01616     <span class="comment">//TODO - need to set the tolerance as well</span>
<a name="l01617"></a>01617 
<a name="l01618"></a>01618     SetConfiguration(width, height, mapdata, <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(startx, cellsize_m), <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(starty, cellsize_m),
<a name="l01619"></a>01619                      <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(starttheta, EnvNAVXYTHETALATCfg.NumThetaDirs), <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(goalx, cellsize_m),
<a name="l01620"></a>01620                      <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(goaly, cellsize_m), <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(goaltheta, EnvNAVXYTHETALATCfg.NumThetaDirs),
<a name="l01621"></a>01621                      cellsize_m, nominalvel_mpersecs, timetoturn45degsinplace_secs, perimeterptsV);
<a name="l01622"></a>01622 
<a name="l01623"></a>01623     <span class="keywordflow">if</span> (sMotPrimFile != NULL) {
<a name="l01624"></a>01624         FILE* fMotPrim = fopen(sMotPrimFile, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01625"></a>01625         <span class="keywordflow">if</span> (fMotPrim == NULL) {
<a name="l01626"></a>01626             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: unable to open %s\n&quot;</span>, sMotPrimFile);
<a name="l01627"></a>01627             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01628"></a>01628         }
<a name="l01629"></a>01629 
<a name="l01630"></a>01630         <span class="keywordflow">if</span> (ReadMotionPrimitives(fMotPrim) == <span class="keyword">false</span>) {
<a name="l01631"></a>01631             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: failed to read in motion primitive file\n&quot;</span>);
<a name="l01632"></a>01632             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01633"></a>01633         }
<a name="l01634"></a>01634         fclose(fMotPrim);
<a name="l01635"></a>01635     }
<a name="l01636"></a>01636 
<a name="l01637"></a>01637     <span class="keywordflow">if</span> (EnvNAVXYTHETALATCfg.mprimV.size() != 0) {
<a name="l01638"></a>01638         InitGeneral(&amp;EnvNAVXYTHETALATCfg.mprimV);
<a name="l01639"></a>01639     }
<a name="l01640"></a>01640     <span class="keywordflow">else</span>
<a name="l01641"></a>01641         InitGeneral( NULL);
<a name="l01642"></a>01642 
<a name="l01643"></a>01643     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01644"></a>01644 }
<a name="l01645"></a>01645 
<a name="l01646"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a70651b0ec13ea45e5f3ddc2b996b9fa2">01646</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a70651b0ec13ea45e5f3ddc2b996b9fa2">EnvironmentNAVXYTHETALATTICE::InitGeneral</a>(vector&lt;SBPL_xytheta_mprimitive&gt;* motionprimitiveV)
<a name="l01647"></a>01647 {
<a name="l01648"></a>01648     <span class="comment">//Initialize other parameters of the environment</span>
<a name="l01649"></a>01649     InitializeEnvConfig(motionprimitiveV);
<a name="l01650"></a>01650 
<a name="l01651"></a>01651     <span class="comment">//initialize Environment</span>
<a name="l01652"></a>01652     InitializeEnvironment();
<a name="l01653"></a>01653 
<a name="l01654"></a>01654     <span class="comment">//pre-compute heuristics</span>
<a name="l01655"></a>01655     ComputeHeuristicValues();
<a name="l01656"></a>01656 
<a name="l01657"></a>01657     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01658"></a>01658 }
<a name="l01659"></a>01659 
<a name="l01660"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a43b921d80c956aaa50048ee115358751">01660</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a43b921d80c956aaa50048ee115358751" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALATTICE::InitializeMDPCfg</a>(<a class="code" href="struct_m_d_p_config.html">MDPConfig</a> *MDPCfg)
<a name="l01661"></a>01661 {
<a name="l01662"></a>01662     <span class="comment">//initialize MDPCfg with the start and goal ids</span>
<a name="l01663"></a>01663     MDPCfg-&gt;<a class="code" href="struct_m_d_p_config.html#a3817bc7f37248690b80575398593b5cb">goalstateid</a> = EnvNAVXYTHETALAT.goalstateid;
<a name="l01664"></a>01664     MDPCfg-&gt;<a class="code" href="struct_m_d_p_config.html#a955f603f3ac77d95a563b51eb1a49a38">startstateid</a> = EnvNAVXYTHETALAT.startstateid;
<a name="l01665"></a>01665 
<a name="l01666"></a>01666     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01667"></a>01667 }
<a name="l01668"></a>01668 
<a name="l01669"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a9d4bdd68841b24068f0cd6213b19cc92">01669</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a9d4bdd68841b24068f0cd6213b19cc92">EnvironmentNAVXYTHETALATTICE::PrintHeuristicValues</a>()
<a name="l01670"></a>01670 {
<a name="l01671"></a>01671 <span class="preprocessor">#ifndef ROS</span>
<a name="l01672"></a>01672 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* heur = <span class="stringliteral">&quot;heur.txt&quot;</span>;
<a name="l01673"></a>01673 <span class="preprocessor">#endif</span>
<a name="l01674"></a>01674 <span class="preprocessor"></span>    FILE* fHeur = <a class="code" href="config_8h.html#abf7ed5a123e4b1715dd437bcb70e4ef9">SBPL_FOPEN</a>(heur, <span class="stringliteral">&quot;w&quot;</span>);
<a name="l01675"></a>01675     <span class="keywordflow">if</span> (fHeur == NULL) {
<a name="l01676"></a>01676         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: could not open debug file to write heuristic\n&quot;</span>);
<a name="l01677"></a>01677         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01678"></a>01678     }
<a name="l01679"></a>01679     <a class="code" href="class_s_b_p_l2_d_grid_search.html" title="2D search itself">SBPL2DGridSearch</a>* grid2Dsearch = NULL;
<a name="l01680"></a>01680 
<a name="l01681"></a>01681     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++) {
<a name="l01682"></a>01682         <span class="keywordflow">if</span> (i == 0 &amp;&amp; grid2Dsearchfromstart != NULL) {
<a name="l01683"></a>01683             grid2Dsearch = grid2Dsearchfromstart;
<a name="l01684"></a>01684             <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fHeur, <span class="stringliteral">&quot;start heuristics:\n&quot;</span>);
<a name="l01685"></a>01685         }
<a name="l01686"></a>01686         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1 &amp;&amp; grid2Dsearchfromgoal != NULL) {
<a name="l01687"></a>01687             grid2Dsearch = grid2Dsearchfromgoal;
<a name="l01688"></a>01688             <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fHeur, <span class="stringliteral">&quot;goal heuristics:\n&quot;</span>);
<a name="l01689"></a>01689         }
<a name="l01690"></a>01690         <span class="keywordflow">else</span>
<a name="l01691"></a>01691             <span class="keywordflow">continue</span>;
<a name="l01692"></a>01692 
<a name="l01693"></a>01693         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; EnvNAVXYTHETALATCfg.EnvHeight_c; y++) {
<a name="l01694"></a>01694             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; EnvNAVXYTHETALATCfg.EnvWidth_c; x++) {
<a name="l01695"></a>01695                 <span class="keywordflow">if</span> (grid2Dsearch-&gt;<a class="code" href="class_s_b_p_l2_d_grid_search.html#a73391a1de72e3da8d48a3ec94c0e8127" title="returns the computed distance from the start to &lt;x,y&gt;. If not computed, then returns lower bound on i...">getlowerboundoncostfromstart_inmm</a>(x, y) &lt; <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>)
<a name="l01696"></a>01696                     <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fHeur, <span class="stringliteral">&quot;%5d &quot;</span>, grid2Dsearch-&gt;<a class="code" href="class_s_b_p_l2_d_grid_search.html#a73391a1de72e3da8d48a3ec94c0e8127" title="returns the computed distance from the start to &lt;x,y&gt;. If not computed, then returns lower bound on i...">getlowerboundoncostfromstart_inmm</a>(x, y));
<a name="l01697"></a>01697                 <span class="keywordflow">else</span>
<a name="l01698"></a>01698                     <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fHeur, <span class="stringliteral">&quot;XXXXX &quot;</span>);
<a name="l01699"></a>01699             }
<a name="l01700"></a>01700             <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fHeur, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01701"></a>01701         }
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703     <a class="code" href="config_8h.html#a28856faf6cdc3815a09e57d383cde6f0">SBPL_FCLOSE</a>(fHeur);
<a name="l01704"></a>01704 }
<a name="l01705"></a>01705 
<a name="l01706"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a8af48c78e4bcd08ce6a6cfc7ae708693">01706</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a8af48c78e4bcd08ce6a6cfc7ae708693" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALATTICE::SetAllPreds</a>(<a class="code" href="class_c_m_d_p_s_t_a_t_e.html">CMDPSTATE</a>* state)
<a name="l01707"></a>01707 {
<a name="l01708"></a>01708     <span class="comment">//implement this if the planner needs access to predecessors</span>
<a name="l01709"></a>01709 
<a name="l01710"></a>01710     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvNAVXYTHETALAT... function: SetAllPreds is undefined\n&quot;</span>);
<a name="l01711"></a>01711     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01712"></a>01712 }
<a name="l01713"></a>01713 
<a name="l01714"></a>01714 <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a45f005c7b5fdbe341b6a2bf4301e0d3c" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALATTICE::GetSuccs</a>(<span class="keywordtype">int</span> SourceStateID, vector&lt;int&gt;* SuccIDV, vector&lt;int&gt;* CostV)
<a name="l01715"></a>01715 {
<a name="l01716"></a>01716     GetSuccs(SourceStateID, SuccIDV, CostV, NULL);
<a name="l01717"></a>01717 }
<a name="l01718"></a>01718 
<a name="l01719"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#aa036098fec00bc38e1691d913eaa4730">01719</a> <span class="keyword">const</span> <a class="code" href="struct_e_n_v___n_a_v_x_y_t_h_e_t_a_l_a_t___c_o_n_f_i_g.html">EnvNAVXYTHETALATConfig_t</a>* <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#aa036098fec00bc38e1691d913eaa4730" title="get internal configuration data structure">EnvironmentNAVXYTHETALATTICE::GetEnvNavConfig</a>()
<a name="l01720"></a>01720 {
<a name="l01721"></a>01721     <span class="keywordflow">return</span> &amp;EnvNAVXYTHETALATCfg;
<a name="l01722"></a>01722 }
<a name="l01723"></a>01723 
<a name="l01724"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#adf55503cfbb743895e43660e1ea82052">01724</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#adf55503cfbb743895e43660e1ea82052" title="update the traversability of a cell&lt;x,y&gt;">EnvironmentNAVXYTHETALATTICE::UpdateCost</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> newcost)
<a name="l01725"></a>01725 {
<a name="l01726"></a>01726 <span class="preprocessor">#if DEBUG</span>
<a name="l01727"></a>01727 <span class="preprocessor"></span>    <span class="comment">//SBPL_FPRINTF(fDeb, &quot;Cost updated for cell %d %d from old cost=%d to new cost=%d\n&quot;, x,y,EnvNAVXYTHETALATCfg.Grid2D[x][y], newcost);</span>
<a name="l01728"></a>01728 <span class="preprocessor">#endif</span>
<a name="l01729"></a>01729 <span class="preprocessor"></span>
<a name="l01730"></a>01730     EnvNAVXYTHETALATCfg.Grid2D[x][y] = newcost;
<a name="l01731"></a>01731 
<a name="l01732"></a>01732     bNeedtoRecomputeStartHeuristics = <span class="keyword">true</span>;
<a name="l01733"></a>01733     bNeedtoRecomputeGoalHeuristics = <span class="keyword">true</span>;
<a name="l01734"></a>01734 
<a name="l01735"></a>01735     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01736"></a>01736 }
<a name="l01737"></a>01737 
<a name="l01738"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ac4f54a2e0354f033119533a06d59e7b8">01738</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ac4f54a2e0354f033119533a06d59e7b8" title="re-setting the whole 2D map transform from linear array mapdata to the 2D matrix used internally: Gri...">EnvironmentNAVXYTHETALATTICE::SetMap</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* mapdata)
<a name="l01739"></a>01739 {
<a name="l01740"></a>01740     <span class="keywordtype">int</span> xind = -1, yind = -1;
<a name="l01741"></a>01741 
<a name="l01742"></a>01742     <span class="keywordflow">for</span> (xind = 0; xind &lt; EnvNAVXYTHETALATCfg.EnvWidth_c; xind++) {
<a name="l01743"></a>01743         <span class="keywordflow">for</span> (yind = 0; yind &lt; EnvNAVXYTHETALATCfg.EnvHeight_c; yind++) {
<a name="l01744"></a>01744             EnvNAVXYTHETALATCfg.Grid2D[xind][yind] = mapdata[xind + yind * EnvNAVXYTHETALATCfg.EnvWidth_c];
<a name="l01745"></a>01745         }
<a name="l01746"></a>01746     }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748     bNeedtoRecomputeStartHeuristics = <span class="keyword">true</span>;
<a name="l01749"></a>01749     bNeedtoRecomputeGoalHeuristics = <span class="keyword">true</span>;
<a name="l01750"></a>01750 
<a name="l01751"></a>01751     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01752"></a>01752 }
<a name="l01753"></a>01753 
<a name="l01754"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a800bb52962d6d31a2c81de4e095848ec">01754</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a800bb52962d6d31a2c81de4e095848ec" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALATTICE::PrintEnv_Config</a>(FILE* fOut)
<a name="l01755"></a>01755 {
<a name="l01756"></a>01756     <span class="comment">//implement this if the planner needs to print out EnvNAVXYTHETALAT. configuration</span>
<a name="l01757"></a>01757 
<a name="l01758"></a>01758     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvNAVXYTHETALAT... function: PrintEnv_Config is undefined\n&quot;</span>);
<a name="l01759"></a>01759     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01760"></a>01760 }
<a name="l01761"></a>01761 
<a name="l01762"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ab421301637980a063370286addf2f4d8">01762</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#ab421301637980a063370286addf2f4d8" title="prints time statistics">EnvironmentNAVXYTHETALATTICE::PrintTimeStat</a>(FILE* fOut)
<a name="l01763"></a>01763 {
<a name="l01764"></a>01764 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l01765"></a>01765 <span class="preprocessor"></span>    <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;time3_addallout = %f secs, time_gethash = %f secs, time_createhash = %f secs, &quot;</span>
<a name="l01766"></a>01766                  <span class="stringliteral">&quot;time_getsuccs = %f\n&quot;</span>,
<a name="l01767"></a>01767                  time3_addallout/(<span class="keywordtype">double</span>)CLOCKS_PER_SEC, time_gethash/(<span class="keywordtype">double</span>)CLOCKS_PER_SEC,
<a name="l01768"></a>01768                  time_createhash/(<span class="keywordtype">double</span>)CLOCKS_PER_SEC, time_getsuccs/(<span class="keywordtype">double</span>)CLOCKS_PER_SEC);
<a name="l01769"></a>01769 <span class="preprocessor">#endif</span>
<a name="l01770"></a>01770 <span class="preprocessor"></span>}
<a name="l01771"></a>01771 
<a name="l01772"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#aba1069141f5e0d5b1d330a0f4b754093">01772</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#aba1069141f5e0d5b1d330a0f4b754093">EnvironmentNAVXYTHETALATTICE::IsObstacle</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l01773"></a>01773 {
<a name="l01774"></a>01774 <span class="preprocessor">#if DEBUG</span>
<a name="l01775"></a>01775 <span class="preprocessor"></span>    <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;Status of cell %d %d is queried. Its cost=%d\n&quot;</span>, x,y,EnvNAVXYTHETALATCfg.Grid2D[x][y]);
<a name="l01776"></a>01776 <span class="preprocessor">#endif</span>
<a name="l01777"></a>01777 <span class="preprocessor"></span>
<a name="l01778"></a>01778     <span class="keywordflow">return</span> (EnvNAVXYTHETALATCfg.Grid2D[x][y] &gt;= EnvNAVXYTHETALATCfg.obsthresh);
<a name="l01779"></a>01779 }
<a name="l01780"></a>01780 
<a name="l01781"></a>01781 <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a0454968ca6c333bafaebbddf0ae05fbf" title="returns environment parameters. Useful for creating a copy environment">EnvironmentNAVXYTHETALATTICE::GetEnvParms</a>(<span class="keywordtype">int</span> *size_x, <span class="keywordtype">int</span> *size_y, <span class="keywordtype">int</span>* num_thetas, <span class="keywordtype">double</span>* startx,
<a name="l01782"></a>01782                                                <span class="keywordtype">double</span>* starty, <span class="keywordtype">double</span>*starttheta, <span class="keywordtype">double</span>* goalx, <span class="keywordtype">double</span>* goaly,
<a name="l01783"></a>01783                                                <span class="keywordtype">double</span>* goaltheta, <span class="keywordtype">double</span>* cellsize_m, <span class="keywordtype">double</span>* nominalvel_mpersecs,
<a name="l01784"></a>01784                                                <span class="keywordtype">double</span>* timetoturn45degsinplace_secs, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* obsthresh, vector&lt;
<a name="l01785"></a>01785                                                    <a class="code" href="struct_s_b_p_l__xytheta__mprimitive.html">SBPL_xytheta_mprimitive</a>&gt;* mprimitiveV)
<a name="l01786"></a>01786 {
<a name="l01787"></a>01787     *num_thetas = EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l01788"></a>01788     GetEnvParms(size_x, size_y, startx, starty, starttheta, goalx, goaly, goaltheta, cellsize_m, nominalvel_mpersecs,
<a name="l01789"></a>01789                 timetoturn45degsinplace_secs, obsthresh, mprimitiveV);
<a name="l01790"></a>01790 }
<a name="l01791"></a>01791 
<a name="l01792"></a>01792 <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a0454968ca6c333bafaebbddf0ae05fbf" title="returns environment parameters. Useful for creating a copy environment">EnvironmentNAVXYTHETALATTICE::GetEnvParms</a>(<span class="keywordtype">int</span> *size_x, <span class="keywordtype">int</span> *size_y, <span class="keywordtype">double</span>* startx, <span class="keywordtype">double</span>* starty,
<a name="l01793"></a>01793                                                <span class="keywordtype">double</span>*starttheta, <span class="keywordtype">double</span>* goalx, <span class="keywordtype">double</span>* goaly, <span class="keywordtype">double</span>* goaltheta,
<a name="l01794"></a>01794                                                <span class="keywordtype">double</span>* cellsize_m, <span class="keywordtype">double</span>* nominalvel_mpersecs,
<a name="l01795"></a>01795                                                <span class="keywordtype">double</span>* timetoturn45degsinplace_secs, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* obsthresh,
<a name="l01796"></a>01796                                                vector&lt;SBPL_xytheta_mprimitive&gt;* mprimitiveV)
<a name="l01797"></a>01797 {
<a name="l01798"></a>01798     *size_x = EnvNAVXYTHETALATCfg.EnvWidth_c;
<a name="l01799"></a>01799     *size_y = EnvNAVXYTHETALATCfg.EnvHeight_c;
<a name="l01800"></a>01800 
<a name="l01801"></a>01801     *startx = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.StartX_c, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01802"></a>01802     *starty = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.StartY_c, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01803"></a>01803     *starttheta = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.StartTheta, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01804"></a>01804     *goalx = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.EndX_c, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01805"></a>01805     *goaly = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(EnvNAVXYTHETALATCfg.EndY_c, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01806"></a>01806     *goaltheta = <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(EnvNAVXYTHETALATCfg.EndTheta, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l01807"></a>01807 
<a name="l01808"></a>01808     *cellsize_m = EnvNAVXYTHETALATCfg.cellsize_m;
<a name="l01809"></a>01809     *nominalvel_mpersecs = EnvNAVXYTHETALATCfg.nominalvel_mpersecs;
<a name="l01810"></a>01810     *timetoturn45degsinplace_secs = EnvNAVXYTHETALATCfg.timetoturn45degsinplace_secs;
<a name="l01811"></a>01811 
<a name="l01812"></a>01812     *obsthresh = EnvNAVXYTHETALATCfg.obsthresh;
<a name="l01813"></a>01813 
<a name="l01814"></a>01814     *mprimitiveV = EnvNAVXYTHETALATCfg.mprimV;
<a name="l01815"></a>01815 }
<a name="l01816"></a>01816 
<a name="l01817"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#afee97b8f6038469e6719ba1d65d01d5f">01817</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#afee97b8f6038469e6719ba1d65d01d5f" title="Transform a pose into discretized form. The angle &#39;pth&#39; is considered to be valid if it lies between ...">EnvironmentNAVXYTHETALATTICE::PoseContToDisc</a>(<span class="keywordtype">double</span> px, <span class="keywordtype">double</span> py, <span class="keywordtype">double</span> pth, <span class="keywordtype">int</span> &amp;ix, <span class="keywordtype">int</span> &amp;iy, <span class="keywordtype">int</span> &amp;ith)<span class="keyword"> const</span>
<a name="l01818"></a>01818 <span class="keyword"></span>{
<a name="l01819"></a>01819     ix = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(px, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01820"></a>01820     iy = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(py, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01821"></a>01821     ith = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(pth, EnvNAVXYTHETALATCfg.NumThetaDirs); <span class="comment">// ContTheta2Disc() normalizes the angle</span>
<a name="l01822"></a>01822     <span class="keywordflow">return</span> (pth &gt;= -2 * <a class="code" href="utils_8h.html#a887c395ed5b0dab69c83e71d34e3de27">PI_CONST</a>) &amp;&amp; (pth &lt;= 2 * PI_CONST) &amp;&amp; (ix &gt;= 0) &amp;&amp; (ix &lt; EnvNAVXYTHETALATCfg.EnvWidth_c) &amp;&amp;
<a name="l01823"></a>01823            (iy &gt;= 0) &amp;&amp; (iy &lt; EnvNAVXYTHETALATCfg.EnvHeight_c);
<a name="l01824"></a>01824 }
<a name="l01825"></a>01825 
<a name="l01826"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a6d4c66c7c30c7480192df91f99f8317f">01826</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a6d4c66c7c30c7480192df91f99f8317f" title="Transform grid indices into a continuous pose. The computed angle lies within 0&lt;=pth&lt;2pi.">EnvironmentNAVXYTHETALATTICE::PoseDiscToCont</a>(<span class="keywordtype">int</span> ix, <span class="keywordtype">int</span> iy, <span class="keywordtype">int</span> ith, <span class="keywordtype">double</span> &amp;px, <span class="keywordtype">double</span> &amp;py, <span class="keywordtype">double</span> &amp;pth)<span class="keyword"> const</span>
<a name="l01827"></a>01827 <span class="keyword"></span>{
<a name="l01828"></a>01828     px = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(ix, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01829"></a>01829     py = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(iy, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l01830"></a>01830     pth = <a class="code" href="utils_8h.html#a8b909c7be741a1e355bd0b822df0645e">normalizeAngle</a>(<a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(ith, EnvNAVXYTHETALATCfg.NumThetaDirs));
<a name="l01831"></a>01831     <span class="keywordflow">return</span> (ith &gt;= 0) &amp;&amp; (ith &lt; EnvNAVXYTHETALATCfg.NumThetaDirs) &amp;&amp; (ix &gt;= 0) &amp;&amp;
<a name="l01832"></a>01832            (ix &lt; EnvNAVXYTHETALATCfg.EnvWidth_c) &amp;&amp; (iy &gt;= 0) &amp;&amp; (iy &lt; EnvNAVXYTHETALATCfg.EnvHeight_c);
<a name="l01833"></a>01833 }
<a name="l01834"></a>01834 
<a name="l01835"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a9960f981a14721a2cad70e26f7067514">01835</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a9960f981a14721a2cad70e26f7067514" title="returns the cost corresponding to the cell &lt;x,y&gt;">EnvironmentNAVXYTHETALATTICE::GetMapCost</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l01836"></a>01836 {
<a name="l01837"></a>01837     <span class="keywordflow">return</span> EnvNAVXYTHETALATCfg.Grid2D[x][y];
<a name="l01838"></a>01838 }
<a name="l01839"></a>01839 
<a name="l01840"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a40a22860271308e9b5a322e8282ee979">01840</a> <span class="keywordtype">bool</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a40a22860271308e9b5a322e8282ee979" title="way to set up various parameters. For a list of parameters, see the body of the function - it is pret...">EnvironmentNAVXYTHETALATTICE::SetEnvParameter</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* parameter, <span class="keywordtype">int</span> value)
<a name="l01841"></a>01841 {
<a name="l01842"></a>01842     <span class="keywordflow">if</span> (EnvNAVXYTHETALAT.bInitialized == <span class="keyword">true</span>) {
<a name="l01843"></a>01843         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: all parameters must be set before initialization of the environment\n&quot;</span>);
<a name="l01844"></a>01844         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01845"></a>01845     }
<a name="l01846"></a>01846 
<a name="l01847"></a>01847     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;setting parameter %s to %d\n&quot;</span>, parameter, value);
<a name="l01848"></a>01848 
<a name="l01849"></a>01849     <span class="keywordflow">if</span> (strcmp(parameter, <span class="stringliteral">&quot;cost_inscribed_thresh&quot;</span>) == 0) {
<a name="l01850"></a>01850         <span class="keywordflow">if</span> (value &lt; 0 || value &gt; 255) {
<a name="l01851"></a>01851             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid value %d for parameter %s\n&quot;</span>, value, parameter);
<a name="l01852"></a>01852             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01853"></a>01853         }
<a name="l01854"></a>01854         EnvNAVXYTHETALATCfg.cost_inscribed_thresh = (<span class="keywordtype">unsigned</span> char)value;
<a name="l01855"></a>01855     }
<a name="l01856"></a>01856     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(parameter, <span class="stringliteral">&quot;cost_possibly_circumscribed_thresh&quot;</span>) == 0) {
<a name="l01857"></a>01857         <span class="keywordflow">if</span> (value &lt; 0 || value &gt; 255) {
<a name="l01858"></a>01858             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid value %d for parameter %s\n&quot;</span>, value, parameter);
<a name="l01859"></a>01859             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01860"></a>01860         }
<a name="l01861"></a>01861         EnvNAVXYTHETALATCfg.cost_possibly_circumscribed_thresh = value;
<a name="l01862"></a>01862     }
<a name="l01863"></a>01863     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(parameter, <span class="stringliteral">&quot;cost_obsthresh&quot;</span>) == 0) {
<a name="l01864"></a>01864         <span class="keywordflow">if</span> (value &lt; 0 || value &gt; 255) {
<a name="l01865"></a>01865             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid value %d for parameter %s\n&quot;</span>, value, parameter);
<a name="l01866"></a>01866             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01867"></a>01867         }
<a name="l01868"></a>01868         EnvNAVXYTHETALATCfg.obsthresh = (<span class="keywordtype">unsigned</span> char)value;
<a name="l01869"></a>01869     }
<a name="l01870"></a>01870     <span class="keywordflow">else</span> {
<a name="l01871"></a>01871         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid parameter %s\n&quot;</span>, parameter);
<a name="l01872"></a>01872         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01873"></a>01873     }
<a name="l01874"></a>01874 
<a name="l01875"></a>01875     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01876"></a>01876 }
<a name="l01877"></a>01877 
<a name="l01878"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a07bca72b67778ac789bc199fc60f6bce">01878</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t_t_i_c_e.html#a07bca72b67778ac789bc199fc60f6bce" title="returns the value of specific parameter - see function body for the list of parameters">EnvironmentNAVXYTHETALATTICE::GetEnvParameter</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* parameter)
<a name="l01879"></a>01879 {
<a name="l01880"></a>01880     <span class="keywordflow">if</span> (strcmp(parameter, <span class="stringliteral">&quot;cost_inscribed_thresh&quot;</span>) == 0) {
<a name="l01881"></a>01881         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)EnvNAVXYTHETALATCfg.cost_inscribed_thresh;
<a name="l01882"></a>01882     }
<a name="l01883"></a>01883     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(parameter, <span class="stringliteral">&quot;cost_possibly_circumscribed_thresh&quot;</span>) == 0) {
<a name="l01884"></a>01884         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)EnvNAVXYTHETALATCfg.cost_possibly_circumscribed_thresh;
<a name="l01885"></a>01885     }
<a name="l01886"></a>01886     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(parameter, <span class="stringliteral">&quot;cost_obsthresh&quot;</span>) == 0) {
<a name="l01887"></a>01887         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)EnvNAVXYTHETALATCfg.obsthresh;
<a name="l01888"></a>01888     }
<a name="l01889"></a>01889     <span class="keywordflow">else</span> {
<a name="l01890"></a>01890         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: invalid parameter %s\n&quot;</span>, parameter);
<a name="l01891"></a>01891         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01892"></a>01892     }
<a name="l01893"></a>01893 }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l01896"></a>01896 
<a name="l01897"></a>01897 <span class="comment">//-----------------XYTHETA Enivornment (child) class---------------------------</span>
<a name="l01898"></a>01898 
<a name="l01899"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aa2597189b2093e84096ccb6d8e3ade6b">01899</a> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aa2597189b2093e84096ccb6d8e3ade6b">EnvironmentNAVXYTHETALAT::~EnvironmentNAVXYTHETALAT</a>()
<a name="l01900"></a>01900 {
<a name="l01901"></a>01901     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;destroying XYTHETALAT\n&quot;</span>);
<a name="l01902"></a>01902 
<a name="l01903"></a>01903     <span class="comment">//delete the states themselves first</span>
<a name="l01904"></a>01904     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)StateID2CoordTable.size(); i++) {
<a name="l01905"></a>01905         <span class="keyword">delete</span> StateID2CoordTable.at(i);
<a name="l01906"></a>01906         StateID2CoordTable.at(i) = NULL;
<a name="l01907"></a>01907     }
<a name="l01908"></a>01908     StateID2CoordTable.clear();
<a name="l01909"></a>01909 
<a name="l01910"></a>01910     <span class="comment">//delete hashtable</span>
<a name="l01911"></a>01911     <span class="keywordflow">if</span> (Coord2StateIDHashTable != NULL) {
<a name="l01912"></a>01912         <span class="keyword">delete</span>[] Coord2StateIDHashTable;
<a name="l01913"></a>01913         Coord2StateIDHashTable = NULL;
<a name="l01914"></a>01914     }
<a name="l01915"></a>01915     <span class="keywordflow">if</span> (Coord2StateIDHashTable_lookup != NULL) {
<a name="l01916"></a>01916         <span class="keyword">delete</span>[] Coord2StateIDHashTable_lookup;
<a name="l01917"></a>01917         Coord2StateIDHashTable_lookup = NULL;
<a name="l01918"></a>01918     }
<a name="l01919"></a>01919 }
<a name="l01920"></a>01920 
<a name="l01921"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aabfaf7faf0d2fcd0c65d943e6dee6a40">01921</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aabfaf7faf0d2fcd0c65d943e6dee6a40" title="returns state coordinates of state with ID=stateID">EnvironmentNAVXYTHETALAT::GetCoordFromState</a>(<span class="keywordtype">int</span> stateID, <span class="keywordtype">int</span>&amp; x, <span class="keywordtype">int</span>&amp; y, <span class="keywordtype">int</span>&amp; theta)<span class="keyword"> const</span>
<a name="l01922"></a>01922 <span class="keyword"></span>{
<a name="l01923"></a>01923     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = StateID2CoordTable[stateID];
<a name="l01924"></a>01924     x = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>;
<a name="l01925"></a>01925     y = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>;
<a name="l01926"></a>01926     theta = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>;
<a name="l01927"></a>01927 }
<a name="l01928"></a>01928 
<a name="l01929"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a2c68998c6915e2e06a54bcad19e95801">01929</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a2c68998c6915e2e06a54bcad19e95801" title="returns stateID for a state with coords x,y,theta">EnvironmentNAVXYTHETALAT::GetStateFromCoord</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> theta)
<a name="l01930"></a>01930 {
<a name="l01931"></a>01931     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* OutHashEntry;
<a name="l01932"></a>01932     <span class="keywordflow">if</span> ((OutHashEntry = (this-&gt;*GetHashEntry)(x, y, theta)) == NULL) {
<a name="l01933"></a>01933         <span class="comment">//have to create a new entry</span>
<a name="l01934"></a>01934         OutHashEntry = (this-&gt;*CreateNewHashEntry)(x, y, theta);
<a name="l01935"></a>01935     }
<a name="l01936"></a>01936     <span class="keywordflow">return</span> OutHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>;
<a name="l01937"></a>01937 }
<a name="l01938"></a>01938 
<a name="l01939"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aa1ae617cdf8344f3dece8e138e2b15ea">01939</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aa1ae617cdf8344f3dece8e138e2b15ea" title="converts a path given by stateIDs into a sequence of coordinates. Note that since motion primitives a...">EnvironmentNAVXYTHETALAT::ConvertStateIDPathintoXYThetaPath</a>(vector&lt;int&gt;* stateIDPath,
<a name="l01940"></a>01940                                                                  vector&lt;sbpl_xy_theta_pt_t&gt;* xythetaPath)
<a name="l01941"></a>01941 {
<a name="l01942"></a>01942     vector&lt;EnvNAVXYTHETALATAction_t*&gt; actionV;
<a name="l01943"></a>01943     vector&lt;int&gt; CostV;
<a name="l01944"></a>01944     vector&lt;int&gt; SuccIDV;
<a name="l01945"></a>01945     <span class="keywordtype">int</span> targetx_c, targety_c, targettheta_c;
<a name="l01946"></a>01946     <span class="keywordtype">int</span> sourcex_c, sourcey_c, sourcetheta_c;
<a name="l01947"></a>01947 
<a name="l01948"></a>01948     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;checks=%ld\n&quot;</span>, checks);
<a name="l01949"></a>01949 
<a name="l01950"></a>01950     xythetaPath-&gt;clear();
<a name="l01951"></a>01951 
<a name="l01952"></a>01952 <span class="preprocessor">#if DEBUG</span>
<a name="l01953"></a>01953 <span class="preprocessor"></span>    <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;converting stateid path into coordinates:\n&quot;</span>);
<a name="l01954"></a>01954 <span class="preprocessor">#endif</span>
<a name="l01955"></a>01955 <span class="preprocessor"></span>
<a name="l01956"></a>01956     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pind = 0; pind &lt; (int)(stateIDPath-&gt;size()) - 1; pind++) {
<a name="l01957"></a>01957         <span class="keywordtype">int</span> sourceID = stateIDPath-&gt;at(pind);
<a name="l01958"></a>01958         <span class="keywordtype">int</span> targetID = stateIDPath-&gt;at(pind + 1);
<a name="l01959"></a>01959 
<a name="l01960"></a>01960 <span class="preprocessor">#if DEBUG</span>
<a name="l01961"></a>01961 <span class="preprocessor"></span>        GetCoordFromState(sourceID, sourcex_c, sourcey_c, sourcetheta_c);
<a name="l01962"></a>01962 <span class="preprocessor">#endif</span>
<a name="l01963"></a>01963 <span class="preprocessor"></span>
<a name="l01964"></a>01964         <span class="comment">//get successors and pick the target via the cheapest action</span>
<a name="l01965"></a>01965         SuccIDV.clear();
<a name="l01966"></a>01966         CostV.clear();
<a name="l01967"></a>01967         actionV.clear();
<a name="l01968"></a>01968         GetSuccs(sourceID, &amp;SuccIDV, &amp;CostV, &amp;actionV);
<a name="l01969"></a>01969 
<a name="l01970"></a>01970         <span class="keywordtype">int</span> bestcost = <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>;
<a name="l01971"></a>01971         <span class="keywordtype">int</span> bestsind = -1;
<a name="l01972"></a>01972 
<a name="l01973"></a>01973 <span class="preprocessor">#if DEBUG</span>
<a name="l01974"></a>01974 <span class="preprocessor"></span>        GetCoordFromState(sourceID, sourcex_c, sourcey_c, sourcetheta_c);
<a name="l01975"></a>01975         GetCoordFromState(targetID, targetx_c, targety_c, targettheta_c);
<a name="l01976"></a>01976         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;looking for %d %d %d -&gt; %d %d %d (numofsuccs=%d)\n&quot;</span>, sourcex_c, sourcey_c, sourcetheta_c,
<a name="l01977"></a>01977                      targetx_c, targety_c, targettheta_c, (<span class="keywordtype">int</span>)SuccIDV.size());
<a name="l01978"></a>01978 <span class="preprocessor">#endif</span>
<a name="l01979"></a>01979 <span class="preprocessor"></span>
<a name="l01980"></a>01980         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sind = 0; sind &lt; (int)SuccIDV.size(); sind++) {
<a name="l01981"></a>01981 <span class="preprocessor">#if DEBUG</span>
<a name="l01982"></a>01982 <span class="preprocessor"></span>            <span class="keywordtype">int</span> x_c, y_c, theta_c;
<a name="l01983"></a>01983             GetCoordFromState(SuccIDV[sind], x_c, y_c, theta_c);
<a name="l01984"></a>01984             <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;succ: %d %d %d\n&quot;</span>, x_c, y_c, theta_c);
<a name="l01985"></a>01985 <span class="preprocessor">#endif</span>
<a name="l01986"></a>01986 <span class="preprocessor"></span>
<a name="l01987"></a>01987             <span class="keywordflow">if</span> (SuccIDV[sind] == targetID &amp;&amp; CostV[sind] &lt;= bestcost) {
<a name="l01988"></a>01988                 bestcost = CostV[sind];
<a name="l01989"></a>01989                 bestsind = sind;
<a name="l01990"></a>01990             }
<a name="l01991"></a>01991         }
<a name="l01992"></a>01992         <span class="keywordflow">if</span> (bestsind == -1) {
<a name="l01993"></a>01993             <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: successor not found for transition:\n&quot;</span>);
<a name="l01994"></a>01994             GetCoordFromState(sourceID, sourcex_c, sourcey_c, sourcetheta_c);
<a name="l01995"></a>01995             GetCoordFromState(targetID, targetx_c, targety_c, targettheta_c);
<a name="l01996"></a>01996             <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;%d %d %d -&gt; %d %d %d\n&quot;</span>, sourcex_c, sourcey_c, sourcetheta_c, targetx_c, targety_c,
<a name="l01997"></a>01997                         targettheta_c);
<a name="l01998"></a>01998             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l01999"></a>01999         }
<a name="l02000"></a>02000 
<a name="l02001"></a>02001         <span class="comment">//now push in the actual path</span>
<a name="l02002"></a>02002         <span class="keywordtype">int</span> sourcex_c, sourcey_c, sourcetheta_c;
<a name="l02003"></a>02003         GetCoordFromState(sourceID, sourcex_c, sourcey_c, sourcetheta_c);
<a name="l02004"></a>02004         <span class="keywordtype">double</span> sourcex, sourcey;
<a name="l02005"></a>02005         sourcex = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(sourcex_c, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l02006"></a>02006         sourcey = <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(sourcey_c, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l02007"></a>02007         <span class="comment">//TODO - when there are no motion primitives we should still print source state</span>
<a name="l02008"></a>02008         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipind = 0; ipind &lt; ((int)actionV[bestsind]-&gt;intermptV.size()) - 1; ipind++) {
<a name="l02009"></a>02009             <span class="comment">//translate appropriately</span>
<a name="l02010"></a>02010             <a class="code" href="classsbpl__xy__theta__pt__t.html">sbpl_xy_theta_pt_t</a> intermpt = actionV[bestsind]-&gt;intermptV[ipind];
<a name="l02011"></a>02011             intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a> += sourcex;
<a name="l02012"></a>02012             intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a> += sourcey;
<a name="l02013"></a>02013 
<a name="l02014"></a>02014 <span class="preprocessor">#if DEBUG</span>
<a name="l02015"></a>02015 <span class="preprocessor"></span>            <span class="keywordtype">int</span> nx = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a>, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l02016"></a>02016             <span class="keywordtype">int</span> ny = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a>, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l02017"></a>02017             <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;%.3f %.3f %.3f (%d %d %d cost=%d) &quot;</span>,
<a name="l02018"></a>02018                 intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a8a02caf4b7373b87b881a087ca0b2e25">x</a>, intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a2b9fc5f62b5459bb31aeb4de82094fad">y</a>, intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>,
<a name="l02019"></a>02019                 nx, ny,
<a name="l02020"></a>02020                 <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(intermpt.<a class="code" href="classsbpl__xy__theta__pt__t.html#a821129068862c3cbe1c051a175fddf5b">theta</a>, EnvNAVXYTHETALATCfg.NumThetaDirs), EnvNAVXYTHETALATCfg.Grid2D[nx][ny]);
<a name="l02021"></a>02021             <span class="keywordflow">if</span>(ipind == 0) <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;first (heur=%d)\n&quot;</span>, GetStartHeuristic(sourceID));
<a name="l02022"></a>02022             <span class="keywordflow">else</span> <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02023"></a>02023 <span class="preprocessor">#endif</span>
<a name="l02024"></a>02024 <span class="preprocessor"></span>
<a name="l02025"></a>02025             <span class="comment">//store</span>
<a name="l02026"></a>02026             xythetaPath-&gt;push_back(intermpt);
<a name="l02027"></a>02027         }
<a name="l02028"></a>02028     }
<a name="l02029"></a>02029 }
<a name="l02030"></a>02030 
<a name="l02031"></a>02031 <span class="comment">//returns the stateid if success, and -1 otherwise</span>
<a name="l02032"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a0326e323dd0a6c6f8b0c296fc7d68e5d">02032</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a0326e323dd0a6c6f8b0c296fc7d68e5d" title="sets goal in meters/radians">EnvironmentNAVXYTHETALAT::SetGoal</a>(<span class="keywordtype">double</span> x_m, <span class="keywordtype">double</span> y_m, <span class="keywordtype">double</span> theta_rad)
<a name="l02033"></a>02033 {
<a name="l02034"></a>02034     <span class="keywordtype">int</span> x = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(x_m, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l02035"></a>02035     <span class="keywordtype">int</span> y = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(y_m, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l02036"></a>02036     <span class="keywordtype">int</span> theta = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(theta_rad, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l02037"></a>02037 
<a name="l02038"></a>02038     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;env: setting goal to %.3f %.3f %.3f (%d %d %d)\n&quot;</span>, x_m, y_m, theta_rad, x, y, theta);
<a name="l02039"></a>02039 
<a name="l02040"></a>02040     <span class="keywordflow">if</span> (!IsWithinMapCell(x, y)) {
<a name="l02041"></a>02041         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: trying to set a goal cell %d %d that is outside of map\n&quot;</span>, x, y);
<a name="l02042"></a>02042         <span class="keywordflow">return</span> -1;
<a name="l02043"></a>02043     }
<a name="l02044"></a>02044 
<a name="l02045"></a>02045     <span class="keywordflow">if</span> (!IsValidConfiguration(x, y, theta)) {
<a name="l02046"></a>02046         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;WARNING: goal configuration is invalid\n&quot;</span>);
<a name="l02047"></a>02047     }
<a name="l02048"></a>02048 
<a name="l02049"></a>02049     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* OutHashEntry;
<a name="l02050"></a>02050     <span class="keywordflow">if</span> ((OutHashEntry = (this-&gt;*GetHashEntry)(x, y, theta)) == NULL) {
<a name="l02051"></a>02051         <span class="comment">//have to create a new entry</span>
<a name="l02052"></a>02052         OutHashEntry = (this-&gt;*CreateNewHashEntry)(x, y, theta);
<a name="l02053"></a>02053     }
<a name="l02054"></a>02054 
<a name="l02055"></a>02055     <span class="comment">//need to recompute start heuristics?</span>
<a name="l02056"></a>02056     <span class="keywordflow">if</span> (EnvNAVXYTHETALAT.goalstateid != OutHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>) {
<a name="l02057"></a>02057         bNeedtoRecomputeStartHeuristics = <span class="keyword">true</span>; <span class="comment">//because termination condition may not plan all the way to the new goal</span>
<a name="l02058"></a>02058         bNeedtoRecomputeGoalHeuristics = <span class="keyword">true</span>; <span class="comment">//because goal heuristics change</span>
<a name="l02059"></a>02059     }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061     EnvNAVXYTHETALAT.goalstateid = OutHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>;
<a name="l02062"></a>02062 
<a name="l02063"></a>02063     EnvNAVXYTHETALATCfg.EndX_c = x;
<a name="l02064"></a>02064     EnvNAVXYTHETALATCfg.EndY_c = y;
<a name="l02065"></a>02065     EnvNAVXYTHETALATCfg.EndTheta = theta;
<a name="l02066"></a>02066 
<a name="l02067"></a>02067     <span class="keywordflow">return</span> EnvNAVXYTHETALAT.goalstateid;
<a name="l02068"></a>02068 }
<a name="l02069"></a>02069 
<a name="l02070"></a>02070 <span class="comment">//returns the stateid if success, and -1 otherwise</span>
<a name="l02071"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a8167b5b3b5f148588d9299a3ba139dd0">02071</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a8167b5b3b5f148588d9299a3ba139dd0" title="sets start in meters/radians">EnvironmentNAVXYTHETALAT::SetStart</a>(<span class="keywordtype">double</span> x_m, <span class="keywordtype">double</span> y_m, <span class="keywordtype">double</span> theta_rad)
<a name="l02072"></a>02072 {
<a name="l02073"></a>02073     <span class="keywordtype">int</span> x = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(x_m, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l02074"></a>02074     <span class="keywordtype">int</span> y = <a class="code" href="utils_8h.html#abc29df86c29a2c45a86b757e89e7fb2b">CONTXY2DISC</a>(y_m, EnvNAVXYTHETALATCfg.cellsize_m);
<a name="l02075"></a>02075     <span class="keywordtype">int</span> theta = <a class="code" href="utils_8h.html#a8e6d877b34999a3b42774143c955e6a1" title="converts continuous (radians) version of angle into discrete">ContTheta2Disc</a>(theta_rad, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l02076"></a>02076 
<a name="l02077"></a>02077     <span class="keywordflow">if</span> (!IsWithinMapCell(x, y)) {
<a name="l02078"></a>02078         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: trying to set a start cell %d %d that is outside of map\n&quot;</span>, x, y);
<a name="l02079"></a>02079         <span class="keywordflow">return</span> -1;
<a name="l02080"></a>02080     }
<a name="l02081"></a>02081 
<a name="l02082"></a>02082     <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;env: setting start to %.3f %.3f %.3f (%d %d %d)\n&quot;</span>, x_m, y_m, theta_rad, x, y, theta);
<a name="l02083"></a>02083 
<a name="l02084"></a>02084     <span class="keywordflow">if</span> (!IsValidConfiguration(x, y, theta)) {
<a name="l02085"></a>02085         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;WARNING: start configuration %d %d %d is invalid\n&quot;</span>, x, y, theta);
<a name="l02086"></a>02086     }
<a name="l02087"></a>02087 
<a name="l02088"></a>02088     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* OutHashEntry;
<a name="l02089"></a>02089     <span class="keywordflow">if</span> ((OutHashEntry = (this-&gt;*GetHashEntry)(x, y, theta)) == NULL) {
<a name="l02090"></a>02090         <span class="comment">//have to create a new entry</span>
<a name="l02091"></a>02091         OutHashEntry = (this-&gt;*CreateNewHashEntry)(x, y, theta);
<a name="l02092"></a>02092     }
<a name="l02093"></a>02093 
<a name="l02094"></a>02094     <span class="comment">//need to recompute start heuristics?</span>
<a name="l02095"></a>02095     <span class="keywordflow">if</span> (EnvNAVXYTHETALAT.startstateid != OutHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>) {
<a name="l02096"></a>02096         bNeedtoRecomputeStartHeuristics = <span class="keyword">true</span>;
<a name="l02097"></a>02097         <span class="comment">//because termination condition can be not all states TODO - make it dependent on term. condition</span>
<a name="l02098"></a>02098         bNeedtoRecomputeGoalHeuristics = <span class="keyword">true</span>; 
<a name="l02099"></a>02099     }
<a name="l02100"></a>02100 
<a name="l02101"></a>02101     <span class="comment">//set start</span>
<a name="l02102"></a>02102     EnvNAVXYTHETALAT.startstateid = OutHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>;
<a name="l02103"></a>02103     EnvNAVXYTHETALATCfg.StartX_c = x;
<a name="l02104"></a>02104     EnvNAVXYTHETALATCfg.StartY_c = y;
<a name="l02105"></a>02105     EnvNAVXYTHETALATCfg.StartTheta = theta;
<a name="l02106"></a>02106 
<a name="l02107"></a>02107     <span class="keywordflow">return</span> EnvNAVXYTHETALAT.startstateid;
<a name="l02108"></a>02108 }
<a name="l02109"></a>02109 
<a name="l02110"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a4676256caac738f0c9f8cecba67ac7ef">02110</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a4676256caac738f0c9f8cecba67ac7ef" title="prints state info (coordinates) into file">EnvironmentNAVXYTHETALAT::PrintState</a>(<span class="keywordtype">int</span> stateID, <span class="keywordtype">bool</span> bVerbose, FILE* fOut <span class="comment">/*=NULL*/</span>)
<a name="l02111"></a>02111 {
<a name="l02112"></a>02112 <span class="preprocessor">#if DEBUG</span>
<a name="l02113"></a>02113 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(stateID &gt;= (<span class="keywordtype">int</span>)StateID2CoordTable.size())
<a name="l02114"></a>02114     {
<a name="l02115"></a>02115         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvNAVXYTHETALAT... function: stateID illegal (2)\n&quot;</span>);
<a name="l02116"></a>02116         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02117"></a>02117     }
<a name="l02118"></a>02118 <span class="preprocessor">#endif</span>
<a name="l02119"></a>02119 <span class="preprocessor"></span>
<a name="l02120"></a>02120     <span class="keywordflow">if</span> (fOut == NULL) fOut = stdout;
<a name="l02121"></a>02121 
<a name="l02122"></a>02122     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = StateID2CoordTable[stateID];
<a name="l02123"></a>02123 
<a name="l02124"></a>02124     <span class="keywordflow">if</span> (stateID == EnvNAVXYTHETALAT.goalstateid &amp;&amp; bVerbose) {
<a name="l02125"></a>02125         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;the state is a goal state\n&quot;</span>);
<a name="l02126"></a>02126     }
<a name="l02127"></a>02127 
<a name="l02128"></a>02128     <span class="keywordflow">if</span> (bVerbose)
<a name="l02129"></a>02129         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;X=%d Y=%d Theta=%d\n&quot;</span>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>);
<a name="l02130"></a>02130     <span class="keywordflow">else</span>
<a name="l02131"></a>02131         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;%.3f %.3f %.3f\n&quot;</span>, <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, EnvNAVXYTHETALATCfg.cellsize_m),
<a name="l02132"></a>02132                      <a class="code" href="utils_8h.html#a5d31d5012a4389631295c4e88d3cae18">DISCXY2CONT</a>(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>, EnvNAVXYTHETALATCfg.cellsize_m),
<a name="l02133"></a>02133                      <a class="code" href="utils_8h.html#a31a0d4ef0a3b849b0a4dbecb92d77d6a" title="converts discretized version of angle into continuous (radians)">DiscTheta2Cont</a>(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>, EnvNAVXYTHETALATCfg.NumThetaDirs));
<a name="l02134"></a>02134 }
<a name="l02135"></a>02135 
<a name="l02136"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a7eaee890c040d13dd80c8f755b50dcfd">02136</a> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a7eaee890c040d13dd80c8f755b50dcfd">EnvironmentNAVXYTHETALAT::GetHashEntry_lookup</a>(<span class="keywordtype">int</span> X, <span class="keywordtype">int</span> Y, <span class="keywordtype">int</span> Theta)
<a name="l02137"></a>02137 {
<a name="l02138"></a>02138     <span class="keywordflow">if</span> (X &lt; 0 || X &gt;= EnvNAVXYTHETALATCfg.EnvWidth_c || Y &lt; 0 || Y &gt;= EnvNAVXYTHETALATCfg.EnvHeight_c || Theta &lt; 0 ||
<a name="l02139"></a>02139         Theta &gt;= EnvNAVXYTHETALATCfg.NumThetaDirs) <span class="keywordflow">return</span> NULL;
<a name="l02140"></a>02140     <span class="keywordtype">int</span> index = <a class="code" href="environment__navxythetalat_8cpp.html#ad0288ed61a50f6443eed0416f679e61f">XYTHETA2INDEX</a>(X,Y,Theta);
<a name="l02141"></a>02141     <span class="keywordflow">return</span> Coord2StateIDHashTable_lookup[index];
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 
<a name="l02144"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#ab3d1c4ae85b08b03ba7025ca13ea5432">02144</a> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#ab3d1c4ae85b08b03ba7025ca13ea5432">EnvironmentNAVXYTHETALAT::GetHashEntry_hash</a>(<span class="keywordtype">int</span> X, <span class="keywordtype">int</span> Y, <span class="keywordtype">int</span> Theta)
<a name="l02145"></a>02145 {
<a name="l02146"></a>02146 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02147"></a>02147 <span class="preprocessor"></span>    clock_t currenttime = clock();
<a name="l02148"></a>02148 <span class="preprocessor">#endif</span>
<a name="l02149"></a>02149 <span class="preprocessor"></span>
<a name="l02150"></a>02150     <span class="keywordtype">int</span> binid = GETHASHBIN(X, Y, Theta);
<a name="l02151"></a>02151 
<a name="l02152"></a>02152 <span class="preprocessor">#if DEBUG</span>
<a name="l02153"></a>02153 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)Coord2StateIDHashTable[binid].size() &gt; 5)
<a name="l02154"></a>02154     {
<a name="l02155"></a>02155         <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fDeb, <span class="stringliteral">&quot;WARNING: Hash table has a bin %d (X=%d Y=%d) of size %d\n&quot;</span>,
<a name="l02156"></a>02156             binid, X, Y, (<span class="keywordtype">int</span>)Coord2StateIDHashTable[binid].size());
<a name="l02157"></a>02157 
<a name="l02158"></a>02158         PrintHashTableHist(fDeb);
<a name="l02159"></a>02159     }
<a name="l02160"></a>02160 <span class="preprocessor">#endif</span>
<a name="l02161"></a>02161 <span class="preprocessor"></span>
<a name="l02162"></a>02162     <span class="comment">//iterate over the states in the bin and select the perfect match</span>
<a name="l02163"></a>02163     vector&lt;EnvNAVXYTHETALATHashEntry_t*&gt;* binV = &amp;Coord2StateIDHashTable[binid];
<a name="l02164"></a>02164     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ind = 0; ind &lt; (int)binV-&gt;size(); ind++) {
<a name="l02165"></a>02165         <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* hashentry = binV-&gt;at(ind);
<a name="l02166"></a>02166         <span class="keywordflow">if</span> (hashentry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a> == X &amp;&amp; hashentry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a> == Y &amp;&amp; hashentry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a> == Theta) {
<a name="l02167"></a>02167 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02168"></a>02168 <span class="preprocessor"></span>            time_gethash += clock()-currenttime;
<a name="l02169"></a>02169 <span class="preprocessor">#endif</span>
<a name="l02170"></a>02170 <span class="preprocessor"></span>            <span class="keywordflow">return</span> hashentry;
<a name="l02171"></a>02171         }
<a name="l02172"></a>02172     }
<a name="l02173"></a>02173 
<a name="l02174"></a>02174 <span class="preprocessor">#if TIME_DEBUG  </span>
<a name="l02175"></a>02175 <span class="preprocessor"></span>    time_gethash += clock()-currenttime;
<a name="l02176"></a>02176 <span class="preprocessor">#endif</span>
<a name="l02177"></a>02177 <span class="preprocessor"></span>
<a name="l02178"></a>02178     <span class="keywordflow">return</span> NULL;
<a name="l02179"></a>02179 }
<a name="l02180"></a>02180 
<a name="l02181"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aebf9769e7404224b1b0273e33775824d">02181</a> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aebf9769e7404224b1b0273e33775824d">EnvironmentNAVXYTHETALAT::CreateNewHashEntry_lookup</a>(<span class="keywordtype">int</span> X, <span class="keywordtype">int</span> Y, <span class="keywordtype">int</span> Theta)
<a name="l02182"></a>02182 {
<a name="l02183"></a>02183     <span class="keywordtype">int</span> i;
<a name="l02184"></a>02184 
<a name="l02185"></a>02185 <span class="preprocessor">#if TIME_DEBUG  </span>
<a name="l02186"></a>02186 <span class="preprocessor"></span>    clock_t currenttime = clock();
<a name="l02187"></a>02187 <span class="preprocessor">#endif</span>
<a name="l02188"></a>02188 <span class="preprocessor"></span>
<a name="l02189"></a>02189     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>;
<a name="l02190"></a>02190 
<a name="l02191"></a>02191     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a> = X;
<a name="l02192"></a>02192     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a> = Y;
<a name="l02193"></a>02193     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a> = Theta;
<a name="l02194"></a>02194     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a1c7f121dee151278e335157e7ad5d41d">iteration</a> = 0;
<a name="l02195"></a>02195 
<a name="l02196"></a>02196     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a> = StateID2CoordTable.size();
<a name="l02197"></a>02197 
<a name="l02198"></a>02198     <span class="comment">//insert into the tables</span>
<a name="l02199"></a>02199     StateID2CoordTable.push_back(HashEntry);
<a name="l02200"></a>02200 
<a name="l02201"></a>02201     <span class="keywordtype">int</span> index = <a class="code" href="environment__navxythetalat_8cpp.html#ad0288ed61a50f6443eed0416f679e61f">XYTHETA2INDEX</a>(X,Y,Theta);
<a name="l02202"></a>02202 
<a name="l02203"></a>02203 <span class="preprocessor">#if DEBUG</span>
<a name="l02204"></a>02204 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(Coord2StateIDHashTable_lookup[index] != NULL)
<a name="l02205"></a>02205     {
<a name="l02206"></a>02206         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: creating hash entry for non-NULL hashentry\n&quot;</span>);
<a name="l02207"></a>02207         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02208"></a>02208     }
<a name="l02209"></a>02209 <span class="preprocessor">#endif</span>
<a name="l02210"></a>02210 <span class="preprocessor"></span>
<a name="l02211"></a>02211     Coord2StateIDHashTable_lookup[index] = HashEntry;
<a name="l02212"></a>02212 
<a name="l02213"></a>02213     <span class="comment">//insert into and initialize the mappings</span>
<a name="l02214"></a>02214     <span class="keywordtype">int</span>* entry = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="planner_8h.html#a77c24f4e231cd4b865d394d60a27a85aad8c7e51ce373384e5d809bd8e658ac38">NUMOFINDICES_STATEID2IND</a>];
<a name="l02215"></a>02215     StateID2IndexMapping.push_back(entry);
<a name="l02216"></a>02216     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="planner_8h.html#a77c24f4e231cd4b865d394d60a27a85aad8c7e51ce373384e5d809bd8e658ac38">NUMOFINDICES_STATEID2IND</a>; i++) {
<a name="l02217"></a>02217         StateID2IndexMapping[HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>][i] = -1;
<a name="l02218"></a>02218     }
<a name="l02219"></a>02219 
<a name="l02220"></a>02220     <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a> != (<span class="keywordtype">int</span>)StateID2IndexMapping.size() - 1) {
<a name="l02221"></a>02221         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in Env... function: last state has incorrect stateID\n&quot;</span>);
<a name="l02222"></a>02222         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02223"></a>02223     }
<a name="l02224"></a>02224 
<a name="l02225"></a>02225 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02226"></a>02226 <span class="preprocessor"></span>    time_createhash += clock()-currenttime;
<a name="l02227"></a>02227 <span class="preprocessor">#endif</span>
<a name="l02228"></a>02228 <span class="preprocessor"></span>
<a name="l02229"></a>02229     <span class="keywordflow">return</span> HashEntry;
<a name="l02230"></a>02230 }
<a name="l02231"></a>02231 
<a name="l02232"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#afc98fe01b707e858eed4eb692e4d98e1">02232</a> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#afc98fe01b707e858eed4eb692e4d98e1">EnvironmentNAVXYTHETALAT::CreateNewHashEntry_hash</a>(<span class="keywordtype">int</span> X, <span class="keywordtype">int</span> Y, <span class="keywordtype">int</span> Theta)
<a name="l02233"></a>02233 {
<a name="l02234"></a>02234     <span class="keywordtype">int</span> i;
<a name="l02235"></a>02235 
<a name="l02236"></a>02236 <span class="preprocessor">#if TIME_DEBUG  </span>
<a name="l02237"></a>02237 <span class="preprocessor"></span>    clock_t currenttime = clock();
<a name="l02238"></a>02238 <span class="preprocessor">#endif</span>
<a name="l02239"></a>02239 <span class="preprocessor"></span>
<a name="l02240"></a>02240     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>;
<a name="l02241"></a>02241 
<a name="l02242"></a>02242     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a> = X;
<a name="l02243"></a>02243     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a> = Y;
<a name="l02244"></a>02244     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a> = Theta;
<a name="l02245"></a>02245     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a1c7f121dee151278e335157e7ad5d41d">iteration</a> = 0;
<a name="l02246"></a>02246 
<a name="l02247"></a>02247     HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a> = StateID2CoordTable.size();
<a name="l02248"></a>02248 
<a name="l02249"></a>02249     <span class="comment">//insert into the tables</span>
<a name="l02250"></a>02250     StateID2CoordTable.push_back(HashEntry);
<a name="l02251"></a>02251 
<a name="l02252"></a>02252     <span class="comment">//get the hash table bin</span>
<a name="l02253"></a>02253     i = GETHASHBIN(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>);
<a name="l02254"></a>02254 
<a name="l02255"></a>02255     <span class="comment">//insert the entry into the bin</span>
<a name="l02256"></a>02256     Coord2StateIDHashTable[i].push_back(HashEntry);
<a name="l02257"></a>02257 
<a name="l02258"></a>02258     <span class="comment">//insert into and initialize the mappings</span>
<a name="l02259"></a>02259     <span class="keywordtype">int</span>* entry = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="planner_8h.html#a77c24f4e231cd4b865d394d60a27a85aad8c7e51ce373384e5d809bd8e658ac38">NUMOFINDICES_STATEID2IND</a>];
<a name="l02260"></a>02260     StateID2IndexMapping.push_back(entry);
<a name="l02261"></a>02261     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="planner_8h.html#a77c24f4e231cd4b865d394d60a27a85aad8c7e51ce373384e5d809bd8e658ac38">NUMOFINDICES_STATEID2IND</a>; i++) {
<a name="l02262"></a>02262         StateID2IndexMapping[HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>][i] = -1;
<a name="l02263"></a>02263     }
<a name="l02264"></a>02264 
<a name="l02265"></a>02265     <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a> != (<span class="keywordtype">int</span>)StateID2IndexMapping.size() - 1) {
<a name="l02266"></a>02266         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in Env... function: last state has incorrect stateID\n&quot;</span>);
<a name="l02267"></a>02267         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02268"></a>02268     }
<a name="l02269"></a>02269 
<a name="l02270"></a>02270 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02271"></a>02271 <span class="preprocessor"></span>    time_createhash += clock()-currenttime;
<a name="l02272"></a>02272 <span class="preprocessor">#endif</span>
<a name="l02273"></a>02273 <span class="preprocessor"></span>
<a name="l02274"></a>02274     <span class="keywordflow">return</span> HashEntry;
<a name="l02275"></a>02275 }
<a name="l02276"></a>02276 
<a name="l02277"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a0b2a4c75bde6cf876a8f4b2771cf2330">02277</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a0b2a4c75bde6cf876a8f4b2771cf2330" title="returns all successors states, costs of corresponding actions and pointers to corresponding actions...">EnvironmentNAVXYTHETALAT::GetSuccs</a>(<span class="keywordtype">int</span> SourceStateID, vector&lt;int&gt;* SuccIDV, vector&lt;int&gt;* CostV, vector&lt;
<a name="l02278"></a>02278     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>*&gt;* actionV <span class="comment">/*=NULL*/</span>)
<a name="l02279"></a>02279 {
<a name="l02280"></a>02280     <span class="keywordtype">int</span> aind;
<a name="l02281"></a>02281 
<a name="l02282"></a>02282 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02283"></a>02283 <span class="preprocessor"></span>    clock_t currenttime = clock();
<a name="l02284"></a>02284 <span class="preprocessor">#endif</span>
<a name="l02285"></a>02285 <span class="preprocessor"></span>
<a name="l02286"></a>02286     <span class="comment">//clear the successor array</span>
<a name="l02287"></a>02287     SuccIDV-&gt;clear();
<a name="l02288"></a>02288     CostV-&gt;clear();
<a name="l02289"></a>02289     SuccIDV-&gt;reserve(EnvNAVXYTHETALATCfg.actionwidth);
<a name="l02290"></a>02290     CostV-&gt;reserve(EnvNAVXYTHETALATCfg.actionwidth);
<a name="l02291"></a>02291     <span class="keywordflow">if</span> (actionV != NULL) {
<a name="l02292"></a>02292         actionV-&gt;clear();
<a name="l02293"></a>02293         actionV-&gt;reserve(EnvNAVXYTHETALATCfg.actionwidth);
<a name="l02294"></a>02294     }
<a name="l02295"></a>02295 
<a name="l02296"></a>02296     <span class="comment">//goal state should be absorbing</span>
<a name="l02297"></a>02297     <span class="keywordflow">if</span> (SourceStateID == EnvNAVXYTHETALAT.goalstateid) <span class="keywordflow">return</span>;
<a name="l02298"></a>02298 
<a name="l02299"></a>02299     <span class="comment">//get X, Y for the state</span>
<a name="l02300"></a>02300     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = StateID2CoordTable[SourceStateID];
<a name="l02301"></a>02301 
<a name="l02302"></a>02302     <span class="comment">//iterate through actions</span>
<a name="l02303"></a>02303     <span class="keywordflow">for</span> (aind = 0; aind &lt; EnvNAVXYTHETALATCfg.actionwidth; aind++) {
<a name="l02304"></a>02304         <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>* nav3daction = &amp;EnvNAVXYTHETALATCfg.ActionsV[(<span class="keywordtype">unsigned</span> int)HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>][aind];
<a name="l02305"></a>02305         <span class="keywordtype">int</span> newX = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a> + nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>;
<a name="l02306"></a>02306         <span class="keywordtype">int</span> newY = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a> + nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>;
<a name="l02307"></a>02307         <span class="keywordtype">int</span> newTheta = <a class="code" href="utils_8h.html#a78721379426df9924c9d694c41cd195d">NORMALIZEDISCTHETA</a>(nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#a8f62400ae7def338cfd8fb89436f9aae">endtheta</a>, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l02308"></a>02308 
<a name="l02309"></a>02309         <span class="comment">//skip the invalid cells</span>
<a name="l02310"></a>02310         <span class="keywordflow">if</span> (!IsValidCell(newX, newY)) <span class="keywordflow">continue</span>;
<a name="l02311"></a>02311 
<a name="l02312"></a>02312         <span class="comment">//get cost</span>
<a name="l02313"></a>02313         <span class="keywordtype">int</span> cost = GetActionCost(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>, nav3daction);
<a name="l02314"></a>02314         <span class="keywordflow">if</span> (cost &gt;= <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>) <span class="keywordflow">continue</span>;
<a name="l02315"></a>02315 
<a name="l02316"></a>02316         <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* OutHashEntry;
<a name="l02317"></a>02317         <span class="keywordflow">if</span> ((OutHashEntry = (this-&gt;*GetHashEntry)(newX, newY, newTheta)) == NULL) {
<a name="l02318"></a>02318             <span class="comment">//have to create a new entry</span>
<a name="l02319"></a>02319             OutHashEntry = (this-&gt;*CreateNewHashEntry)(newX, newY, newTheta);
<a name="l02320"></a>02320         }
<a name="l02321"></a>02321 
<a name="l02322"></a>02322         SuccIDV-&gt;push_back(OutHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>);
<a name="l02323"></a>02323         CostV-&gt;push_back(cost);
<a name="l02324"></a>02324         <span class="keywordflow">if</span> (actionV != NULL) actionV-&gt;push_back(nav3daction);
<a name="l02325"></a>02325     }
<a name="l02326"></a>02326 
<a name="l02327"></a>02327 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02328"></a>02328 <span class="preprocessor"></span>    time_getsuccs += clock()-currenttime;
<a name="l02329"></a>02329 <span class="preprocessor">#endif</span>
<a name="l02330"></a>02330 <span class="preprocessor"></span>}
<a name="l02331"></a>02331 
<a name="l02332"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#adf857f7be2347333522e755432401f07">02332</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#adf857f7be2347333522e755432401f07" title="returns all predecessors states and corresponding costs of actions">EnvironmentNAVXYTHETALAT::GetPreds</a>(<span class="keywordtype">int</span> TargetStateID, vector&lt;int&gt;* PredIDV, vector&lt;int&gt;* CostV)
<a name="l02333"></a>02333 {
<a name="l02334"></a>02334     <span class="comment">//TODO- to support tolerance, need:</span>
<a name="l02335"></a>02335     <span class="comment">// a) generate preds for goal state based on all possible goal state variable settings,</span>
<a name="l02336"></a>02336     <span class="comment">// b) change goal check condition in gethashentry c) change</span>
<a name="l02337"></a>02337     <span class="comment">//    getpredsofchangedcells and getsuccsofchangedcells functions</span>
<a name="l02338"></a>02338 
<a name="l02339"></a>02339     <span class="keywordtype">int</span> aind;
<a name="l02340"></a>02340 
<a name="l02341"></a>02341 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02342"></a>02342 <span class="preprocessor"></span>    clock_t currenttime = clock();
<a name="l02343"></a>02343 <span class="preprocessor">#endif</span>
<a name="l02344"></a>02344 <span class="preprocessor"></span>
<a name="l02345"></a>02345     <span class="comment">//get X, Y for the state</span>
<a name="l02346"></a>02346     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = StateID2CoordTable[TargetStateID];
<a name="l02347"></a>02347 
<a name="l02348"></a>02348     <span class="comment">//clear the successor array</span>
<a name="l02349"></a>02349     PredIDV-&gt;clear();
<a name="l02350"></a>02350     CostV-&gt;clear();
<a name="l02351"></a>02351     PredIDV-&gt;reserve(EnvNAVXYTHETALATCfg.PredActionsV[(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>].size());
<a name="l02352"></a>02352     CostV-&gt;reserve(EnvNAVXYTHETALATCfg.PredActionsV[(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>].size());
<a name="l02353"></a>02353 
<a name="l02354"></a>02354     <span class="comment">//iterate through actions</span>
<a name="l02355"></a>02355     vector&lt;EnvNAVXYTHETALATAction_t*&gt;* actionsV = &amp;EnvNAVXYTHETALATCfg.PredActionsV[(<span class="keywordtype">unsigned</span> int)HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>];
<a name="l02356"></a>02356     for (aind = 0; aind &lt; (int)EnvNAVXYTHETALATCfg.PredActionsV[(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>].size(); aind++) {
<a name="l02357"></a>02357 
<a name="l02358"></a>02358         <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>* nav3daction = actionsV-&gt;at(aind);
<a name="l02359"></a>02359 
<a name="l02360"></a>02360         <span class="keywordtype">int</span> predX = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a> - nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>;
<a name="l02361"></a>02361         <span class="keywordtype">int</span> predY = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a> - nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>;
<a name="l02362"></a>02362         <span class="keywordtype">int</span> predTheta = nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ac7128ff990bf24d3fc7d6250a7cfeee4">starttheta</a>;
<a name="l02363"></a>02363 
<a name="l02364"></a>02364         <span class="comment">//skip the invalid cells</span>
<a name="l02365"></a>02365         <span class="keywordflow">if</span> (!IsValidCell(predX, predY)) <span class="keywordflow">continue</span>;
<a name="l02366"></a>02366 
<a name="l02367"></a>02367         <span class="comment">//get cost</span>
<a name="l02368"></a>02368         <span class="keywordtype">int</span> cost = GetActionCost(predX, predY, predTheta, nav3daction);
<a name="l02369"></a>02369         <span class="keywordflow">if</span> (cost &gt;= <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>) <span class="keywordflow">continue</span>;
<a name="l02370"></a>02370 
<a name="l02371"></a>02371         <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* OutHashEntry;
<a name="l02372"></a>02372         <span class="keywordflow">if</span> ((OutHashEntry = (this-&gt;*GetHashEntry)(predX, predY, predTheta)) == NULL) {
<a name="l02373"></a>02373             <span class="comment">//have to create a new entry</span>
<a name="l02374"></a>02374             OutHashEntry = (this-&gt;*CreateNewHashEntry)(predX, predY, predTheta);
<a name="l02375"></a>02375         }
<a name="l02376"></a>02376 
<a name="l02377"></a>02377         PredIDV-&gt;push_back(OutHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>);
<a name="l02378"></a>02378         CostV-&gt;push_back(cost);
<a name="l02379"></a>02379     }
<a name="l02380"></a>02380 
<a name="l02381"></a>02381 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02382"></a>02382 <span class="preprocessor"></span>    time_getsuccs += clock()-currenttime;
<a name="l02383"></a>02383 <span class="preprocessor">#endif</span>
<a name="l02384"></a>02384 <span class="preprocessor"></span>}
<a name="l02385"></a>02385 
<a name="l02386"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a39e36cb4684933ff6a7adb2d6082a4ca">02386</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a39e36cb4684933ff6a7adb2d6082a4ca" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALAT::SetAllActionsandAllOutcomes</a>(<a class="code" href="class_c_m_d_p_s_t_a_t_e.html">CMDPSTATE</a>* state)
<a name="l02387"></a>02387 {
<a name="l02388"></a>02388     <span class="keywordtype">int</span> cost;
<a name="l02389"></a>02389 
<a name="l02390"></a>02390 <span class="preprocessor">#if DEBUG</span>
<a name="l02391"></a>02391 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(state-&gt;<a class="code" href="class_c_m_d_p_s_t_a_t_e.html#a48273119863e07bb6e2ebcedba50e283">StateID</a> &gt;= (<span class="keywordtype">int</span>)StateID2CoordTable.size())
<a name="l02392"></a>02392     {
<a name="l02393"></a>02393         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in Env... function: stateID illegal\n&quot;</span>);
<a name="l02394"></a>02394         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02395"></a>02395     }
<a name="l02396"></a>02396 
<a name="l02397"></a>02397     <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)state-&gt;<a class="code" href="class_c_m_d_p_s_t_a_t_e.html#a4ea1e349ffb14fe5ec0efe6fb533f696">Actions</a>.size() != 0)
<a name="l02398"></a>02398     {
<a name="l02399"></a>02399         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in Env_setAllActionsandAllOutcomes: actions already exist for the state\n&quot;</span>);
<a name="l02400"></a>02400         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02401"></a>02401     }
<a name="l02402"></a>02402 <span class="preprocessor">#endif</span>
<a name="l02403"></a>02403 <span class="preprocessor"></span>
<a name="l02404"></a>02404     <span class="comment">//goal state should be absorbing</span>
<a name="l02405"></a>02405     <span class="keywordflow">if</span> (state-&gt;<a class="code" href="class_c_m_d_p_s_t_a_t_e.html#a48273119863e07bb6e2ebcedba50e283">StateID</a> == EnvNAVXYTHETALAT.goalstateid) <span class="keywordflow">return</span>;
<a name="l02406"></a>02406 
<a name="l02407"></a>02407     <span class="comment">//get X, Y for the state</span>
<a name="l02408"></a>02408     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = StateID2CoordTable[state-&gt;<a class="code" href="class_c_m_d_p_s_t_a_t_e.html#a48273119863e07bb6e2ebcedba50e283">StateID</a>];
<a name="l02409"></a>02409 
<a name="l02410"></a>02410     <span class="comment">//iterate through actions</span>
<a name="l02411"></a>02411     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> aind = 0; aind &lt; EnvNAVXYTHETALATCfg.actionwidth; aind++) {
<a name="l02412"></a>02412         <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html">EnvNAVXYTHETALATAction_t</a>* nav3daction = &amp;EnvNAVXYTHETALATCfg.ActionsV[(<span class="keywordtype">unsigned</span> int)HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>][aind];
<a name="l02413"></a>02413         <span class="keywordtype">int</span> newX = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a> + nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#ab9a226015ab524f29b24ff4b78342cd0">dX</a>;
<a name="l02414"></a>02414         <span class="keywordtype">int</span> newY = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a> + nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#af3be860def6a0abfa5269f298e6bfeb6">dY</a>;
<a name="l02415"></a>02415         <span class="keywordtype">int</span> newTheta = <a class="code" href="utils_8h.html#a78721379426df9924c9d694c41cd195d">NORMALIZEDISCTHETA</a>(nav3daction-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_action__t.html#a8f62400ae7def338cfd8fb89436f9aae">endtheta</a>, EnvNAVXYTHETALATCfg.NumThetaDirs);
<a name="l02416"></a>02416 
<a name="l02417"></a>02417         <span class="comment">//skip the invalid cells</span>
<a name="l02418"></a>02418         <span class="keywordflow">if</span> (!IsValidCell(newX, newY)) <span class="keywordflow">continue</span>;
<a name="l02419"></a>02419 
<a name="l02420"></a>02420         <span class="comment">//get cost</span>
<a name="l02421"></a>02421         cost = GetActionCost(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3a5aef3d6368b5aa1524569eb372950a">Theta</a>, nav3daction);
<a name="l02422"></a>02422         <span class="keywordflow">if</span> (cost &gt;= <a class="code" href="key_8h.html#afc8375d739d221b5077960ee6b94ff88">INFINITECOST</a>) <span class="keywordflow">continue</span>;
<a name="l02423"></a>02423 
<a name="l02424"></a>02424         <span class="comment">//add the action</span>
<a name="l02425"></a>02425         <a class="code" href="class_c_m_d_p_a_c_t_i_o_n.html">CMDPACTION</a>* action = state-&gt;<a class="code" href="class_c_m_d_p_s_t_a_t_e.html#aa93e4dc0dae4c96cbe4fa38445b2f5b2">AddAction</a>(aind);
<a name="l02426"></a>02426 
<a name="l02427"></a>02427 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02428"></a>02428 <span class="preprocessor"></span>        clock_t currenttime = clock();
<a name="l02429"></a>02429 <span class="preprocessor">#endif</span>
<a name="l02430"></a>02430 <span class="preprocessor"></span>
<a name="l02431"></a>02431         <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* OutHashEntry;
<a name="l02432"></a>02432         <span class="keywordflow">if</span> ((OutHashEntry = (this-&gt;*GetHashEntry)(newX, newY, newTheta)) == NULL) {
<a name="l02433"></a>02433             <span class="comment">//have to create a new entry</span>
<a name="l02434"></a>02434             OutHashEntry = (this-&gt;*CreateNewHashEntry)(newX, newY, newTheta);
<a name="l02435"></a>02435         }
<a name="l02436"></a>02436         action-&gt;<a class="code" href="class_c_m_d_p_a_c_t_i_o_n.html#a493472d056e3e5decc86de71f4fcee9d">AddOutcome</a>(OutHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>, cost, 1.0);
<a name="l02437"></a>02437 
<a name="l02438"></a>02438 <span class="preprocessor">#if TIME_DEBUG</span>
<a name="l02439"></a>02439 <span class="preprocessor"></span>        time3_addallout += clock()-currenttime;
<a name="l02440"></a>02440 <span class="preprocessor">#endif</span>
<a name="l02441"></a>02441 <span class="preprocessor"></span>    }
<a name="l02442"></a>02442 }
<a name="l02443"></a>02443 
<a name="l02444"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a9aafa777f55e932aacb34d4d59c7348b">02444</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a9aafa777f55e932aacb34d4d59c7348b" title="this function fill in Predecessor/Successor states of edges whose costs changed It takes in an array ...">EnvironmentNAVXYTHETALAT::GetPredsofChangedEdges</a>(vector&lt;nav2dcell_t&gt; <span class="keyword">const</span> * changedcellsV,
<a name="l02445"></a>02445                                                       vector&lt;int&gt; *preds_of_changededgesIDV)
<a name="l02446"></a>02446 {
<a name="l02447"></a>02447     <a class="code" href="utils_8h.html#aa8c3f694f8aeffb899a4207bed79fa1c">nav2dcell_t</a> cell;
<a name="l02448"></a>02448     <a class="code" href="classsbpl__xy__theta__cell__t.html">sbpl_xy_theta_cell_t</a> affectedcell;
<a name="l02449"></a>02449     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* affectedHashEntry;
<a name="l02450"></a>02450 
<a name="l02451"></a>02451     <span class="comment">//increment iteration for processing savings</span>
<a name="l02452"></a>02452     iteration++;
<a name="l02453"></a>02453 
<a name="l02454"></a>02454     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)changedcellsV-&gt;size(); i++) {
<a name="l02455"></a>02455         cell = changedcellsV-&gt;at(i);
<a name="l02456"></a>02456 
<a name="l02457"></a>02457         <span class="comment">//now iterate over all states that could potentially be affected</span>
<a name="l02458"></a>02458         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sind = 0; sind &lt; (int)affectedpredstatesV.size(); sind++) {
<a name="l02459"></a>02459             affectedcell = affectedpredstatesV.at(sind);
<a name="l02460"></a>02460 
<a name="l02461"></a>02461             <span class="comment">//translate to correct for the offset</span>
<a name="l02462"></a>02462             affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> + cell.x;
<a name="l02463"></a>02463             affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> + cell.y;
<a name="l02464"></a>02464 
<a name="l02465"></a>02465             <span class="comment">//insert only if it was actually generated</span>
<a name="l02466"></a>02466             affectedHashEntry = (this-&gt;*GetHashEntry)(affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a>, affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a>, affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a>);
<a name="l02467"></a>02467             <span class="keywordflow">if</span> (affectedHashEntry != NULL &amp;&amp; affectedHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a1c7f121dee151278e335157e7ad5d41d">iteration</a> &lt; iteration) {
<a name="l02468"></a>02468                 preds_of_changededgesIDV-&gt;push_back(affectedHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>);
<a name="l02469"></a>02469                 affectedHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a1c7f121dee151278e335157e7ad5d41d">iteration</a> = iteration; <span class="comment">//mark as already inserted</span>
<a name="l02470"></a>02470             }
<a name="l02471"></a>02471         }
<a name="l02472"></a>02472     }
<a name="l02473"></a>02473 }
<a name="l02474"></a>02474 
<a name="l02475"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#ac5013d2a4cba8bca9051e318a5657818">02475</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#ac5013d2a4cba8bca9051e318a5657818" title="same as GetPredsofChangedEdges, but returns successor states. Both functions need to be present for i...">EnvironmentNAVXYTHETALAT::GetSuccsofChangedEdges</a>(vector&lt;nav2dcell_t&gt; <span class="keyword">const</span> * changedcellsV,
<a name="l02476"></a>02476                                                       vector&lt;int&gt; *succs_of_changededgesIDV)
<a name="l02477"></a>02477 {
<a name="l02478"></a>02478     <a class="code" href="utils_8h.html#aa8c3f694f8aeffb899a4207bed79fa1c">nav2dcell_t</a> cell;
<a name="l02479"></a>02479     <a class="code" href="classsbpl__xy__theta__cell__t.html">sbpl_xy_theta_cell_t</a> affectedcell;
<a name="l02480"></a>02480     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* affectedHashEntry;
<a name="l02481"></a>02481 
<a name="l02482"></a>02482     <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR: getsuccs is not supported currently\n&quot;</span>);
<a name="l02483"></a>02483     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02484"></a>02484 
<a name="l02485"></a>02485     <span class="comment">//increment iteration for processing savings</span>
<a name="l02486"></a>02486     iteration++;
<a name="l02487"></a>02487 
<a name="l02488"></a>02488     <span class="comment">//TODO - check</span>
<a name="l02489"></a>02489     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)changedcellsV-&gt;size(); i++) {
<a name="l02490"></a>02490         cell = changedcellsV-&gt;at(i);
<a name="l02491"></a>02491 
<a name="l02492"></a>02492         <span class="comment">//now iterate over all states that could potentially be affected</span>
<a name="l02493"></a>02493         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sind = 0; sind &lt; (int)affectedsuccstatesV.size(); sind++) {
<a name="l02494"></a>02494             affectedcell = affectedsuccstatesV.at(sind);
<a name="l02495"></a>02495 
<a name="l02496"></a>02496             <span class="comment">//translate to correct for the offset</span>
<a name="l02497"></a>02497             affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> = affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a> + cell.x;
<a name="l02498"></a>02498             affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> = affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a> + cell.y;
<a name="l02499"></a>02499 
<a name="l02500"></a>02500             <span class="comment">//insert only if it was actually generated</span>
<a name="l02501"></a>02501             affectedHashEntry = (this-&gt;*GetHashEntry)(affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa5b681648a009127d31e92af924138e1">x</a>, affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#a61b30b80dcf2574c59679a20eaed3211">y</a>, affectedcell.<a class="code" href="classsbpl__xy__theta__cell__t.html#aa8eafe30005baba60b4fd4797d1505cc">theta</a>);
<a name="l02502"></a>02502             <span class="keywordflow">if</span> (affectedHashEntry != NULL &amp;&amp; affectedHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a1c7f121dee151278e335157e7ad5d41d">iteration</a> &lt; iteration) {
<a name="l02503"></a>02503                 succs_of_changededgesIDV-&gt;push_back(affectedHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>);
<a name="l02504"></a>02504                 affectedHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a1c7f121dee151278e335157e7ad5d41d">iteration</a> = iteration; <span class="comment">//mark as already inserted</span>
<a name="l02505"></a>02505             }
<a name="l02506"></a>02506         }
<a name="l02507"></a>02507     }
<a name="l02508"></a>02508 }
<a name="l02509"></a>02509 
<a name="l02510"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a741d05a0225246315fb5585de49d944e">02510</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a741d05a0225246315fb5585de49d944e">EnvironmentNAVXYTHETALAT::InitializeEnvironment</a>()
<a name="l02511"></a>02511 {
<a name="l02512"></a>02512     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry;
<a name="l02513"></a>02513 
<a name="l02514"></a>02514     <span class="keywordtype">int</span> maxsize = EnvNAVXYTHETALATCfg.EnvWidth_c * EnvNAVXYTHETALATCfg.EnvHeight_c * EnvNAVXYTHETALATCfg.NumThetaDirs;
<a name="l02515"></a>02515 
<a name="l02516"></a>02516     <span class="keywordflow">if</span> (maxsize &lt;= <a class="code" href="environment__navxythetalat_8h.html#a1b3873a9bce237d3e50858cf9d99f626">SBPL_XYTHETALAT_MAXSTATESFORLOOKUP</a>) {
<a name="l02517"></a>02517         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;environment stores states in lookup table\n&quot;</span>);
<a name="l02518"></a>02518 
<a name="l02519"></a>02519         Coord2StateIDHashTable_lookup = <span class="keyword">new</span> <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>*[maxsize];
<a name="l02520"></a>02520         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; maxsize; i++)
<a name="l02521"></a>02521             Coord2StateIDHashTable_lookup[i] = NULL;
<a name="l02522"></a>02522         GetHashEntry = &amp;<a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a7eaee890c040d13dd80c8f755b50dcfd">EnvironmentNAVXYTHETALAT::GetHashEntry_lookup</a>;
<a name="l02523"></a>02523         CreateNewHashEntry = &amp;<a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aebf9769e7404224b1b0273e33775824d">EnvironmentNAVXYTHETALAT::CreateNewHashEntry_lookup</a>;
<a name="l02524"></a>02524 
<a name="l02525"></a>02525         <span class="comment">//not using hash table</span>
<a name="l02526"></a>02526         HashTableSize = 0;
<a name="l02527"></a>02527         Coord2StateIDHashTable = NULL;
<a name="l02528"></a>02528     }
<a name="l02529"></a>02529     <span class="keywordflow">else</span> {
<a name="l02530"></a>02530         <a class="code" href="config_8h.html#a9122cfeed55bc021fcc2dd373b8cc47d">SBPL_PRINTF</a>(<span class="stringliteral">&quot;environment stores states in hashtable\n&quot;</span>);
<a name="l02531"></a>02531 
<a name="l02532"></a>02532         <span class="comment">//initialize the map from Coord to StateID</span>
<a name="l02533"></a>02533         HashTableSize = 4 * 1024 * 1024; <span class="comment">//should be power of two</span>
<a name="l02534"></a>02534         Coord2StateIDHashTable = <span class="keyword">new</span> vector&lt;EnvNAVXYTHETALATHashEntry_t*&gt; [HashTableSize];
<a name="l02535"></a>02535         GetHashEntry = &amp;<a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#ab3d1c4ae85b08b03ba7025ca13ea5432">EnvironmentNAVXYTHETALAT::GetHashEntry_hash</a>;
<a name="l02536"></a>02536         CreateNewHashEntry = &amp;<a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#afc98fe01b707e858eed4eb692e4d98e1">EnvironmentNAVXYTHETALAT::CreateNewHashEntry_hash</a>;
<a name="l02537"></a>02537 
<a name="l02538"></a>02538         <span class="comment">//not using hash</span>
<a name="l02539"></a>02539         Coord2StateIDHashTable_lookup = NULL;
<a name="l02540"></a>02540     }
<a name="l02541"></a>02541 
<a name="l02542"></a>02542     <span class="comment">//initialize the map from StateID to Coord</span>
<a name="l02543"></a>02543     StateID2CoordTable.clear();
<a name="l02544"></a>02544 
<a name="l02545"></a>02545     <span class="comment">//create start state</span>
<a name="l02546"></a>02546     <span class="keywordflow">if</span> ((HashEntry = (this-&gt;*GetHashEntry)(EnvNAVXYTHETALATCfg.StartX_c, EnvNAVXYTHETALATCfg.StartY_c,
<a name="l02547"></a>02547                                            EnvNAVXYTHETALATCfg.StartTheta)) == NULL) {
<a name="l02548"></a>02548         <span class="comment">//have to create a new entry</span>
<a name="l02549"></a>02549         HashEntry = (this-&gt;*CreateNewHashEntry)(EnvNAVXYTHETALATCfg.StartX_c, EnvNAVXYTHETALATCfg.StartY_c,
<a name="l02550"></a>02550                                                 EnvNAVXYTHETALATCfg.StartTheta);
<a name="l02551"></a>02551     }
<a name="l02552"></a>02552     EnvNAVXYTHETALAT.startstateid = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>;
<a name="l02553"></a>02553 
<a name="l02554"></a>02554     <span class="comment">//create goal state</span>
<a name="l02555"></a>02555     <span class="keywordflow">if</span> ((HashEntry = (this-&gt;*GetHashEntry)(EnvNAVXYTHETALATCfg.EndX_c, EnvNAVXYTHETALATCfg.EndY_c,
<a name="l02556"></a>02556                                            EnvNAVXYTHETALATCfg.EndTheta)) == NULL) {
<a name="l02557"></a>02557         <span class="comment">//have to create a new entry</span>
<a name="l02558"></a>02558         HashEntry = (this-&gt;*CreateNewHashEntry)(EnvNAVXYTHETALATCfg.EndX_c, EnvNAVXYTHETALATCfg.EndY_c,
<a name="l02559"></a>02559                                                 EnvNAVXYTHETALATCfg.EndTheta);
<a name="l02560"></a>02560     }
<a name="l02561"></a>02561     EnvNAVXYTHETALAT.goalstateid = HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#ae1abf144b04ca375acd027335a2bfe7c">stateID</a>;
<a name="l02562"></a>02562 
<a name="l02563"></a>02563     <span class="comment">//initialized</span>
<a name="l02564"></a>02564     EnvNAVXYTHETALAT.bInitialized = <span class="keyword">true</span>;
<a name="l02565"></a>02565 }
<a name="l02566"></a>02566 
<a name="l02567"></a>02567 <span class="comment">//examples of hash functions: map state coordinates onto a hash value</span>
<a name="l02568"></a>02568 <span class="comment">//#define GETHASHBIN(X, Y) (Y*WIDTH_Y+X) </span>
<a name="l02569"></a>02569 <span class="comment">//here we have state coord: &lt;X1, X2, X3, X4&gt;</span>
<a name="l02570"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aa221aa186292333fd367ef0345a3bf78">02570</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#aa221aa186292333fd367ef0345a3bf78">EnvironmentNAVXYTHETALAT::GETHASHBIN</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> X1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> X2, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Theta)
<a name="l02571"></a>02571 {
<a name="l02572"></a>02572     <span class="keywordflow">return</span> inthash(inthash(X1) + (inthash(X2) &lt;&lt; 1) + (inthash(Theta) &lt;&lt; 2)) &amp; (HashTableSize - 1);
<a name="l02573"></a>02573 }
<a name="l02574"></a>02574 
<a name="l02575"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a1fb3f24390c7ee54210ed8933ab97706">02575</a> <span class="keywordtype">void</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a1fb3f24390c7ee54210ed8933ab97706">EnvironmentNAVXYTHETALAT::PrintHashTableHist</a>(FILE* fOut)
<a name="l02576"></a>02576 {
<a name="l02577"></a>02577     <span class="keywordtype">int</span> s0 = 0, s1 = 0, s50 = 0, s100 = 0, s200 = 0, s300 = 0, slarge = 0;
<a name="l02578"></a>02578 
<a name="l02579"></a>02579     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; HashTableSize; j++) {
<a name="l02580"></a>02580         <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)Coord2StateIDHashTable[j].size() == 0)
<a name="l02581"></a>02581             s0++;
<a name="l02582"></a>02582         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)Coord2StateIDHashTable[j].size() &lt; 5)
<a name="l02583"></a>02583             s1++;
<a name="l02584"></a>02584         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)Coord2StateIDHashTable[j].size() &lt; 25)
<a name="l02585"></a>02585             s50++;
<a name="l02586"></a>02586         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)Coord2StateIDHashTable[j].size() &lt; 50)
<a name="l02587"></a>02587             s100++;
<a name="l02588"></a>02588         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)Coord2StateIDHashTable[j].size() &lt; 100)
<a name="l02589"></a>02589             s200++;
<a name="l02590"></a>02590         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)Coord2StateIDHashTable[j].size() &lt; 400)
<a name="l02591"></a>02591             s300++;
<a name="l02592"></a>02592         <span class="keywordflow">else</span>
<a name="l02593"></a>02593             slarge++;
<a name="l02594"></a>02594     }
<a name="l02595"></a>02595     <a class="code" href="config_8h.html#a7cd4beba805993dccfd4fb6ceb17c9e3">SBPL_FPRINTF</a>(fOut, <span class="stringliteral">&quot;hash table histogram: 0:%d, &lt;5:%d, &lt;25:%d, &lt;50:%d, &lt;100:%d, &lt;400:%d, &gt;400:%d\n&quot;</span>, s0, s1, s50,
<a name="l02596"></a>02596                  s100, s200, s300, slarge);
<a name="l02597"></a>02597 }
<a name="l02598"></a>02598 
<a name="l02599"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a4e10d798b23cf5a88988633e96bc31ed">02599</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a4e10d798b23cf5a88988633e96bc31ed" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALAT::GetFromToHeuristic</a>(<span class="keywordtype">int</span> FromStateID, <span class="keywordtype">int</span> ToStateID)
<a name="l02600"></a>02600 {
<a name="l02601"></a>02601 <span class="preprocessor">#if USE_HEUR==0</span>
<a name="l02602"></a>02602 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
<a name="l02603"></a>02603 <span class="preprocessor">#endif</span>
<a name="l02604"></a>02604 <span class="preprocessor"></span>
<a name="l02605"></a>02605 <span class="preprocessor">#if DEBUG</span>
<a name="l02606"></a>02606 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(FromStateID &gt;= (<span class="keywordtype">int</span>)StateID2CoordTable.size()
<a name="l02607"></a>02607         || ToStateID &gt;= (int)StateID2CoordTable.size())
<a name="l02608"></a>02608     {
<a name="l02609"></a>02609         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvNAVXYTHETALAT... function: stateID illegal\n&quot;</span>);
<a name="l02610"></a>02610         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02611"></a>02611     }
<a name="l02612"></a>02612 <span class="preprocessor">#endif</span>
<a name="l02613"></a>02613 <span class="preprocessor"></span>
<a name="l02614"></a>02614     <span class="comment">//get X, Y for the state</span>
<a name="l02615"></a>02615     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* FromHashEntry = StateID2CoordTable[FromStateID];
<a name="l02616"></a>02616     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* ToHashEntry = StateID2CoordTable[ToStateID];
<a name="l02617"></a>02617 
<a name="l02618"></a>02618     <span class="comment">//TODO - check if one of the gridsearches already computed and then use it.</span>
<a name="l02619"></a>02619 
<a name="l02620"></a>02620     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a> * EuclideanDistance_m(FromHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, FromHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>, ToHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>,
<a name="l02621"></a>02621                                                                     ToHashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>) /
<a name="l02622"></a>02622                  EnvNAVXYTHETALATCfg.nominalvel_mpersecs);
<a name="l02623"></a>02623 
<a name="l02624"></a>02624 }
<a name="l02625"></a>02625 
<a name="l02626"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#ad52635bc44cad58ee7a8015ae2ef4e3b">02626</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#ad52635bc44cad58ee7a8015ae2ef4e3b" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALAT::GetGoalHeuristic</a>(<span class="keywordtype">int</span> stateID)
<a name="l02627"></a>02627 {
<a name="l02628"></a>02628 <span class="preprocessor">#if USE_HEUR==0</span>
<a name="l02629"></a>02629 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
<a name="l02630"></a>02630 <span class="preprocessor">#endif</span>
<a name="l02631"></a>02631 <span class="preprocessor"></span>
<a name="l02632"></a>02632 <span class="preprocessor">#if DEBUG</span>
<a name="l02633"></a>02633 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (stateID &gt;= (<span class="keywordtype">int</span>)StateID2CoordTable.size()) {
<a name="l02634"></a>02634         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvNAVXYTHETALAT... function: stateID illegal\n&quot;</span>);
<a name="l02635"></a>02635         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02636"></a>02636     }
<a name="l02637"></a>02637 <span class="preprocessor">#endif</span>
<a name="l02638"></a>02638 <span class="preprocessor"></span>
<a name="l02639"></a>02639     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = StateID2CoordTable[stateID];
<a name="l02640"></a>02640     <span class="comment">//computes distances from start state that is grid2D, so it is EndX_c EndY_c</span>
<a name="l02641"></a>02641     <span class="keywordtype">int</span> h2D = grid2Dsearchfromgoal-&gt;getlowerboundoncostfromstart_inmm(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>); 
<a name="l02642"></a>02642     <span class="keywordtype">int</span> hEuclid = (int)(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a> * EuclideanDistance_m(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>,
<a name="l02643"></a>02643                                                                            EnvNAVXYTHETALATCfg.EndX_c,
<a name="l02644"></a>02644                                                                            EnvNAVXYTHETALATCfg.EndY_c));
<a name="l02645"></a>02645 
<a name="l02646"></a>02646     <span class="comment">//define this function if it is used in the planner (heuristic backward search would use it)</span>
<a name="l02647"></a>02647     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(((double)<a class="code" href="utils_8h.html#af643213a7d426b69429d1430cef4ecbb">__max</a>(h2D, hEuclid)) / EnvNAVXYTHETALATCfg.nominalvel_mpersecs);
<a name="l02648"></a>02648 }
<a name="l02649"></a>02649 
<a name="l02650"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a7c22f93f257ce46723dd9f816385ae95">02650</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a7c22f93f257ce46723dd9f816385ae95" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALAT::GetStartHeuristic</a>(<span class="keywordtype">int</span> stateID)
<a name="l02651"></a>02651 {
<a name="l02652"></a>02652 <span class="preprocessor">#if USE_HEUR==0</span>
<a name="l02653"></a>02653 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
<a name="l02654"></a>02654 <span class="preprocessor">#endif</span>
<a name="l02655"></a>02655 <span class="preprocessor"></span>
<a name="l02656"></a>02656 <span class="preprocessor">#if DEBUG</span>
<a name="l02657"></a>02657 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (stateID &gt;= (<span class="keywordtype">int</span>)StateID2CoordTable.size()) {
<a name="l02658"></a>02658         <a class="code" href="config_8h.html#aec65b814c59b7943d3a1c49ee49349fe">SBPL_ERROR</a>(<span class="stringliteral">&quot;ERROR in EnvNAVXYTHETALAT... function: stateID illegal\n&quot;</span>);
<a name="l02659"></a>02659         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_s_b_p_l___exception.html">SBPL_Exception</a>();
<a name="l02660"></a>02660     }
<a name="l02661"></a>02661 <span class="preprocessor">#endif</span>
<a name="l02662"></a>02662 <span class="preprocessor"></span>
<a name="l02663"></a>02663     <a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html">EnvNAVXYTHETALATHashEntry_t</a>* HashEntry = StateID2CoordTable[stateID];
<a name="l02664"></a>02664     <span class="keywordtype">int</span> h2D = grid2Dsearchfromstart-&gt;getlowerboundoncostfromstart_inmm(HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>);
<a name="l02665"></a>02665     <span class="keywordtype">int</span> hEuclid = (int)(<a class="code" href="environment__navxythetalat_8h.html#a378939ff173fa75b36b4d64115bb51b4">NAVXYTHETALAT_COSTMULT_MTOMM</a> * EuclideanDistance_m(EnvNAVXYTHETALATCfg.StartX_c,
<a name="l02666"></a>02666                                                                            EnvNAVXYTHETALATCfg.StartY_c, HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a3cf0bb19cb3ea0b74b652d626d02fd67">X</a>,
<a name="l02667"></a>02667                                                                            HashEntry-&gt;<a class="code" href="struct_env_n_a_v_x_y_t_h_e_t_a_l_a_t_hash_entry__t.html#a4a2f95f34f9ac5d3104f828698c17669">Y</a>));
<a name="l02668"></a>02668 
<a name="l02669"></a>02669     <span class="comment">//define this function if it is used in the planner (heuristic backward search would use it)</span>
<a name="l02670"></a>02670     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(((double)<a class="code" href="utils_8h.html#af643213a7d426b69429d1430cef4ecbb">__max</a>(h2D, hEuclid)) / EnvNAVXYTHETALATCfg.nominalvel_mpersecs);
<a name="l02671"></a>02671 }
<a name="l02672"></a>02672 
<a name="l02673"></a><a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a6f82e0701629c5205a72f535f4207d8e">02673</a> <span class="keywordtype">int</span> <a class="code" href="class_environment_n_a_v_x_y_t_h_e_t_a_l_a_t.html#a6f82e0701629c5205a72f535f4207d8e" title="see comments on the same function in the parent class">EnvironmentNAVXYTHETALAT::SizeofCreatedEnv</a>()
<a name="l02674"></a>02674 {
<a name="l02675"></a>02675     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)StateID2CoordTable.size();
<a name="l02676"></a>02676 }
<a name="l02677"></a>02677 
<a name="l02678"></a>02678 <span class="comment">//------------------------------------------------------------------------------</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="environment__navxythetalat_8cpp.html">environment_navxythetalat.cpp</a>      </li>

    <li class="footer">Generated on Thu Mar 21 2013 12:14:23 for SBPL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
